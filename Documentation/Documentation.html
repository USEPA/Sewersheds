<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Documentation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Documentation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Documentation_files/libs/quarto-html/quarto.js"></script>
<script src="Documentation_files/libs/quarto-html/popper.min.js"></script>
<script src="Documentation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Documentation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Documentation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Documentation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Documentation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Documentation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Documentation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="Documentation_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="Documentation_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="Documentation_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="Documentation_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">

<script src="Documentation_files/libs/leaflet-1.3.1/leaflet.js"></script>

<link href="Documentation_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">

<script src="Documentation_files/libs/proj4-2.6.2/proj4.min.js"></script>

<script src="Documentation_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>

<link href="Documentation_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">

<script src="Documentation_files/libs/leaflet-binding-2.2.2/leaflet.js"></script>

<script src="Documentation_files/libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>

<script src="Documentation_files/libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>


  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#endpoints" id="toc-endpoints" class="nav-link active" data-scroll-target="#endpoints">Endpoints</a>
  <ul class="collapse">
  <li><a href="#defining-the-universe-of-endpoints" id="toc-defining-the-universe-of-endpoints" class="nav-link" data-scroll-target="#defining-the-universe-of-endpoints">Defining the Universe of Endpoints</a></li>
  </ul></li>
  <li><a href="#validation-data-public-sewershed-data" id="toc-validation-data-public-sewershed-data" class="nav-link" data-scroll-target="#validation-data-public-sewershed-data">Validation Data (Public Sewershed Data)</a>
  <ul class="collapse">
  <li><a href="#joining-cwns-ids-to-sewershed-data." id="toc-joining-cwns-ids-to-sewershed-data." class="nav-link" data-scroll-target="#joining-cwns-ids-to-sewershed-data.">Joining CWNS IDs to sewershed data.</a></li>
  <li><a href="#appending-spatial-data-to-sewershed-boundaries" id="toc-appending-spatial-data-to-sewershed-boundaries" class="nav-link" data-scroll-target="#appending-spatial-data-to-sewershed-boundaries">Appending Spatial Data to Sewershed Boundaries</a></li>
  <li><a href="#breakdown-of-detail-findings" id="toc-breakdown-of-detail-findings" class="nav-link" data-scroll-target="#breakdown-of-detail-findings">Breakdown of Detail Findings</a></li>
  </ul></li>
  <li><a href="#joining-validation-boundaries-to-cwns-locations" id="toc-joining-validation-boundaries-to-cwns-locations" class="nav-link" data-scroll-target="#joining-validation-boundaries-to-cwns-locations">Joining Validation Boundaries to CWNS Locations</a>
  <ul class="collapse">
  <li><a href="#number-of-systems-by-state-in-cwns" id="toc-number-of-systems-by-state-in-cwns" class="nav-link" data-scroll-target="#number-of-systems-by-state-in-cwns">Number of Systems by State in CWNS</a></li>
  <li><a href="#system-matching-classification" id="toc-system-matching-classification" class="nav-link" data-scroll-target="#system-matching-classification">System Matching Classification</a></li>
  </ul></li>
  <li><a href="#selecting-the-validation-set" id="toc-selecting-the-validation-set" class="nav-link" data-scroll-target="#selecting-the-validation-set">Selecting the Validation Set</a>
  <ul class="collapse">
  <li><a href="#match-results" id="toc-match-results" class="nav-link" data-scroll-target="#match-results">Match Results</a></li>
  <li><a href="#select-validation-counties" id="toc-select-validation-counties" class="nav-link" data-scroll-target="#select-validation-counties">Select Validation Counties</a></li>
  <li><a href="#review-of-validation-data" id="toc-review-of-validation-data" class="nav-link" data-scroll-target="#review-of-validation-data">Review of Validation Data</a></li>
  <li><a href="#endpoint-location-review" id="toc-endpoint-location-review" class="nav-link" data-scroll-target="#endpoint-location-review">Endpoint Location Review</a></li>
  </ul></li>
  <li><a href="#development-of-input-data" id="toc-development-of-input-data" class="nav-link" data-scroll-target="#development-of-input-data">Development of Input Data</a>
  <ul class="collapse">
  <li><a href="#census-data" id="toc-census-data" class="nav-link" data-scroll-target="#census-data">1990 Census Data</a></li>
  <li><a href="#census-data-1" id="toc-census-data-1" class="nav-link" data-scroll-target="#census-data-1">2020 Census Data</a></li>
  <li><a href="#building-footprints" id="toc-building-footprints" class="nav-link" data-scroll-target="#building-footprints">Building Footprints</a></li>
  <li><a href="#land-cover-land-use" id="toc-land-cover-land-use" class="nav-link" data-scroll-target="#land-cover-land-use">Land Cover / Land Use</a></li>
  <li><a href="#road-networks" id="toc-road-networks" class="nav-link" data-scroll-target="#road-networks">Road Networks</a></li>
  <li><a href="#distance-and-neighborhood-metrics" id="toc-distance-and-neighborhood-metrics" class="nav-link" data-scroll-target="#distance-and-neighborhood-metrics">Distance and Neighborhood Metrics</a></li>
  <li><a href="#determining-maximum-search-distance" id="toc-determining-maximum-search-distance" class="nav-link" data-scroll-target="#determining-maximum-search-distance">Determining Maximum Search Distance</a>
  <ul class="collapse">
  <li><a href="#h3-navigation-example" id="toc-h3-navigation-example" class="nav-link" data-scroll-target="#h3-navigation-example">H3 Navigation Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link" data-scroll-target="#machine-learning">Machine Learning</a>
  <ul class="collapse">
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#splitting-data-into-training-and-testing-sets" id="toc-splitting-data-into-training-and-testing-sets" class="nav-link" data-scroll-target="#splitting-data-into-training-and-testing-sets">Splitting Data into Training and Testing Sets</a></li>
  <li><a href="#overview-of-data-and-modeling-strategy" id="toc-overview-of-data-and-modeling-strategy" class="nav-link" data-scroll-target="#overview-of-data-and-modeling-strategy">Overview of Data and Modeling Strategy</a></li>
  <li><a href="#balancing-training-outcomes" id="toc-balancing-training-outcomes" class="nav-link" data-scroll-target="#balancing-training-outcomes">Balancing Training Outcomes</a></li>
  <li><a href="#sewershed-population-served" id="toc-sewershed-population-served" class="nav-link" data-scroll-target="#sewershed-population-served">Sewershed Population Served</a></li>
  <li><a href="#manhatten-distance" id="toc-manhatten-distance" class="nav-link" data-scroll-target="#manhatten-distance">Manhatten Distance</a></li>
  <li><a href="#straight-distance" id="toc-straight-distance" class="nav-link" data-scroll-target="#straight-distance">Straight Distance</a></li>
  <li><a href="#squirrel-distance" id="toc-squirrel-distance" class="nav-link" data-scroll-target="#squirrel-distance">Squirrel Distance</a></li>
  <li><a href="#building-metrics" id="toc-building-metrics" class="nav-link" data-scroll-target="#building-metrics">Building Metrics</a></li>
  <li><a href="#housing-units" id="toc-housing-units" class="nav-link" data-scroll-target="#housing-units">1990 Housing Units</a></li>
  <li><a href="#housing-units-1" id="toc-housing-units-1" class="nav-link" data-scroll-target="#housing-units-1">2020 Housing Units</a></li>
  <li><a href="#sewer" id="toc-sewer" class="nav-link" data-scroll-target="#sewer">1990 % Sewer</a></li>
  <li><a href="#population" id="toc-population" class="nav-link" data-scroll-target="#population">2020 Population</a></li>
  <li><a href="#urban-rural-census-classification" id="toc-urban-rural-census-classification" class="nav-link" data-scroll-target="#urban-rural-census-classification">Urban / Rural Census Classification</a></li>
  <li><a href="#land-cover" id="toc-land-cover" class="nav-link" data-scroll-target="#land-cover">Land Cover</a></li>
  <li><a href="#endpoint-elevation" id="toc-endpoint-elevation" class="nav-link" data-scroll-target="#endpoint-elevation">Endpoint Elevation</a></li>
  <li><a href="#elevation-difference" id="toc-elevation-difference" class="nav-link" data-scroll-target="#elevation-difference">Elevation Difference</a></li>
  <li><a href="#impervious-surface" id="toc-impervious-surface" class="nav-link" data-scroll-target="#impervious-surface">Impervious Surface</a></li>
  <li><a href="#metrics-to-describe-area-between-hexagon-and-endpoint" id="toc-metrics-to-describe-area-between-hexagon-and-endpoint" class="nav-link" data-scroll-target="#metrics-to-describe-area-between-hexagon-and-endpoint">Metrics to Describe Area Between Hexagon and Endpoint</a></li>
  <li><a href="#metrics-to-describe-the-area-surrounding-each-hexagon" id="toc-metrics-to-describe-the-area-surrounding-each-hexagon" class="nav-link" data-scroll-target="#metrics-to-describe-the-area-surrounding-each-hexagon">Metrics to Describe the Area Surrounding each Hexagon</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Documentation</h1>
</div>



<div class="quarto-title-meta column-page-right">

    
  
    
  </div>
  


</header>


<p>This document serves as an outline for all analysis and step documentation for modeling sewershed boundaries. You may need to refer to other documents for more specific information relating to specific steps, which will be noted where applicable.</p>
<section id="endpoints" class="level2">
<h2 class="anchored" data-anchor-id="endpoints">Endpoints</h2>
<p>Endpoints, which are generally wastewater treatment plants, are the point of convergence for all wastewater collected within a ‘sewershed’. Our goal is to estimate the spatial area that contributes to these endpoints. Endpoint locations are obtained from the <a href="https://www.epa.gov/cwns">Clean Watersheds Needs Survey (CWNS)</a> (2022).</p>
<section id="defining-the-universe-of-endpoints" class="level3">
<h3 class="anchored" data-anchor-id="defining-the-universe-of-endpoints">Defining the Universe of Endpoints</h3>
<p><strong>Notes:</strong></p>
<ul>
<li><p><strong>NOT</strong> safe to assume all rows in facilities_confirmed are all end point</p></li>
<li><p><strong>YES</strong> safe to assume all rows in population_confirmed are endpoints</p></li>
<li><p><strong>REMOVE CHANGE_TYPE == “New”</strong></p></li>
<li><p>Total receiving population = total number of people the facility is receiving from, regardless of whether its sent on elsewhere</p></li>
</ul>
<p>Not all records within the CWNS represent endpoints for wastewater collection. The first step in our modeling effort is to establish the universe of systems. To do this, we use the following criteria to select locations:</p>
<ul>
<li><p>Publicly owned treatment works</p></li>
<li><p>POTWs that treat human waste (as opposed to wet weather facilities)</p></li>
<li><p>Total receiving population &gt; 0</p></li>
<li><p>facility type contains “treatment plant”</p></li>
<li><p>Residential population &gt; 0</p></li>
<li><p>Percent of Discharge is set to be &lt; 50% (This value can be changed)</p></li>
</ul>
<p>The CWNS data we are working with was received as a Microsoft Access Database, which is located in ‘Data/CWNS 2022 Database_April2024.accdb’. We use 7 tables from this access database. Note that ‘POPULATION_WASTEWATER_CONFIRMED’ was manually updated by ERG in June, 2024 and does not reflect original data in the access database. Each table was exported from Access to a comma delimited file. The seven files used are:</p>
<ul>
<li>‘Data/FACILITIES.txt’</li>
<li>‘Data/POPULATION_WASTEWATER.txt’</li>
<li>‘Data/FACILITY_TYPES.txt’</li>
<li>‘Data/PHYSICAL_LOCATION.txt’</li>
<li>‘Data/FACILITIES_CONFIRMED.txt’</li>
<li>‘Data/POPULATION_WASTEWATER_CONFIRMED_updated06242024.csv’</li>
<li>‘Data/DISCHARGES.csv’</li>
</ul>
<p>The following steps describe the process used to query endpoints to be included in modeling efforts. The code can also be viewed in the expandable code tab.</p>
<p>We create a flat file where each row represents a facility and perform the followng steps: - In ‘POPULATION_WASTEWATER”, if no value is given for the column ’END_FACILITY’, we assign it “N”, meaning it is not considered an end facility. - ‘END_FACILITY’ and ‘FACILITY_TYPE’ columns for the ‘FACILITIES_CONFIRMED’ file are set to ‘Y’ and ‘Treatment Plant’ respectively. - Discharge is calculated using the ‘DISCHARGES’ file. Because systems can discharge to multiple other systems, we calculate the sum of discharges to determine the total % discharged elsewhere. If discharge is not reported for a system, we default the value to zero. - Data tables are combined and the filter is applied:</p>
<ul>
<li><code>TOTAL_RES_POPULATION_2022 &gt; 0 &amp; FACILITY_TYPE=="Treatment Plant" &amp; PRESENT_DISCHARGE_PERCENTAGE &lt; 50</code></li>
</ul>
<p>In total, we started with 54,738 rows of data, which were queried down to a universe of 17,272 individual treatment plants to be included in the modeling efforts.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import CWNS data and create a flat file</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Load facilities</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>fac <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/FACILITIES.txt"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,FACILITY_ID,STATE_CODE,INFRASTRUCTURE_TYPE,FACILITY_NAME)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Load population served</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/POPULATION_WASTEWATER.txt"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,FACILITY_ID,POPULATION_TYPE,RESIDENTIAL_POP_2022,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         NONRESIDENTIAL_POP_2022,TOTAL_RES_POPULATION_2022,TOTAL_NONRES_POPULATION_2022,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         PART_OF_SEWERSHED,END_FACILITY)<span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">END_FACILITY =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(END_FACILITY),<span class="st">"N"</span>,END_FACILITY))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Load facility types</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>fac.types <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"data/FACILITY_TYPES.txt"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,FACILITY_ID,FACILITY_TYPE)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Load facility locations</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>fac.locs <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"data/PHYSICAL_LOCATION.txt"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>STATE_CODE)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Join population, location and types to facilities</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.1</span> <span class="ot">&lt;-</span> fac<span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CWNS_ID"</span>,<span class="st">"FACILITY_ID"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fac.locs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CWNS_ID"</span>,<span class="st">"FACILITY_ID"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fac.types, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CWNS_ID"</span>,<span class="st">"FACILITY_ID"</span>))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Data captured after CWNS</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>fac.cf <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"data/FACILITIES_CONFIRMED.txt"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,FACILITY_ID,STATE_CODE,INFRASTRUCTURE_TYPE,FACILITY_NAME)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ERG went back and fixed many missing or incorrect locations.</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>pop.cf <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"data/POPULATION_WASTEWATER_CONFIRMED_updated06242024.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ZIP_CODE =</span> <span class="fu">substr</span>(ZIP_CODE,<span class="dv">1</span>,<span class="dv">5</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(STATE_CODE,INFRASTRUCTURE_TYPE))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># new.sf &lt;- pop.cf%&gt;%</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(CWNS_ID,FACILITY_TYPE,TOTAL_RES_POPULATION_2022,LOCATION_TYPE,LATITUDE,LONGITUDE)%&gt;%</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   st_as_sf(coords = c("LONGITUDE","LATITUDE"), crs = st_crs(4269))</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(new.sf) &lt;- c("CWNSID","FacType","Population","LocType","geometry")</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># st_write(new.sf,"D:/temp/Confirmed_New.gpkg", layer = "New", append = FALSE)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># There is only one row for each CWNS_ID in this data, and it is assumed they are all treatment plants / endpoints</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.2</span> <span class="ot">&lt;-</span> fac.cf<span class="sc">%&gt;%</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop.cf,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CWNS_ID"</span>,<span class="st">"FACILITY_ID"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FACILITY_TYPE =</span> <span class="st">"Treatment Plant"</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">END_FACILITY =</span> <span class="st">"Y"</span>)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>df.bind <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(df<span class="fl">.1</span>,df<span class="fl">.2</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>discharge <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/DISCHARGES.csv"</span>), <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"CWNS_ID"</span>,<span class="st">"FACILITY_ID"</span>,<span class="st">"STATE_CODE"</span>,<span class="st">"DISCHARGE_TYPE"</span>,<span class="st">"PRESENT_DISCHARGE_PERCENTAGE"</span>,<span class="st">"PROJECTED_DISCHARGE_PERCENT"</span>,<span class="st">"DISCHARGES_TO_CWNSID"</span>,<span class="st">"DISCHARGES_NOTES"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,DISCHARGE_TYPE,PRESENT_DISCHARGE_PERCENTAGE)<span class="sc">%&gt;%</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CWNS_ID)<span class="sc">%&gt;%</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PRESENT_DISCHARGE_PERCENTAGE =</span> <span class="fu">sum</span>(PRESENT_DISCHARGE_PERCENTAGE,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="co"># First cut</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>treatment.end <span class="ot">&lt;-</span> df.bind<span class="sc">%&gt;%</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(discharge)<span class="sc">%&gt;%</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(TOTAL_RES_POPULATION_2022 <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> FACILITY_TYPE<span class="sc">==</span><span class="st">"Treatment Plant"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PRESENT_DISCHARGE_PERCENTAGE =</span> <span class="fu">replace_na</span>(PRESENT_DISCHARGE_PERCENTAGE,<span class="dv">0</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">drop =</span> <span class="fu">ifelse</span>(DISCHARGE_TYPE <span class="sc">==</span> <span class="st">"Discharge To Another Facility"</span> <span class="sc">&amp;</span> PRESENT_DISCHARGE_PERCENTAGE <span class="sc">&gt;</span> <span class="dv">50</span>, <span class="cn">TRUE</span>,<span class="cn">FALSE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(drop <span class="sc">==</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>DISCHARGE_TYPE)<span class="sc">%&gt;%</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>sf <span class="ot">&lt;-</span> treatment.end<span class="sc">%&gt;%</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(LATITUDE, LONGITUDE)<span class="sc">%&gt;%</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"LONGITUDE"</span>,<span class="st">"LATITUDE"</span>), <span class="at">crs =</span> <span class="dv">4269</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(sf, <span class="fu">here</span>(<span class="st">"Data/endpoints.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Endpoints_LT50PCT_Q"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="validation-data-public-sewershed-data" class="level2">
<h2 class="anchored" data-anchor-id="validation-data-public-sewershed-data">Validation Data (Public Sewershed Data)</h2>
<p>The model will use boundaries from a variety of sources to train and test on. It is critical that we use accurate data for this, otherwise the model will reflect incorrect relationships. This section details the data we have and defines the areas we will use for model creation. For the model, areas that are not served by sewer systems are equally important. For model training, we want areas that we know are not served by sewer systems, as well as areas where we know the exact extents of specific sewer systems. Before we review whether boundaries are accurate or not, we need to first determine how many systems are missing boundaries from the dataset we have.</p>
<section id="joining-cwns-ids-to-sewershed-data." class="level3">
<h3 class="anchored" data-anchor-id="joining-cwns-ids-to-sewershed-data.">Joining CWNS IDs to sewershed data.</h3>
<p>There is no universal identifier to match data from the CWNS with state provided or otherwise obtained sewershed boundaries. Therefore, we need to match the boundaries with the CWNS IDs that are associated with our data. We do this both spatially and with text matching.</p>
<p>First, an overview of the boundary data we have:</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>swr.files <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data"</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">".shp$"</span>),</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">file =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data"</span>), <span class="at">full.names =</span> <span class="cn">FALSE</span>, <span class="at">pattern =</span> <span class="st">".shp$"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(file, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"B"</span>), <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">extra =</span> <span class="st">"drop"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>B)<span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="fu">ifelse</span>(State <span class="sc">==</span> <span class="st">"West"</span>,<span class="st">"WestVirginia"</span>,State))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count features and fields</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>state.ff <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(swr.files)){</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  sf.temp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(swr.files<span class="sc">$</span>path[n], <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  newRow <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">State =</span> swr.files<span class="sc">$</span>State[n],</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Features =</span> <span class="fu">nrow</span>(sf.temp),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Fields =</span> <span class="fu">ncol</span>(sf.temp),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">CRS =</span> <span class="fu">st_crs</span>(sf.temp)<span class="sc">$</span>input)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  state.ff <span class="ot">&lt;-</span> <span class="fu">rbind</span>(state.ff,newRow)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>state.ff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We have a variety of data from several states that we need to check against the CWNS data. We start by extracting each boundary from the data we have and determining the utility name field (if one exists). Some states have multiple polygons/rows that belong to the same system while others have all polygons for a system condensed into a single row / multipolygon. We need to identify any polygons that can be condensed into a single row to the best of our ability. We then have a single spatial dataset where each row refers to a boundary, and the utility names are in a single column. In total, we have 23,419 polygons across 10 states.</p>
<section id="connecticut" class="level4">
<h4 class="anchored" data-anchor-id="connecticut">Connecticut</h4>
<p>Connecticut has one name field: “TREATMENTFACILITY- This field represents the sewer service treatment facility (endpoint) that processes the waste for each municipality. For municipalities without sewers, “Not Applicable” is the designated value.” <a href="https://ct-deep-gis-open-data-website-ctdeep.hub.arcgis.com/datasets/CTDEEP::connected-sewer-service-areas/about">Source</a>. Connecticut data is in multipolygon format already but has duplicate endpoint facility values. Therefore, we need to condense these multipolygons based on the treatment facility.</p>
</section>
<section id="maryland" class="level4">
<h4 class="anchored" data-anchor-id="maryland">Maryland</h4>
<p>We don’t seem to have very good metadata for Maryland, but we see that they have several classifications for their polygons, including planned areas and areas for other use types. There is also a ‘WWTP_SHED’ field, which we take to indicate the treatment plant that the polygon flows to. We filter using <code>DEF_A == 'EXISTING SERVICE AREA'</code> and then merge rows based on the treatment plant field.</p>
</section>
<section id="new-hampshire" class="level4">
<h4 class="anchored" data-anchor-id="new-hampshire">New Hampshire</h4>
<p>New Hampshire provided buffered sewer lines, which have a system name column. These polygons are merged based on this name field.</p>
</section>
<section id="new-york" class="level4">
<h4 class="anchored" data-anchor-id="new-york">New York</h4>
<p>New York has two separate name columns: ‘WWTP’ and ‘Sewershed’. Since the CWNS uses treatment plants, that is the field we use to aggreagate polygons.</p>
</section>
<section id="new-jersey" class="level4">
<h4 class="anchored" data-anchor-id="new-jersey">New Jersey</h4>
<p>New Jersey has several name fields. Some searching around indicates that the ‘WMP’ field seems to be associated with the treatment facility. This is used to aggregate rows.</p>
</section>
<section id="rhode-island" class="level4">
<h4 class="anchored" data-anchor-id="rhode-island">Rhode Island</h4>
<p>Rhode island data does not have any associated utility information, so may be difficult to have confidence in any matching.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ct <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/CONNECTICUT_statedata_publiconline_sewersheds.shp"</span>), <span class="at">quiet =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4269</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TreatmentF)<span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"CT"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"CT-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,TreatmentF)<span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Maryland</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>md <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/MARYLAND_statedata_sewersheds.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DEF_A <span class="sc">==</span> <span class="st">"EXISTING SERVICE AREA"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4269</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WWTP_SHED =</span> <span class="fu">replace_na</span>(WWTP_SHED,<span class="st">"UNKNOWN"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WWTP_SHED)<span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"MD"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"MD-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,WWTP_SHED)<span class="sc">%&gt;%</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># New Hampshire</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>nh <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"D:/Github/Sewersheds/Data/State_Provided_Data/New Hampshire/Other_Data/Sewer_Lines_Buffer_Archive.shp"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4269</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SYS_NAME)<span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"NH"</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"NH-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,SYS_NAME)<span class="sc">%&gt;%</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># New York</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>ny <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/NEW YORK_statedata_publiconline_sewersheds.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4269</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WWTP)<span class="sc">%&gt;%</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"NY"</span>,<span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"NY-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,WWTP)<span class="sc">%&gt;%</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># New Jersey</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>nj <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/NEWJERSEY_statedata_publiconline_sewersheds.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4269</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WMP)<span class="sc">%&gt;%</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"NJ"</span>,<span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"NJ-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,WMP)<span class="sc">%&gt;%</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co"># North Carolina</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/NORTHCAROLINA_statedata_publiconline_sewersheds.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4269</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sssyname)<span class="sc">%&gt;%</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"NC"</span>,</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>         <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"NC-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,sssyname)<span class="sc">%&gt;%</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Rhode Island</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>ri <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/RHODEISLAND_statedata_publiconline_sewersheds.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"RI"</span>,<span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"RI-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID)<span class="sc">%&gt;%</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4269</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Texas</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>tx <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/TEXAS_CCN_SEWER_TSMS.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4269</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UTILITY)<span class="sc">%&gt;%</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"TX"</span>,<span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"TX-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,UTILITY)<span class="sc">%&gt;%</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Vermont</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>vt <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/VERMONT_statedata_publiconline_sewersheds.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4269</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sSYSNAME)<span class="sc">%&gt;%</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"VT"</span>, <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"VT-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,sSYSNAME)<span class="sc">%&gt;%</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="co"># West Virginia</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>wv <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/State_Provided_Data/West_Virginia.shp"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4269</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Utility)<span class="sc">%&gt;%</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="st">"WV"</span>, <span class="at">ID =</span> <span class="fu">paste0</span>(<span class="st">"WV-"</span>,<span class="fu">rownames</span>(.)))<span class="sc">%&gt;%</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,Utility)<span class="sc">%&gt;%</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State"</span>,<span class="st">"ID"</span>,<span class="st">"Name"</span>,<span class="st">"geometry"</span>))</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine and project to albers equal area</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>swr.st <span class="ot">&lt;-</span> ct<span class="sc">%&gt;%</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(md,nh,ny,nj,nc,ri,tx,vt,wv)<span class="sc">%&gt;%</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,Name)<span class="sc">%&gt;%</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">5070</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Swr_Area =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(.))<span class="sc">/</span><span class="dv">1000000</span>)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>geo.check <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(<span class="fu">st_geometry_type</span>(swr.st)))<span class="sc">%&gt;%</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Freq <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="appending-spatial-data-to-sewershed-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="appending-spatial-data-to-sewershed-boundaries">Appending Spatial Data to Sewershed Boundaries</h3>
<p>The next step is to append other geographic data to these boundaries. We’ll use a few different geographic units available from the census to give us a few fields to perform name matching to the CWNS. We’ll also calculate a couple of spatial metrics to try to understand the level of detail of the boundaries. Many of these systems are broken into polygons already.</p>
<ul>
<li>Place Name</li>
<li>Sub-County Name</li>
<li>County Name</li>
<li>Area Metrics for intersections</li>
<li>Number of Polygons per system</li>
<li>Number of Vertices divided by boundary length
<ul>
<li>We convert the polygons to multi-linestrings and calculate the overall distance, then convert those multi-linestrings to points and divide the number of vertices by overall length (in kilometers).</li>
</ul></li>
</ul>
<section id="place-names" class="level4">
<h4 class="anchored" data-anchor-id="place-names">Place Names</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>places <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">places</span>(<span class="at">state=</span><span class="fu">unique</span>(swr.st<span class="sc">$</span>State))<span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">5070</span>))<span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Place_Area =</span> ALAND<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(STATEFP,GEOID,NAME,Place_Area)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(places)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"GEOID_Place"</span>,<span class="st">"Place_Name"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>swr.st.place <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(swr.st,places)<span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Place_Intrsct_Area =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(.))<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pct_Place_in_S =</span> <span class="dv">100</span><span class="sc">*</span>(Place_Intrsct_Area<span class="sc">/</span>Place_Area),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pct_S_in_Place =</span> <span class="dv">100</span><span class="sc">*</span>(Place_Intrsct_Area<span class="sc">/</span>Swr_Area))<span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,Name,GEOID_Place,Place_Name,Place_Area,Place_Intrsct_Area,Pct_Place_in_S,Pct_S_in_Place)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="county-sub-divisions" class="level4">
<h4 class="anchored" data-anchor-id="county-sub-divisions">County Sub-Divisions</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># County subdivisions must be looped, as we can only pull one state at a time</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>swr.st.cntySub <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(st <span class="cf">in</span> <span class="fu">unique</span>(swr.st<span class="sc">$</span>State)){</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  st.filt <span class="ot">&lt;-</span> swr.st<span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(State <span class="sc">==</span> st)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  county.subs <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">county_subdivisions</span>(<span class="at">state =</span> st)<span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">5070</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Cnty_Sub_Area =</span> ALAND<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(STATEFP,COUNTYFP,GEOID,NAME,Cnty_Sub_Area)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(county.subs)[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"GEOID_Cnty_Sub"</span>,<span class="st">"Cnty_Sub_Name"</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  swr.st.cntysub.filt <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(st.filt,county.subs)<span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Cnty_Sub_Intrsct_Area =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(.))<span class="sc">/</span><span class="dv">1000000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Pct_CS_in_S =</span> <span class="dv">100</span><span class="sc">*</span>(Cnty_Sub_Intrsct_Area<span class="sc">/</span>Cnty_Sub_Area),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">Pct_S_in_CS =</span> <span class="dv">100</span><span class="sc">*</span>(Cnty_Sub_Intrsct_Area<span class="sc">/</span>Swr_Area))<span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ID,Name,STATEFP,COUNTYFP,GEOID_Cnty_Sub,Cnty_Sub_Name,Cnty_Sub_Area,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>           Cnty_Sub_Intrsct_Area,Pct_CS_in_S,Pct_S_in_CS)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  swr.st.cntySub <span class="ot">&lt;-</span> <span class="fu">rbind</span>(swr.st.cntySub,swr.st.cntysub.filt)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="detail-metrics" class="level4">
<h4 class="anchored" data-anchor-id="detail-metrics">Detail Metrics</h4>
<p>The number of polygons is a bit tricky. In some cases systems are combined into multipolygons whereas in other cases, the same system may be broken into separate rows for each polygon of the same system. For now, we’ll break multipolygons into polygons and re-aggregate everything by system name.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine polygons</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>polygons <span class="ot">&lt;-</span> swr.st<span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Count polygons</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>poly.count <span class="ot">&lt;-</span> polygons<span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Name)<span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">State =</span> State[<span class="dv">1</span>],</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">nParts =</span> <span class="fu">n</span>())</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Cast to lines and sum length</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>ss.lines <span class="ot">&lt;-</span> polygons<span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTILINESTRING"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Equidistant projection</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="st">"ESRI:53027"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Length =</span> <span class="fu">as.numeric</span>(<span class="fu">st_length</span>(.)))</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>bndry.length <span class="ot">&lt;-</span> ss.lines<span class="sc">%&gt;%</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Length_Km =</span> <span class="fu">sum</span>(Length)<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Cast to points and count number of vertices</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>ss.pts <span class="ot">&lt;-</span> ss.lines<span class="sc">%&gt;%</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"MULTIPOINT"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Vertices =</span> <span class="fu">n</span>())</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile descriptive dataset of sewersheds</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>ss.all <span class="ot">&lt;-</span> swr.st<span class="sc">%&gt;%</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ss.pts)<span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bndry.length)<span class="sc">%&gt;%</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poly.count)<span class="sc">%&gt;%</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pts_Km =</span> Vertices<span class="sc">/</span>Length_Km)<span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4326</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_valid</span>()</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ss.all, <span class="fu">here</span>(<span class="st">"Data/Validation/State_Sewersheds.gpkg"</span>),<span class="at">layer =</span> <span class="st">"Name_Combined_Sewersheds"</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Export related table</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>r.df <span class="ot">&lt;-</span> ss.all<span class="sc">%&gt;%</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>Name)<span class="sc">%&gt;%</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(swr.st.cntySub)<span class="sc">%&gt;%</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span>Name)<span class="sc">%&gt;%</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(swr.st.place)</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="fu">vroom_write</span>(r.df,<span class="fu">here</span>(<span class="st">"Data/Validation/Name_Combined_Related_Stats1.csv"</span>), <span class="at">delim =</span> <span class="st">","</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="breakdown-of-detail-findings" class="level3">
<h3 class="anchored" data-anchor-id="breakdown-of-detail-findings">Breakdown of Detail Findings</h3>
<p>After the data cleaning, we have 2,869 unique sewersheds.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ss.all)<span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> State), <span class="at">stat =</span> <span class="st">"count"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#a04bb8"</span>)<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Count of State Sewersheds"</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"# of Systems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/ssByState-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="number-of-disconnected-polygons" class="level4">
<h4 class="anchored" data-anchor-id="number-of-disconnected-polygons">Number of Disconnected Polygons</h4>
<p>This plot shows a histogram of how many disconnected parts each system has. The vast majority of systems are interconnected, which is what we would expect.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ss.all)<span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> nParts), <span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"#45abbf"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Count of Disconnected Areas"</span>,<span class="at">subtitle =</span> <span class="st">"(State Sewersheds)"</span>, <span class="at">x =</span> <span class="st">"# of Polygons"</span>, <span class="at">y =</span> <span class="st">"# of Systems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="boundary-detail" class="level4">
<h4 class="anchored" data-anchor-id="boundary-detail">Boundary Detail</h4>
<p>For each boundary, we calculated the number of vertices per kilometer of boundary. This can give us an indication of how detailed a boundary was created. We must use caution here however, because if a system boundary is identical to an administrative boundary, then we are only reviewing the level of detail of the administrative boundary. We can contextualize this problem by looking at administrative boundary overlap, which we do next.</p>
<p>Summary Statistics for <span class="math inline">\({Vertices/kilometer}\)</span>:</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ss.all<span class="sc">$</span>Pts_Km)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
  0.0693   6.7866  18.0990  32.2764  44.5000 590.1193 </code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ss.all)<span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pts_Km), <span class="at">fill =</span> <span class="st">"#63a843"</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Level of Boundary Detail"</span>, <span class="at">x =</span> <span class="st">"Vertices / Kilometer"</span>, <span class="at">y =</span> <span class="st">"# of Systems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/boundaryDetail-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="administrative-overlap" class="level4">
<h4 class="anchored" data-anchor-id="administrative-overlap">Administrative Overlap</h4>
<p>There are likely cases where sewersheds are in fact identical or very similar to administrative boundaries, such as a city or a town. However, we would hope to see more detail than an entire administrative boundary. For example, there are areas in almost every city or town that have no infrastructure at all, like farmland or undeveloped area. We intersected these state-sourced boundaries with county subdivisions and also with census places. We calculated the % of a boundary that is within these administrative boundaries and conversely, the % of the administrative boundaries within the sewersheds. If both of these values are close to 100%, then both boundaries are essentially identical.</p>
<p><strong>County Sub-Divisions</strong> The plot below shows a comparison of these areas, with the red box in the top-right illustrating sewersheds that are essentially identical to a county subdivision. Within that red box are 17 sewersheds (0.6% of systems)</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cs.ident <span class="ot">&lt;-</span> r.df<span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Cnty_Sub_Area<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,Pct_CS_in_S,Pct_S_in_CS)<span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pct_CS_in_S =</span> <span class="fu">ifelse</span>(Pct_CS_in_S<span class="sc">&gt;</span><span class="dv">100</span>,<span class="dv">100</span>,Pct_CS_in_S),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pct_S_in_CS =</span> <span class="fu">ifelse</span>(Pct_S_in_CS<span class="sc">&gt;</span><span class="dv">100</span>,<span class="dv">100</span>,Pct_S_in_CS))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cs.ident)<span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pct_CS_in_S, <span class="at">y =</span> Pct_S_in_CS), <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="dv">95</span>, <span class="at">xmax=</span><span class="dv">101</span>, <span class="at">ymin=</span> <span class="dv">95</span>, <span class="at">ymax =</span> <span class="dv">101</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"County Subdivision Overlap"</span>, <span class="at">x =</span> <span class="st">"% of County-Subdivision in Sewershed"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"% of Sewershed in County-Subdivision"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/cntySubIdent-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Census Places</strong> The plot below shows the same comparrison for census places. There are 106 sewersheds (3.7%) that have greater than 95% overlap with an intersecting census place.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>place.ident <span class="ot">&lt;-</span> r.df<span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Place_Area<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State,ID,Pct_Place_in_S,Pct_S_in_Place)<span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Pct_Place_in_S =</span> <span class="fu">ifelse</span>(Pct_Place_in_S<span class="sc">&gt;</span><span class="dv">100</span>,<span class="dv">100</span>,Pct_Place_in_S))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(place.ident)<span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pct_Place_in_S, <span class="at">y =</span> Pct_S_in_Place), <span class="at">alpha =</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">xmin =</span> <span class="dv">95</span>, <span class="at">xmax=</span><span class="dv">101</span>, <span class="at">ymin=</span> <span class="dv">95</span>, <span class="at">ymax =</span> <span class="dv">101</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Census Place Overlap"</span>, <span class="at">x =</span> <span class="st">"% of Census Place in Sewershed"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"% of Sewershed in Census Place"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/placeIdent-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In total, it seems as if the sewershed boundaries we have are largely <strong>not</strong> administrative boundaries. With respect to the other metrics we developed, we will need to do some deeper investigating using visual inspection to determine what constitutes a detailed boundary.</p>
</section>
</section>
</section>
<section id="joining-validation-boundaries-to-cwns-locations" class="level2">
<h2 class="anchored" data-anchor-id="joining-validation-boundaries-to-cwns-locations">Joining Validation Boundaries to CWNS Locations</h2>
<p>Now that we have a set of boundaries that refer to treatment systems, we need to compare the locations to the data we have from the CWNS. Here we investigate:</p>
<ul>
<li>How many systems do we have boundaries for?</li>
<li>How well do treatment plants match up to these boundaries?
<ul>
<li>Are there more than one treatment plant within any boundaries?</li>
<li>Are some treatment plants outside of the boundaries?</li>
<li>How well do the names match between the state datasets and the CWNS?</li>
</ul></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ep <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/endpoints.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Endpoints_LT50PCT_Q"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,FACILITY_NAME,STATE_CODE,RESIDENTIAL_POP_2022,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         TOTAL_RES_POPULATION_2022)<span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATE_CODE <span class="sc">%in%</span> ss.all<span class="sc">$</span>State)<span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(ss.all))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>ep.intrsct <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ep,ss.all)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>intrsct.df <span class="ot">&lt;-</span> ep.intrsct<span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Save intersection</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">vroom_write</span>(intrsct.df,<span class="fu">here</span>(<span class="st">"Data/Validation/CWNS_Intersection.csv"</span>), <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save list of validation endpoints</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ep,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>),<span class="at">layer =</span> <span class="st">"endpoints"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="number-of-systems-by-state-in-cwns" class="level3">
<h3 class="anchored" data-anchor-id="number-of-systems-by-state-in-cwns">Number of Systems by State in CWNS</h3>
<p>As a starting point, we need to compare the number of system boundaries we have for each state with the number of systems the CWNS lists in each state. In this plot, we would expect (hope) to have about the same number of each, or perhaps almost as many state boundaries as CWNS systems. There are 4 states, however, that have more state boundaries than CWNS systems. This could indicate a problem with how we aggregated the boundaries.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>intrsct.df <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/CWNS_Intersection.csv"</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ep <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>),<span class="at">layer =</span> <span class="st">"endpoints"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `endpoints' from data source 
  `D:\Github\Sewersheds\Data\Validation\Validation.gpkg' using driver `GPKG'
Simple feature collection with 3253 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -106.6111 ymin: 25.89772 xmax: -70.7403 ymax: 45.0498
Geodetic CRS:  WGS 84</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count of endpoints by state</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>state.ep <span class="ot">&lt;-</span> ep<span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STATE_CODE)<span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nSystems =</span> <span class="fu">n</span>())</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Count boundaries by state</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>state.ss.counts <span class="ot">&lt;-</span> ss.all<span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State)<span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Boundaries =</span> <span class="fu">n</span>())</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>count.compare <span class="ot">&lt;-</span> state.ep<span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(state.ss.counts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"STATE_CODE"</span><span class="ot">=</span><span class="st">"State"</span>))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(count.compare)<span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> nSystems, <span class="at">y =</span> STATE_CODE, <span class="at">fill =</span> <span class="st">"CWNS"</span>), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">just =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> Boundaries, <span class="at">y =</span> STATE_CODE, <span class="at">fill =</span> <span class="st">"State Boundaries"</span>), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">just =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"CWNS"</span><span class="ot">=</span><span class="st">"#3bd4ba"</span>,<span class="st">"State Boundaries"</span> <span class="ot">=</span> <span class="st">"#bf6a39"</span>))<span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"CWNS vs. State Boundary Counts"</span>, <span class="at">x =</span> <span class="st">"# of Systems"</span>, <span class="at">y =</span> <span class="st">"State"</span>, <span class="at">fill =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="system-matching-classification" class="level3">
<h3 class="anchored" data-anchor-id="system-matching-classification">System Matching Classification</h3>
<p>For each CWNS endpoint, we determine if it:</p>
<ul>
<li>intersected no boundary (0)</li>
<li>intersected a single boundary (1)</li>
<li>intersected multiple boundaries (2)</li>
</ul>
<p>The results of this are plotted below and show that many endpoints do not intersect any state boundaries. In this case, we need to conduct further analysis to include a distance buffer for boundaries with no intersecting endpoint.2</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>no.intrsct <span class="ot">&lt;-</span> ep<span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>CWNS_ID <span class="sc">%in%</span> intrsct.df<span class="sc">$</span>CWNS_ID)<span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWNS_ID,STATE_CODE)<span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nIntersections =</span> <span class="dv">0</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>i.count <span class="ot">&lt;-</span> intrsct.df<span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CWNS_ID)<span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">STATE_CODE =</span> STATE_CODE[<span class="dv">1</span>],</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">nIntersections =</span> <span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(no.intrsct)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(i.count)<span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> nIntersections))<span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"# Boundaries Intersected by Endpoints"</span>, <span class="at">x =</span> <span class="st">"State Boundaries"</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"CWNS Endpoints"</span>)<span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>STATE_CODE, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We then do the same for the state boundaries</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>no.intrsct <span class="ot">&lt;-</span> ss.all<span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>ID <span class="sc">%in%</span> intrsct.df<span class="sc">$</span>ID)<span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,State)<span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nIntersections =</span> <span class="dv">0</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>i.count <span class="ot">&lt;-</span> intrsct.df<span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID)<span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">State =</span> State[<span class="dv">1</span>],</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">nIntersections =</span> <span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(no.intrsct)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(i.count)<span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> nIntersections))<span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#scale_x_continuous(breaks = c(0,1,2))+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"# Endpoints Intersected by Boundaries"</span>, <span class="at">x =</span> <span class="st">"CWNS Endpoints"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"State Boundaries"</span>)<span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>State, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="selecting-the-validation-set" class="level2">
<h2 class="anchored" data-anchor-id="selecting-the-validation-set">Selecting the Validation Set</h2>
<p>To train the model, we need validation data. The validation data we use will dictate how the model behaves and ultimately how well it performs. It is important to remember that knowing where areas <strong>are not</strong> served by wastewater collection systems is just as important as knowing where areas are served. Therefore, we cannot use a an entire state for validation if it is missing a lot of service boundaries. In order to maximize our training set however, we can look at county level data. Our validation data will be composed of counties that have complete and accurate sewershed boundaries. To determine the universe of sewersheds for each county, we execute a spatial join between the endpoints from the CWNS and a county spatial file. We are assuming that endpoints are located within the counties they serve. To determine if a boundary is joined to the correct CWNS endpoint, we apply a multi-step score calculation which includes the following:</p>
<ul>
<li><p>Boundaries are spatially intersected with endpoints. For each match between a boundary and an endpoint, the total number of endpoints that intersect a boundary is divided by 1. For example, if only one endpoint exists within a boundary, the value would be 1. If 3 endpoints intersect a boundary, the value for all three matches (which are represented as three separate rows) would be 0.33. This score is labeled ‘I_Score’ or <span class="math inline">\(S_i\)</span></p></li>
<li><p>For boundaries that do not intersect any endpoints, a buffer is applied using a distance of 16 kilometers, which we have found to be the 95% confidence level for maximum distance between an endpoint and a serviced area (See ‘Analysis/Endpoint_Sewershed_Distance/Endpoint_Sewershed_Distance.html’ for more detailed information). Only endpoints that have not already been singularly intersected with boundaries are considered in this step. The distance of each endpoint from the edge of the boundary is divided by 16 and then subtracted from 1: <span class="math inline">\(D_{score}=1-(d/16)\)</span>, where ‘d’ is the distance in kilometers. This yields a score such that the closest endpoint will have the highest score. This score is labeled ‘D_Score’ or <span class="math inline">\(S_d\)</span>.</p></li>
<li><p>For each pair of matches (CWNS &lt;-&gt; State Boundary), we calculate a fuzzy score to compare the given names of the treatment works. A score of zero indicates that the names are completely dissimilar whereas a score of 1 indicates identical names. This score is labeled ‘F_Score’ or <span class="math inline">\(S_f\)</span>. The method we use is the ‘Jaro-Winkler’ distance:</p></li>
</ul>
<div class="line-block">“The Jaro-Winkler distance (method=jw, 0&lt;p&lt;=0.25) adds a correction term to the Jaro-distance. It is defined as d − l · p · d, where d is the Jaro-distance. Here, l is obtained by counting, from the start of the input strings, after how many characters the first character mismatch between the two strings occurs, with a maximum of four. The factor p is a ’prefix’ factor, which in the work of Winkler is often chosen 0.1.”</div>
<p>The Jaro-Winkler method uses 0 for identical and 1 for completely dissimilar. Therefore: <span class="math inline">\(S_f=1-D_{JW}\)</span> where <span class="math inline">\(D_{jw} =\)</span> Jaro-Winkler Distance</p>
<ul>
<li>Scores are aggregated to yield a match score.
<ul>
<li>If ‘I_Score’ is &gt; 0, then the formula we use is: <span class="math inline">\(S_m=S_i+S_f\)</span></li>
<li>If ‘I_Score’ = 0, we use the formula: <span class="math inline">\(S_m=S_d+S_f\)</span></li>
</ul></li>
</ul>
<p>This match score equally prioritizes the proximity of an endpoint with name matching between datasets. In the event that multiple endpoints intersect a boundary, greater weight is then given to name matching.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count boundaries in intersection</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>b.count <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(intrsct.df<span class="sc">$</span>ID))<span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"ID"</span>,<span class="st">"N_Endpoints"</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data frame of boundaries that intersect a single endpoint</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df.si <span class="ot">&lt;-</span> intrsct.df<span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(b.count)<span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I_Score =</span> <span class="dv">1</span><span class="sc">/</span>N_Endpoints)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset boundaries and endpoints that have not intersected eachother</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>b.subset <span class="ot">&lt;-</span> ss.all<span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>ID <span class="sc">%in%</span> df.si<span class="sc">$</span>ID)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>ep.subset <span class="ot">&lt;-</span> ep<span class="sc">%&gt;%</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>CWNS_ID <span class="sc">%in%</span> df.si<span class="sc">$</span>CWNS_ID)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Buffer the boundary subset by 16 kilometers</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>b.subset.buffer <span class="ot">&lt;-</span> b.subset<span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">16000</span>)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect the buffers with the endpoints</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>buf.intrsct <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ep.subset,b.subset.buffer)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over boundaries to measure distances to endpoints within 16 km</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>sf.sd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(id <span class="cf">in</span> <span class="fu">unique</span>(buf.intrsct<span class="sc">$</span>ID)){</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset a boundary</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  bndry.sub <span class="ot">&lt;-</span> b.subset<span class="sc">%&gt;%</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get list of CWNS endpoints that are within 16 km of that boundary</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  intrsct.sub <span class="ot">&lt;-</span> buf.intrsct<span class="sc">%&gt;%</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset the endpoints</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  ep.near <span class="ot">&lt;-</span> ep<span class="sc">%&gt;%</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(CWNS_ID <span class="sc">%in%</span> intrsct.sub<span class="sc">$</span>CWNS_ID)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate Distances</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>  newRows <span class="ot">&lt;-</span> ep.near<span class="sc">%&gt;%</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Dist_km =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(.,bndry.sub))<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">ID =</span> id,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">Name =</span> bndry.sub<span class="sc">$</span>Name)</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  sf.sd <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sf.sd,newRows)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>df.sd <span class="ot">&lt;-</span> sf.sd<span class="sc">%&gt;%</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">I_Score =</span> <span class="dv">0</span>,</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">D_Score =</span> <span class="dv">1</span><span class="sc">-</span>(Dist_km<span class="sc">/</span><span class="dv">16</span>))<span class="sc">%&gt;%</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,CWNS_ID,Name,FACILITY_NAME,I_Score,D_Score)<span class="sc">%&gt;%</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State_ID"</span>,<span class="st">"CWNS_ID"</span>,<span class="st">"State_Name"</span>,<span class="st">"CWNS_Name"</span>,<span class="st">"I_Score"</span>,<span class="st">"D_Score"</span>))</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringdist)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine datasets with calculated I_Score &amp; D_Score and compute string distance function.</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>df.sf <span class="ot">&lt;-</span> df.si<span class="sc">%&gt;%</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">D_Score =</span> <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,CWNS_ID,Name,FACILITY_NAME,I_Score,D_Score)<span class="sc">%&gt;%</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"State_ID"</span>,<span class="st">"CWNS_ID"</span>,<span class="st">"State_Name"</span>,<span class="st">"CWNS_Name"</span>,<span class="st">"I_Score"</span>,<span class="st">"D_Score"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(df.sd)<span class="sc">%&gt;%</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State_Name =</span> <span class="fu">tolower</span>(State_Name),</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>         <span class="at">CWNS_Name =</span> <span class="fu">tolower</span>(CWNS_Name),</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>         <span class="at">F_Score =</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">stringdist</span>(State_Name,CWNS_Name, <span class="at">method =</span> <span class="st">"jw"</span>,<span class="at">p=</span><span class="fl">0.1</span>))</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Match Score and select the highest score for each boundary</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>df.sm <span class="ot">&lt;-</span> df.sf<span class="sc">%&gt;%</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">M_Score =</span> <span class="fu">ifelse</span>(I_Score <span class="sc">&gt;</span> <span class="dv">0</span>, I_Score<span class="sc">+</span>F_Score,D_Score<span class="sc">+</span>F_Score))<span class="sc">%&gt;%</span></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State_ID)<span class="sc">%&gt;%</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(M_Score <span class="sc">==</span> <span class="fu">max</span>(M_Score))<span class="sc">%&gt;%</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Duplicates =</span> <span class="fu">ifelse</span>(<span class="fu">n</span>()<span class="sc">&gt;</span><span class="dv">1</span>,<span class="cn">TRUE</span>,<span class="cn">FALSE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Save files</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="fu">vroom_write</span>(df.si,<span class="fu">here</span>(<span class="st">"Data/Validation/I_Scores.csv"</span>), <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a><span class="fu">vroom_write</span>(df.sd,<span class="fu">here</span>(<span class="st">"Data/Validation/D_Scores.csv"</span>), <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="fu">vroom_write</span>(df.sf,<span class="fu">here</span>(<span class="st">"Data/Validation/F_Scores.csv"</span>), <span class="at">delim =</span> <span class="st">","</span>)</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="fu">vroom_write</span>(df.sm,<span class="fu">here</span>(<span class="st">"Data/Validation/M_Scores.csv"</span>), <span class="at">delim =</span> <span class="st">","</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="match-results" class="level3">
<h3 class="anchored" data-anchor-id="match-results">Match Results</h3>
<p>The final count of state boundaries we were able to match to the CWNS was 2,552. 1,303 state boundaries intersected at least one CWNS endpoint. 1,283 boundaries did not directly intersect a CWNS endpoint, but were within 16 kilometers of 1. After calculating the total match score, there were 4 boundaries that had the exact same score relating to two separate CWNS endpoints.</p>
<section id="histogram-of-intersect-scores" class="level4">
<h4 class="anchored" data-anchor-id="histogram-of-intersect-scores">Histogram of Intersect Scores</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.si <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/I_Scores.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df.sd <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/D_Scores.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df.sf <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/F_Scores.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df.sm <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/M_Scores.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.si)<span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> I_Score, <span class="at">fill =</span> STATE_CODE))<span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"I_Score"</span>, <span class="at">y =</span> <span class="st">"# of State Boundaries"</span>, <span class="at">fill =</span> <span class="st">"State"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="histogram-of-distance-scores" class="level4">
<h4 class="anchored" data-anchor-id="histogram-of-distance-scores">Histogram of Distance Scores</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">500</span>,<span class="dv">500</span>), <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Farther"</span>,<span class="st">"Closer"</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.sd)<span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> D_Score, <span class="at">fill =</span> <span class="fu">substr</span>(State_ID,<span class="dv">1</span>,<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.2</span>, <span class="at">y =</span> <span class="dv">500</span>, <span class="at">xend =</span> <span class="fl">0.8</span>, <span class="at">yend =</span> <span class="dv">500</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>)),<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> labs, <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">label=</span>label))<span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"D_Score"</span>, <span class="at">y =</span> <span class="st">"# of State Boundaries"</span>, <span class="at">fill =</span> <span class="st">"State"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="histogram-of-string-distance-scores" class="level4">
<h4 class="anchored" data-anchor-id="histogram-of-string-distance-scores">Histogram of String Distance Scores</h4>
<p>The following histogram illustrates every F_Score returned from all possible matches.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.sf)<span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> F_Score, <span class="at">fill =</span> <span class="fu">substr</span>(State_ID,<span class="dv">1</span>,<span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="high-scores" class="level4">
<h4 class="anchored" data-anchor-id="high-scores">High Scores</h4>
<p><strong>Total Match Score</strong></p>
<p>The following plots illustrate only the scores that were used to find the highest match score for each state boundary.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.sm)<span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> M_Score, <span class="at">fill =</span> <span class="fu">substr</span>(State_ID,<span class="dv">1</span>,<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"State"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Composition of Scores</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df.sm)<span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> I_Score, <span class="at">y =</span> F_Score, <span class="at">fill =</span> M_Score, <span class="at">shape =</span> <span class="st">"I_Score"</span>))<span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> D_Score, <span class="at">y =</span> F_Score, <span class="at">fill =</span> M_Score, <span class="at">shape =</span> <span class="st">"D_Score"</span>))<span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()<span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"I_Score"</span><span class="ot">=</span><span class="dv">21</span>,<span class="st">"D_Score"</span><span class="ot">=</span><span class="dv">23</span>))<span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.01</span>,<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Intersection / Distance Component"</span>, <span class="at">y =</span> <span class="st">"String Distance Component"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="select-validation-counties" class="level3">
<h3 class="anchored" data-anchor-id="select-validation-counties">Select Validation Counties</h3>
<p>Here, we define the universe of systems for each county in the 10 states we have boundaries for, then determine the counties for which we have 100% data. From there, we will investigate the match scores by county. We want to make sure we have enough counties for model training while also maximizing the match scores within those counties.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect endpoints with counties</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fips <span class="ot">&lt;-</span> <span class="fu">select</span>(tigris<span class="sc">::</span>fips_codes,state_code,state)<span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">counties</span>()<span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(fips, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"STATEFP"</span><span class="ot">=</span><span class="st">"state_code"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> ss.all<span class="sc">$</span>State)<span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(ep))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect endpoints with counties</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>cnty.ep.intrsct <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ep,counties)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect boundaries with counties</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>cnty.bndry.intrsct <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(ss.all,counties)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Count systems by county</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>cnty.counts <span class="ot">&lt;-</span> cnty.ep.intrsct<span class="sc">%&gt;%</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STATEFP,COUNTYFP)<span class="sc">%&gt;%</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">State =</span> STATE_CODE[<span class="dv">1</span>],</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">nSystems =</span> <span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of matched systems by county</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>cnty.match.counts <span class="ot">&lt;-</span> cnty.ep.intrsct<span class="sc">%&gt;%</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CWNS_ID <span class="sc">%in%</span> df.sm<span class="sc">$</span>CWNS_ID)<span class="sc">%&gt;%</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STATEFP,COUNTYFP)<span class="sc">%&gt;%</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">nMatches =</span> <span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>cnty.compare <span class="ot">&lt;-</span> counties<span class="sc">%&gt;%</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(STATEFP,COUNTYFP,NAME)<span class="sc">%&gt;%</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cnty.counts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"STATEFP"</span>,<span class="st">"COUNTYFP"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cnty.match.counts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"STATEFP"</span>,<span class="st">"COUNTYFP"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nMatches =</span> <span class="fu">replace_na</span>(nMatches,<span class="dv">0</span>),</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">Pct_Matched =</span> <span class="dv">100</span><span class="sc">*</span>(nMatches<span class="sc">/</span>nSystems),</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">nClass =</span> <span class="fu">ifelse</span>(nSystems <span class="sc">==</span><span class="dv">1</span>,<span class="st">"1"</span>,</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(nSystems<span class="sc">&lt;</span><span class="dv">5</span>,<span class="st">"2-4"</span>,</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(nSystems <span class="sc">&lt;</span> <span class="dv">10</span>,<span class="st">"5-9"</span>,<span class="st">"10+"</span>))))</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(cnty.compare,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"County_Compare"</span>)</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(cnty.ep.intrsct,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"County_EP_Intersect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="count-of-cwns-systems-by-county" class="level4">
<h4 class="anchored" data-anchor-id="count-of-cwns-systems-by-county">Count of CWNS Systems by County</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>cnty.compare <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"County_Compare"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `County_Compare' from data source 
  `D:\Github\Sewersheds\Data\Validation\Validation.gpkg' using driver `GPKG'
Simple feature collection with 554 features and 8 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -106.6456 ymin: 25.83716 xmax: -70.57509 ymax: 45.30578
Geodetic CRS:  WGS 84</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cnty.ep.intrsct <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"County_EP_Intersect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `County_EP_Intersect' from data source 
  `D:\Github\Sewersheds\Data\Validation\Validation.gpkg' using driver `GPKG'
Simple feature collection with 3251 features and 23 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -106.6111 ymin: 25.89772 xmax: -70.7403 ymax: 45.0498
Geodetic CRS:  WGS 84</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cnty.compare)<span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">fct_reorder</span>(nClass,nSystems)))<span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"1"</span><span class="ot">=</span><span class="st">"#feebe2"</span>,<span class="st">"2-4"</span> <span class="ot">=</span> <span class="st">"#fbb4b9"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5-9"</span><span class="ot">=</span><span class="st">"#f768a1"</span>,<span class="st">"10+"</span><span class="ot">=</span><span class="st">"#ae017e"</span>))<span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"# CWNS Systems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="percent-of-systems-matched-by-county" class="level4">
<h4 class="anchored" data-anchor-id="percent-of-systems-matched-by-county">Percent of Systems Matched by County</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cnty.compare)<span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Pct_Matched))<span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()<span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"% Matched Systems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cnty.compare)<span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> Pct_Matched), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#5e88cc"</span>,<span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Percent Matched by County"</span>, <span class="at">x =</span> <span class="st">"% Matched"</span>, <span class="at">y =</span> <span class="st">"# of Systems"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="match-scores-in-100-complete-counties" class="level4">
<h4 class="anchored" data-anchor-id="match-scores-in-100-complete-counties">Match Scores in 100% Complete Counties</h4>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset counties that are 100% Complete</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>complete.counties <span class="ot">&lt;-</span> cnty.compare<span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Pct_Matched <span class="sc">==</span> <span class="dv">100</span>)<span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ST_CNTY =</span> <span class="fu">paste0</span>(STATEFP,COUNTYFP))</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset matches by complete counties</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>ep.cmplt <span class="ot">&lt;-</span> cnty.ep.intrsct<span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ST_CNTY =</span> <span class="fu">paste0</span>(STATEFP,COUNTYFP))<span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ST_CNTY <span class="sc">%in%</span> complete.counties<span class="sc">$</span>ST_CNTY)<span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df.sm, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CWNS_ID"</span>))</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ep.cmplt)<span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> M_Score), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Match Scores for Systems in 100% Complete Counties"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate mean match score by county in 100% complete counties</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>pctScore.county <span class="ot">&lt;-</span> ep.cmplt<span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ST_CNTY)<span class="sc">%&gt;%</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Mean_Score =</span> <span class="fu">mean</span>(M_Score))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>cnty.scores <span class="ot">&lt;-</span> cnty.compare<span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ST_CNTY =</span> <span class="fu">paste0</span>(STATEFP,COUNTYFP))<span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pctScore.county)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cnty.scores)<span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Mean_Score))<span class="sc">+</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="final-selection" class="level4">
<h4 class="anchored" data-anchor-id="final-selection">Final Selection</h4>
<p>Using the information we have developed for the systems and counties described here, we select counties that have 100% of their systems succesfully matched and require that the average of all scores within each county be at least 1.5. This leaves us with 107 counties, containing a total of 482 sewersheds. These can now be visually inspected to verify detail and matching.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>final.counties.filt <span class="ot">&lt;-</span> cnty.scores<span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Mean_Score <span class="sc">&gt;=</span> <span class="fl">1.5</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get county populations</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>cnty.pops <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Data/nhgis/nhgis0347_ds262_20225_county.csv"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ST_CNTY =</span> <span class="fu">paste0</span>(STATEA,COUNTYA))<span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ST_CNTY,AQNFE001)<span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"ST_CNTY"</span>,<span class="st">"Population"</span>))</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Join county fips to boundaries</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>cnty.boundaries <span class="ot">&lt;-</span> counties<span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ST_CNTY =</span> <span class="fu">paste0</span>(STATEFP,COUNTYFP))<span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ST_CNTY,state,NAMELSAD)<span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cnty.pops)<span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ST_CNTY <span class="sc">%in%</span> final.counties.filt<span class="sc">$</span>ST_CNTY)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(cnty.boundaries,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Counties_FR"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(cnty.boundaries,<span class="fu">here</span>(<span class="st">"Inspect_Validation/Data/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Counties_FR"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial file of validation endpoints</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Include endpoints in &lt; 100% counties whose matched boundaries extend into 100% boundaries</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>cnty.ep.overflow <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Inspect_Validation/Data/County_Boundaries.csv"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> final.counties.filt<span class="sc">$</span>ST_CNTY)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>final.ep.filt <span class="ot">&lt;-</span> ep.cmplt<span class="sc">%&gt;%</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ST_CNTY <span class="sc">%in%</span> final.counties.filt<span class="sc">$</span>ST_CNTY <span class="sc">|</span> State_ID <span class="sc">%in%</span> cnty.ep.overflow<span class="sc">$</span>ID)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(final.ep.filt,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Endpoints_FR"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(final.ep.filt,<span class="fu">here</span>(<span class="st">"Inspect_Validation/Data/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Endpoints_FR"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Include boundaries that overlap 100% counties, even if their endpoints are in another county (this is important for validation)</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>bndry.cnty.intersection <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Inspect_Validation/Data/County_Boundaries.csv"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> final.ep.filt<span class="sc">$</span>ST_CNTY)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial file of validation boundaries</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>final.sb <span class="ot">&lt;-</span> ss.all<span class="sc">%&gt;%</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">%in%</span> final.ep.filt<span class="sc">$</span>State_ID <span class="sc">|</span> ID <span class="sc">%in%</span> bndry.cnty.intersection<span class="sc">$</span>ID)</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(final.sb,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Boundaries_FR"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(final.sb,<span class="fu">here</span>(<span class="st">"Inspect_Validation/Data/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Boundaries_FR"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="co"># save endpoints that were not matched</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>ep.nomatch <span class="ot">&lt;-</span> cnty.ep.intrsct<span class="sc">%&gt;%</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>CWNS_ID <span class="sc">%in%</span> final.ep.filt<span class="sc">$</span>CWNS_ID)</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ep.nomatch,<span class="fu">here</span>(<span class="st">"Data/Validation/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Endpoints_NoMatch"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(ep.nomatch,<span class="fu">here</span>(<span class="st">"Inspect_Validation/Data/Validation.gpkg"</span>), <span class="at">layer =</span> <span class="st">"Validation_Endpoints_NoMatch"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="review-of-validation-data" class="level3">
<h3 class="anchored" data-anchor-id="review-of-validation-data">Review of Validation Data</h3>
<p>The 107 counties selected as potential validation areas were put into an interactive web application for review by the research team. Researchers used the application to view each county one at a time to determine if the boundaries were accurate and if the endpoints were correctly matched. The application allowed for the following:</p>
<ul>
<li>View Match Scores</li>
<li>View Boundary Detail</li>
<li>View Endpoint Locations</li>
<li>Write Notes on Each County</li>
<li>Select Common Errors</li>
<li>Flag a County for Further Review</li>
<li>Review Decisions Made by Team Members</li>
</ul>
<p><img src="img/App_1.png" class="img-fluid"> <img src="img/App_2.png" class="img-fluid"></p>
<p>Upon review by the research team, all counties that were unanimously decided to be accurate were selected for the final validation dataset. Counties where there was disagreement among research team members were discussed by the team as a whole and a final decision was made. In total, 49 counties were selected for the final validation dataset.</p>
</section>
<section id="endpoint-location-review" class="level3">
<h3 class="anchored" data-anchor-id="endpoint-location-review">Endpoint Location Review</h3>
<p>As part of the review process, if an endpoint was determined to be mismatched or in an incorrect location, attempts were made to re-locate the endpoint. This was done by examining the endpoint’s name and location in the CWNS dataset and then either performing a web search to find the correct location, or by comparing with data from Open Street Map (OSM). OSM maintains a classification of feature called ‘Man Made - Wastewater Plant’, which can have user-provided names attached to the feature. For more information, refer to the notebook located at ‘Analysis/OSM/OSM_Data/html’. If the facility was found, the location was recorded and the endpoint was moved to that location. If the facility was not found, the endpoint was removed from the dataset. In total, 8 endpoints were re-located.</p>
</section>
</section>
<section id="development-of-input-data" class="level1">
<h1>Development of Input Data</h1>
<p>The random forest model requires several input datasets, which will provide contextual information to help it determine of an area is served by a public wastewater collection system, and which collection system it is served by. These data must be prepared to conform to our output geospatial data, which are level 9 H3 hexagons. The hexagons are roughly 0.1 km<sup>2</sup> in area. Here, we describe each input dataset and how it was developed to conform to the hexagon grid.</p>
<section id="census-data" class="level2">
<h2 class="anchored" data-anchor-id="census-data">1990 Census Data</h2>
<p>Data included from the 1990 census includes total population and housing units (1990 Census: STF 1 - 100% Data); estimated number of housing units on public sewer and estimated number housing units on public water (1990 Census: STF 3 - Sample-Based Data).</p>
<p>1990 Census data was cross-walked to 2020 boundaries using the cascade weighting method described in Murray &amp; Hall (2024) and the block-to-block crosswalks published by the <a href="https://www.nhgis.org/geographic-crosswalks#from-blocks">IPUMS</a>. Once cross-walked, the data was included with the 2020 Census data described in the next step.</p>
</section>
<section id="census-data-1" class="level2">
<h2 class="anchored" data-anchor-id="census-data-1">2020 Census Data</h2>
<p>2020 Census data included 100% counts at the census block level for population, housing units and count of urban/rural population. To convert census blocks into hexagons, a building weighted calculation was performed. Microsoft building footprints larger than 40 square meters (about the size of a detached 2-car garage) were intersected with both hexagons and census blocks. The percent of buildings within each block were calculated for each hexagon and used to weight census data into hexagon parts. Hexagon parts, which were subdivided by census blocks were then re-aggregated to complete hexagons using the H3 Index for each. This yields estimated Census counts at the hexagon level.</p>
</section>
<section id="building-footprints" class="level2">
<h2 class="anchored" data-anchor-id="building-footprints">Building Footprints</h2>
<p>When the previous step of weighting census data was performed and buildings were intersected with hexagons, a table was saved that included one row for every building, along with its associated hexagon, total area in km<sup>2</sup> and its height as estimated by <a href="https://github.com/microsoft/GlobalMLBuildingFootprints">Microsoft</a>. Further predictive variables were derived from these data including:</p>
<ul>
<li>Mean building area</li>
<li>Median building area</li>
<li>Count of buildings</li>
<li>Mean building height</li>
<li>Median building height</li>
<li>Maximum building height</li>
</ul>
<p>For buildings where height was not available, we applied a value of 4.5 meters, which is roughly the height of a one-story building with a roof.</p>
</section>
<section id="land-cover-land-use" class="level2">
<h2 class="anchored" data-anchor-id="land-cover-land-use">Land Cover / Land Use</h2>
<p>The National Land Cover Database was used to derive characteristics for each hexagon. Data was obtained in raster format from <a href="https://www.mrlc.gov/">MRLC</a> and pixels were extracted to each hexagon. We determined the mode (maximum frequency) of each land cover type within each hexagon.</p>
<p>We also derived impervious surface using the median and mean impervious surface percentage within each hexagon.</p>
</section>
<section id="road-networks" class="level2">
<h2 class="anchored" data-anchor-id="road-networks">Road Networks</h2>
<p>Variables for roads were derived from the <a href="https://www.openstreetmap.org/">OSM</a> dataset. For each hexagon, we extracted OSM ‘highways’ which include the following classifications:</p>
<ul>
<li>motorway</li>
<li>trunk</li>
<li>primary</li>
<li>secondary</li>
<li>tertiary</li>
<li>residential</li>
<li>unclassified</li>
</ul>
<p>For detailed information on what each class represents, please see <a href="https://wiki.openstreetmap.org/wiki/Key:highway">OSM key:highway</a>.</p>
<p>We calculated the total road distance within each hexagon in meters.</p>
</section>
<section id="distance-and-neighborhood-metrics" class="level2">
<h2 class="anchored" data-anchor-id="distance-and-neighborhood-metrics">Distance and Neighborhood Metrics</h2>
<p>One of the reasons we are using H3 hexagons is because their shape allows for quick and efficient neighborhood or traversal calculations. Hexagons are superior to squares because they have more directional options and given the derived input variables we have already created, it becomes easy to quickly determine information about the surrounding area. For example, when calculating distance to the nearest treatment plant, we can navigate using a simplified road network via the hexagons. This allows the model to have a better understanding of distance to the nearest treatment plant and prevents the model from assuming that a sewer network passes through undeveloped areas or areas of water.</p>
<ul>
<li>Multiple levels (1-3 hexagon neighborhoods)
<ul>
<li>Did sewer exist in 1990?</li>
<li>Population Density</li>
<li>Buildings</li>
<li>NLCD</li>
</ul></li>
</ul>
</section>
<section id="determining-maximum-search-distance" class="level2">
<h2 class="anchored" data-anchor-id="determining-maximum-search-distance">Determining Maximum Search Distance</h2>
<p>To conserve computation time, we restrict the hexagons we consider for sewersheds based on an analysis of maximum distance for sewer served areas from associated treatment endpoints. For detailed information, refer to ‘Analysis/Endpoint_Sewershed_Distance/Endpoint_Sewershed_Distance.html’. The following code was used to determine the maximum search distance (in hexagons) for our hexagons. We found a k_ring distance (radius) of 90 hexagons to equal a radius of 32.1 kilometers, which equals the 99th percentile of maximum distance found in our analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a hexagon for the center point of UTM Zone 17N (minimizes distortion)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">geometry =</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">1326954.01</span>,<span class="fl">6505062.6</span>)), <span class="at">crs =</span> <span class="dv">26917</span>))<span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>cp.coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(cp)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>hex.id <span class="ot">&lt;-</span> <span class="fu">geo_to_h3</span>(<span class="fu">c</span>(<span class="fl">55.135</span>, <span class="sc">-</span><span class="fl">110.14</span>), <span class="dv">9</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over radii to determine value closest to 32 km.</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>radius.dists <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">85</span>,<span class="dv">95</span>)){</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get neighbors</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  neighbors <span class="ot">&lt;-</span> <span class="fu">k_ring</span>(hex.id, <span class="at">radius =</span> n)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get sf hexagons and project to UTM 17N then summarize</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  neighbors.sf <span class="ot">&lt;-</span> <span class="fu">h3_to_geo_boundary_sf</span>(neighbors)<span class="sc">%&gt;%</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">26917</span>))<span class="sc">%&gt;%</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_make_valid</span>()</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get bounding box</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(neighbors.sf)</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  height <span class="ot">&lt;-</span> (bb<span class="sc">$</span>ymax <span class="sc">-</span> bb<span class="sc">$</span>ymin)<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  width <span class="ot">&lt;-</span> (bb<span class="sc">$</span>xmax <span class="sc">-</span> bb<span class="sc">$</span>xmin)<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  radius <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(height, width))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  newRow <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">K_Ring =</span> n, <span class="at">Radius_km =</span> radius)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  radius.dists <span class="ot">&lt;-</span> <span class="fu">rbind</span>(radius.dists, newRow)</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Completed "</span>,n))</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(radius.dists, <span class="fu">here</span>(<span class="st">"Documentation/Data/Radius_Distances.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(radius.dists, <span class="fu">aes</span>(<span class="at">x =</span> K_Ring, <span class="at">y =</span> Radius_km))<span class="sc">+</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">32</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">85</span>,<span class="dv">95</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Radius of H3 Hexagons vs. K-Ring"</span>,</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"K-Ring"</span>,</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Radius (km)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/radiusPlot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="h3-navigation-example" class="level3">
<h3 class="anchored" data-anchor-id="h3-navigation-example">H3 Navigation Example</h3>
<p>By extracting the roads to each hexagon, we can start to classify based on road type to give us a more accurate view of how sewers move through towns and cities. For example, we know that sewers usually follow road networks, but are less likely to follow certain road types such as interstate highways and dirt roads. In the first map below, we can see an example of an area in New York with hexagons classified by their most major road type (ignoring interstates and unclassified roads). Imagine the green point represents a home served by sewer and the red dot represents the treatment plant. We can see a straight line distance between the two points travels through undeveloped area.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Nav Points</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>s.coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span> <span class="sc">-</span><span class="fl">72.5850351</span>,<span class="at">y=</span><span class="fl">42.8359840</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(s.coords,<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>),<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>e.coords <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span> <span class="sc">-</span><span class="fl">72.5492016</span>,<span class="at">y=</span><span class="fl">42.8410302</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(e.coords,<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>),<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create line connecting points</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>line <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">as.matrix</span>(<span class="fu">rbind</span>(s.coords,e.coords))), <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get hexagons for area</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(line)<span class="sc">%&gt;%</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">5070</span>))<span class="sc">%&gt;%</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">2000</span>)<span class="sc">%&gt;%</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_make_grid</span>(<span class="dv">100</span>)<span class="sc">%&gt;%</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">4326</span>))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>hex.ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(h3<span class="sc">::</span><span class="fu">geo_to_h3</span>(<span class="fu">st_sf</span>(area), <span class="dv">9</span>))</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>hex <span class="ot">&lt;-</span> h3<span class="sc">::</span><span class="fu">h3_to_geo_boundary_sf</span>(hex.ids)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Download Roads from osm</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(hex)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>hwy <span class="ot">&lt;-</span> bb<span class="sc">%&gt;%</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opq</span>()<span class="sc">%&gt;%</span></span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">'highway'</span>, <span class="at">value =</span> <span class="fu">c</span>(<span class="st">"trunk"</span>,<span class="st">"primary"</span>,<span class="st">"secondary"</span>,<span class="st">"tertiary"</span>,<span class="st">"residential"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>hwy.lines <span class="ot">&lt;-</span> <span class="fu">select</span>(hwy<span class="sc">$</span>osm_lines,osm_id,highway)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Intersect highways with hexagons then convert to equidistant projection and calculate length</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>hwy.hex <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(hwy.lines,hex)<span class="sc">%&gt;%</span></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">5070</span>))<span class="sc">%&gt;%</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">st_length</span>(.))</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="co"># reclassify highway types as numeric with motorway = 1, trunk = 2, etc.</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>hwy.hex.class <span class="ot">&lt;-</span> hwy.hex<span class="sc">%&gt;%</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">highway_Val =</span> <span class="fu">case_when</span>(highway <span class="sc">==</span> <span class="st">"trunk"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>                             highway <span class="sc">==</span> <span class="st">"primary"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>                             highway <span class="sc">==</span> <span class="st">"secondary"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>                             highway <span class="sc">==</span> <span class="st">"tertiary"</span> <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>                             highway <span class="sc">==</span> <span class="st">"residential"</span> <span class="sc">~</span> <span class="dv">5</span>),</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">highway =</span> <span class="fu">factor</span>(highway, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"trunk"</span>,<span class="st">"primary"</span>,<span class="st">"secondary"</span>,<span class="st">"tertiary"</span>,<span class="st">"residential"</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(h3_index,highway,highway_Val)<span class="sc">%&gt;%</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(h3_index)<span class="sc">%&gt;%</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(highway_Val <span class="sc">==</span> <span class="fu">min</span>(highway_Val))<span class="sc">%&gt;%</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>hex.hwy <span class="ot">&lt;-</span> hex<span class="sc">%&gt;%</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hwy.hex.class, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"h3_index"</span> <span class="ot">=</span> <span class="st">"h3_index"</span>))</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data for quick rendering</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(hex.hwy,<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"hex_hwy"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(start,<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"start"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(end,<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"end"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(line,<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"line"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>hex.hwy <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"hex_hwy"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"start"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"end"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>line <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"line"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create highway palette</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>f.pal <span class="ot">&lt;-</span> <span class="fu">colorFactor</span>(</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span><span class="fu">heat.colors</span>(<span class="dv">5</span>,<span class="at">rev=</span><span class="cn">TRUE</span>),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> hex.hwy<span class="sc">$</span>highway)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>()<span class="sc">%&gt;%</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"Esri.WorldImagery"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">data =</span> hex.hwy, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>,<span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">f.pal</span>(highway), <span class="at">fillOpacity =</span> <span class="fl">0.6</span>)<span class="sc">%&gt;%</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data =</span> start, <span class="at">fillColor =</span> <span class="st">"green"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">fillOpacity =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data =</span> end, <span class="at">fillColor =</span> <span class="st">"red"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">fillOpacity =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolylines</span>(<span class="at">data =</span> line, <span class="at">color =</span> <span class="st">"#27d8db"</span>,<span class="at">weight =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(<span class="st">"bottomright"</span>, <span class="at">pal =</span> f.pal, <span class="at">values =</span> hex.hwy<span class="sc">$</span>highway,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">"Road Type"</span>,<span class="at">opacity =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-13fb821dab1416380b9c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-13fb821dab1416380b9c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[-72.59607459089516,-72.59829986318871,-72.59828217104909,-72.59603938190702,-72.59381419859176,-72.59383171544039,-72.59607459089516],"lat":[42.8266508387449,42.8257184690383,42.82391464800677,42.82304319907096,42.82397549929459,42.82577931793401,42.8266508387449]}]],[[{"lng":[-72.5916063602406,-72.59383171544039,-72.59381419859176,-72.59157150183388,-72.58934623563603,-72.58936357719421,-72.5916063602406],"lat":[42.82671159945647,42.82577931793401,42.82397549929459,42.82310396458122,42.82403617662833,42.82583999286114,42.82671159945647]}]],[[{"lng":[-72.58713813911562,-72.58936357719421,-72.58934623563603,-72.58710363128927,-72.58487828223623,-72.5848954485045,-72.58713813911562],"lat":[42.82677218619276,42.82583999286114,42.82403617662833,42.82316455614513,42.82409668000899,42.82590049382079,42.82677218619276]}]],[[{"lng":[-72.58487828223623,-72.58710363128927,-72.58708637940644,-72.58484395373968,-72.58261869371366,-72.58263577032747,-72.58487828223623],"lat":[42.82409668000899,42.82316455614513,42.8213607955005,42.82048916114475,42.82142121554713,42.82322497376372,42.82409668000899]}]],[[{"lng":[-72.58266992757453,-72.5848954485045,-72.58487828223623,-72.58263577032747,-72.58041033844667,-72.58042732942556,-72.58266992757453],"lat":[42.82683259895483,42.82590049382079,42.82409668000899,42.82322497376372,42.82415700943761,42.82596082081392,42.82683259895483]}]],[[{"lng":[-72.58041033844667,-72.58263577032747,-72.58261869371366,-72.58037636048761,-72.57815101765742,-72.57816791900278,-72.58041033844667],"lat":[42.82415700943761,42.82322497376372,42.82142121554713,42.82054949544392,42.82148146166394,42.82328521743804,42.82415700943761]}]],[[{"lng":[-72.57594240432164,-72.57816791900278,-72.57815101765742,-72.57590877689896,-72.57368335129206,-72.57370007736949,-72.57594240432164],"lat":[42.82421716491525,42.82328521743804,42.82148146166394,42.82060965582102,42.82154153385197,42.82334528716913,42.82421716491525]}]],[[{"lng":[-72.57368335129206,-72.57590877689896,-72.57589196516604,-72.57364990307332,-72.57142456654212,-72.57144120302804,-72.57368335129206],"lat":[42.82154153385197,42.82060965582102,42.81880595565813,42.81793413598714,42.81886594457815,42.8206696422771,42.82154153385197]}]],[[{"lng":[-72.57147447991548,-72.57370007736949,-72.57368335129206,-72.57144120302804,-72.56921569467187,-72.56923224548196,-72.57147447991548],"lat":[42.82427714644295,42.82334528716913,42.82154153385197,42.8206696422771,42.82160143211227,42.82340518295801,42.82427714644295]}]],[[{"lng":[-72.56921569467187,-72.57144120302804,-72.57142456654212,-72.56918259694656,-72.56695717768967,-72.56697363892917,-72.56921569467187],"lat":[42.82160143211227,42.8206696422771,42.81886594457815,42.81799403918983,42.81892575959267,42.8207294548132,42.82160143211227]}]],[[{"lng":[-72.56700656528245,-72.56923224548196,-72.56921569467187,-72.56697363892917,-72.56474804785113,-72.56476442339444,-72.56700656528245],"lat":[42.82433695402178,42.82340518295801,42.82160143211227,42.8207294548132,42.82166115644591,42.82346490480577,42.82433695402178]}]],[[{"lng":[-72.56474804785113,-72.56697363892917,-72.56695717768967,-72.56471530061815,-72.56248979866299,-72.5625060846566,-72.56474804785113],"lat":[42.82166115644591,42.8207294548132,42.81892575959267,42.81805376849474,42.81898540070273,42.82078909343038,42.82166115644591]}]],[[{"lng":[-72.56028041088415,-72.5625060846566,-72.56248979866299,-72.56024801414233,-72.55802242951634,-72.55803854026466,-72.56028041088415],"lat":[42.82172070685392,42.82078909343038,42.81898540070273,42.81811332390295,42.81904486790938,42.82084855812973,42.82172070685392]}]],[[{"lng":[-72.55802242951634,-72.56024801414233,-72.56023181767732,-72.55799021181083,-72.55576471633277,-72.5557807375734,-72.55802242951634],"lat":[42.81904486790938,42.81811332390295,42.81630968681648,42.81543759624775,42.81636907084339,42.81817270541554,42.81904486790938]}]],[[{"lng":[-72.5558127838252,-72.55803854026466,-72.55802242951634,-72.5557807375734,-72.55355507030401,-72.55357100580761,-72.5558127838252],"lat":[42.82178008333742,42.82084855812973,42.81904486790938,42.81817270541554,42.81910416121373,42.82090784891228,42.82178008333742]}]],[[{"lng":[-72.55355507030401,-72.5557807375734,-72.55576471633277,-72.55352320304668,-72.5512976249488,-72.55131347096564,-72.55355507030401],"lat":[42.81910416121373,42.81817270541554,42.81636907084339,42.81549689459519,42.81642828099019,42.81823191303359,42.81910416121373]}]],[[{"lng":[-72.54908772108028,-72.55131347096564,-72.5512976249488,-72.54905620426995,-72.54683054357969,-72.54684621437332,-72.54908772108028],"lat":[42.81916328061683,42.81823191303359,42.81642828099019,42.81555601907029,42.81648731725798,42.81829094675814,42.81916328061683]}]],[[{"lng":[-72.59386675326094,-72.59609219746115,-72.59607459089516,-72.59383171544039,-72.5916063602406,-72.59162379149524,-72.59386675326094],"lat":[42.82938706396065,42.8284547129565,42.8266508387449,42.82577931793401,42.82671159945647,42.8285154712685,42.82938706396065]}]],[[{"lng":[-72.59833525163249,-72.60056061290285,-72.60054283102498,-72.59829986318871,-72.59607459089516,-72.59609219746115,-72.59833525163249],"lat":[42.82932621984962,42.82839378065376,42.82658990405704,42.8257184690383,42.8266508387449,42.8284547129565,42.82932621984962]}]],[[{"lng":[-72.58939826439259,-72.59162379149524,-72.5916063602406,-72.58936357719421,-72.58713813911562,-72.58715539505944,-72.58939826439259],"lat":[42.82944773407422,42.8285154712685,42.82671159945647,42.82583999286114,42.82677218619276,42.82857605559078,42.82944773407422]}]],[[{"lng":[-72.57820172567165,-72.58042732942556,-72.58041033844667,-72.57816791900278,-72.57594240432164,-72.57595922001171,-72.57820172567165],"lat":[42.82689283774371,42.82596082081392,42.82415700943761,42.82328521743804,42.82421716491525,42.82602097384161,42.82689283774371]}]],[[{"lng":[-72.5625386604769,-72.56476442339444,-72.56474804785113,-72.5625060846566,-72.56028041088415,-72.56029661116123,-72.5625386604769],"lat":[42.82439658765276,42.82346490480577,42.82166115644591,42.82078909343038,42.82172070685392,42.82352445271348,42.82439658765276]}]],[[{"lng":[-72.55134516672859,-72.55357100580761,-72.55355507030401,-72.55131347096564,-72.54908772108028,-72.54910348133977,-72.55134516672859],"lat":[42.82183928589746,42.82090784891228,42.81910416121373,42.81823191303359,42.81916328061683,42.82096696577917,42.82183928589746]}]],[[{"lng":[-72.58492978508178,-72.58715539505944,-72.58713813911562,-72.5848954485045,-72.58266992757453,-72.58268700820808,-72.58492978508178],"lat":[42.82950823019133,42.82857605559078,42.82677218619276,42.82590049382079,42.82683259895483,42.82863646592438,42.82950823019133]}]],[[{"lng":[-72.57373353346129,-72.57595922001171,-72.57594240432164,-72.57370007736949,-72.57147447991548,-72.57149112031729,-72.57373353346129],"lat":[42.82695290256042,42.82602097384161,42.82421716491525,42.82334528716913,42.82427714644295,42.8260809529049,42.82695290256042]}]],[[{"lng":[-72.55807076555314,-72.56029661116123,-72.56028041088415,-72.55803854026466,-72.5558127838252,-72.55582880883668,-72.55807076555314],"lat":[42.82445604733701,42.82352445271348,42.82172070685392,42.82084855812973,42.82178008333742,42.82358382668219,42.82445604733701]}]],[[{"lng":[-72.54687755964864,-72.54910348133977,-72.54908772108028,-72.54684621437332,-72.54462038189945,-72.54463596691539,-72.54687755964864],"lat":[42.82189831453513,42.82096696577917,42.81916328061683,42.81829094675814,42.81922222611979,42.82102590873145,42.82189831453513]}]],[[{"lng":[-72.59612741473781,-72.59835294793699,-72.59833525163249,-72.59609219746115,-72.59386675326094,-72.59388427423316,-72.59612741473781],"lat":[42.83206257011658,42.83113014962444,42.82932621984962,42.8284547129565,42.82938706396065,42.83119099134292,42.83206257011658]}]],[[{"lng":[-72.58046131538285,-72.58268700820808,-72.58266992757453,-72.58042732942556,-72.57820172567165,-72.57821863099548,-72.58046131538285],"lat":[42.82956855231304,42.82863646592438,42.82683259895483,42.82596082081392,42.82689283774371,42.82869670227031,42.82956855231304]}]],[[{"lng":[-72.56926535099781,-72.57149112031729,-72.57147447991548,-72.56923224548196,-72.56700656528245,-72.5670230303966,-72.56926535099781],"lat":[42.82701279340605,42.8260809529049,42.82427714644295,42.82340518295801,42.82433695402178,42.82614075800487,42.82701279340605]}]],[[{"lng":[-72.55360288056542,-72.55582880883668,-72.5558127838252,-72.55357100580761,-72.55134516672859,-72.55136101647503,-72.55360288056542],"lat":[42.82451533307558,42.82358382668219,42.82178008333742,42.82090784891228,42.82183928589746,42.82364302671299,42.82451533307558]}]],[[{"lng":[-72.5916586581079,-72.59388427423316,-72.59386675326094,-72.59162379149524,-72.58939826439259,-72.5894156100331,-72.5916586581079],"lat":[42.83212332362903,42.83119099134292,42.82938706396065,42.8285154712685,42.82944773407422,42.83125165904947,42.83212332362903]}]],[[{"lng":[-72.57599285535012,-72.57821863099548,-72.57820172567165,-72.57595922001171,-72.57373353346129,-72.57375026347596,-72.57599285535012],"lat":[42.82962870044041,42.82869670227031,42.82689283774371,42.82602097384161,42.82695290256042,42.82875676462962,42.82962870044041]}]],[[{"lng":[-72.56479717833545,-72.5670230303966,-72.56700656528245,-72.56476442339444,-72.5625386604769,-72.56255495030391,-72.56479717833545],"lat":[42.82707251028163,42.82614075800487,42.82433695402178,42.82346490480577,42.82439658765276,42.82620038914255,42.82707251028163]}]],[[{"lng":[-72.54913500556808,-72.55136101647503,-72.55134516672859,-72.54910348133977,-72.54687755964864,-72.54689323413062,-72.54913500556808],"lat":[42.82457444486955,42.82364302671299,42.82183928589746,42.82096696577917,42.82189831453513,42.82370205280696,42.82457444486955]}]],[[{"lng":[-72.5871899110092,-72.5894156100331,-72.58939826439259,-72.58715539505944,-72.58492978508178,-72.58494695539112,-72.5871899110092],"lat":[42.83218390312283,42.83125165904947,42.82944773407422,42.82857605559078,42.82950823019133,42.83131215274513,42.83218390312283]}]],[[{"lng":[-72.57152440503791,-72.57375026347596,-72.57373353346129,-72.57149112031729,-72.56926535099781,-72.56928190570386,-72.57152440503791],"lat":[42.82968867457445,42.82875676462962,42.82695290256042,42.8260809529049,42.82701279340605,42.82881665300339,42.82968867457445]}]],[[{"lng":[-72.56032901552859,-72.56255495030391,-72.5625386604769,-72.56029661116123,-72.55807076555314,-72.5580868800936,-72.56032901552859],"lat":[42.82713205318824,42.82620038914255,42.82439658765276,42.82352445271348,42.82445604733701,42.82625984631901,42.82713205318824]}]],[[{"lng":[-72.5939193203024,-72.59614502544878,-72.59612741473781,-72.59388427423316,-72.5916586581079,-72.59167609346628,-72.5939193203024],"lat":[42.83479895483291,42.83386655306008,42.83206257011658,42.83119099134292,42.83212332362903,42.83392730417253,42.83479895483291]}]],[[{"lng":[-72.58272117349604,-72.58494695539112,-72.58492978508178,-72.58268700820808,-72.58046131538285,-72.58047831036156,-72.58272117349604],"lat":[42.83224430859902,42.83131215274513,42.82950823019133,42.82863646592438,42.82956855231304,42.8313724724309,42.83224430859902]}]],[[{"lng":[-72.56705596450055,-72.56928190570386,-72.56926535099781,-72.5670230303966,-72.56479717833545,-72.56481355773349,-72.56705596450055],"lat":[42.82974847471623,42.82881665300339,42.82701279340605,42.82614075800487,42.82707251028163,42.82887636739267,42.82974847471623]}]],[[{"lng":[-72.55586086263152,-72.5580868800936,-72.55807076555314,-72.55582880883668,-72.55360288056542,-72.55361881981992,-72.55586086263152],"lat":[42.82719142212695,42.82625984631901,42.82445604733701,42.82358382668219,42.82451533307558,42.82631912953535,42.82719142212695]}]],[[{"lng":[-72.58945030539762,-72.59167609346628,-72.5916586581079,-72.5894156100331,-72.5871899110092,-72.58720717101548,-72.58945030539762],"lat":[42.83485961772501,42.83392730417253,42.83212332362903,42.83125165904947,42.83218390312283,42.83398788125188,42.83485961772501]}]],[[{"lng":[-72.57825244562271,-72.58047831036156,-72.58046131538285,-72.57821863099548,-72.57599285535012,-72.57600967499874,-72.57825244562271],"lat":[42.83230454005863,42.8313724724309,42.82956855231304,42.82869670227031,42.82962870044041,42.83143261810787,42.83230454005863]}]],[[{"lng":[-72.56258753379237,-72.56481355773349,-72.56479717833545,-72.56255495030391,-72.56032901552859,-72.56034521961914,-72.56258753379237],"lat":[42.82980810086682,42.82887636739267,42.82707251028163,42.82620038914255,42.82713205318824,42.8289359077985,42.82980810086682]}]],[[{"lng":[-72.55139271969854,-72.55361881981992,-72.55360288056542,-72.55136101647503,-72.54913500556808,-72.54915076953721,-72.55139271969854],"lat":[42.82725061709884,42.82631912953535,42.82451533307558,42.82364302671299,42.82457444486955,42.82637823879262,42.82725061709884]}]],[[{"lng":[-72.54692458678399,-72.54915076953721,-72.54913500556808,-72.54689323413062,-72.54466714061542,-72.54468272929975,-72.54692458678399],"lat":[42.82730963810498,42.82637823879262,42.82457444486955,42.82370205280696,42.82463338272001,42.82643717409194,42.82730963810498]}]],[[{"lng":[-72.58498130005201,-72.58720717101548,-72.5871899110092,-72.58494695539112,-72.58272117349604,-72.58273825815075,-72.58498130005201],"lat":[42.83492010657729,42.83398788125188,42.83218390312283,42.83131215274513,42.83224430859902,42.83404828429915,42.83492010657729]}]],[[{"lng":[-72.57378372744358,-72.57600967499874,-72.57599285535012,-72.57375026347596,-72.57152440503791,-72.57154104935702,-72.57378372744358],"lat":[42.83236459750271,42.83143261810787,42.82962870044041,42.82875676462962,42.82968867457445,42.83149258977706,42.83236459750271]}]],[[{"lng":[-72.55811911296769,-72.56034521961914,-72.56032901552859,-72.5580868800936,-72.55586086263152,-72.55587689141518,-72.55811911296769],"lat":[42.82986755302729,42.8289359077985,42.82713205318824,42.82625984631901,42.82719142212695,42.82899527422197,42.82986755302729]}]],[[{"lng":[-72.58051230431988,-72.58273825815075,-72.58272117349604,-72.58047831036156,-72.57825244562271,-72.57826935492643,-72.58051230431988],"lat":[42.83498042139079,42.83404828429915,42.83224430859902,42.8313724724309,42.83230454005863,42.83410851331537,42.83498042139079]}]],[[{"lng":[-72.569315019013,-72.57154104935702,-72.57152440503791,-72.56928190570386,-72.56705596450055,-72.56707243349069,-72.569315019013],"lat":[42.83242448093232,42.83149258977706,42.82968867457445,42.82881665300339,42.82974847471623,42.83155238743955,42.83242448093232]}]],[[{"lng":[-72.55365070208084,-72.55587689141518,-72.55586086263152,-72.55361881981992,-72.55139271969854,-72.55140857317591,-72.55365070208084],"lat":[42.82992683119871,42.82899527422197,42.82719142212695,42.82631912953535,42.82725061709884,42.82905446666418,42.82992683119871]}]],[[{"lng":[-72.59171096828779,-72.59393684539972,-72.5939193203024,-72.59167609346628,-72.58945030539762,-72.58946765512194,-72.59171096828779],"lat":[42.83753537397361,42.83660299093567,42.83479895483291,42.83392730417253,42.83485961772501,42.83666365142033,42.83753537397361]}]],[[{"lng":[-72.57604331825563,-72.57826935492643,-72.57825244562271,-72.57600967499874,-72.57378372744358,-72.57380046139687,-72.57604331825563],"lat":[42.83504056216654,42.83410851331537,42.83230454005863,42.83143261810787,42.83236459750271,42.83416856830161,42.83504056216654]}]],[[{"lng":[-72.56484632038527,-72.56707243349069,-72.56705596450055,-72.56481355773349,-72.56258753379237,-72.56260382745413,-72.56484632038527],"lat":[42.83248419034852,42.83155238743955,42.82974847471623,42.82887636739267,42.82980810086682,42.83161201109637,42.83248419034852]}]],[[{"lng":[-72.54918230118611,-72.55140857317591,-72.55139271969854,-72.54915076953721,-72.54692458678399,-72.54694026495564,-72.54918230118611],"lat":[42.82998593538217,42.82905446666418,42.82725061709884,42.82637823879262,42.82730963810498,42.82911348512618,42.82998593538217]}]],[[{"lng":[-72.58724169509154,-72.58946765512194,-72.58945030539762,-72.58720717101548,-72.58498130005201,-72.58499847440386,-72.58724169509154],"lat":[42.83759594622361,42.83666365142033,42.83485961772501,42.83398788125188,42.83492010657729,42.83672413785072,42.83759594622361]}]],[[{"lng":[-72.57157434191359,-72.57380046139687,-72.57378372744358,-72.57154104935702,-72.569315019013,-72.5693315776164,-72.57157434191359],"lat":[42.8351005289056,42.83416856830161,42.83236459750271,42.83149258977706,42.83242448093232,42.83422844925892,42.8351005289056]}]],[[{"lng":[-72.56037763161473,-72.56260382745413,-72.56258753379237,-72.56034521961914,-72.55811911296769,-72.55813523130163,-72.56037763161473],"lat":[42.83254372575236,42.83161201109637,42.82980810086682,42.8289359077985,42.82986755302729,42.83167146074862,42.83254372575236]}]],[[{"lng":[-72.54471391033785,-72.54694026495564,-72.54692458678399,-72.54468272929975,-72.54245646394214,-72.54247196680871,-72.54471391033785],"lat":[42.83004486557874,42.82911348512618,42.82730963810498,42.82643717409194,42.82736848514648,42.82917232960908,42.83004486557874]}]],[[{"lng":[-72.58277243148245,-72.58499847440386,-72.58498130005201,-72.58273825815075,-72.58051230431988,-72.58052930329983,-72.58277243148245],"lat":[42.83765634441259,42.83672413785072,42.83492010657729,42.83404828429915,42.83498042139079,42.83678445022783,42.83765634441259]}]],[[{"lng":[-72.56710537534806,-72.5693315776164,-72.569315019013,-72.56707243349069,-72.56484632038527,-72.56486270363935,-72.56710537534806],"lat":[42.835160321609,42.83422844925892,42.83242448093232,42.83155238743955,42.83248419034852,42.83428815618835,42.835160321609]}]],[[{"lng":[-72.55590895275571,-72.55813523130163,-72.55811911296769,-72.55587689141518,-72.55365070208084,-72.55366664508753,-72.55590895275571],"lat":[42.83260308714492,42.83167146074862,42.82986755302729,42.82899527422197,42.82992683119871,42.83173073639734,42.83260308714492]}]],[[{"lng":[-72.55144028386259,-72.55366664508753,-72.55365070208084,-72.55140857317591,-72.54918230118611,-72.54919806886618,-72.55144028386259],"lat":[42.83266227452728,42.83173073639734,42.82992683119871,42.82905446666418,42.82998593538217,42.83178983804365,42.83266227452728]}]],[[{"lng":[-72.59397189972056,-72.59619786587426,-72.59618025101683,-72.59393684539972,-72.59171096828779,-72.5917284077513,-72.59397189972056],"lat":[42.84021117184428,42.83927871931458,42.83747462766156,42.83660299093567,42.83753537397361,42.8393394632262,42.84021117184428]}]],[[{"lng":[-72.58950235865547,-72.5917284077513,-72.59171096828779,-72.58946765512194,-72.58724169509154,-72.58725895916166,-72.58950235865547],"lat":[42.84027182751363,42.8393394632262,42.83753537397361,42.83666365142033,42.83759594622361,42.83940003306131,42.84027182751363]}]],[[{"lng":[-72.57830317751485,-72.58052930329983,-72.58051230431988,-72.57826935492643,-72.57604331825563,-72.5760601418642,-72.57830317751485],"lat":[42.83771656854164,42.83678445022783,42.83498042139079,42.83410851331537,42.83504056216654,42.83684458855275,42.83771656854164]}]],[[{"lng":[-72.56263641861342,-72.56486270363935,-72.56484632038527,-72.56260382745413,-72.56037763161473,-72.56039383952007,-72.56263641861342],"lat":[42.83521994027784,42.83428815618835,42.83248419034852,42.83161201109637,42.83254372575236,42.83434768909099,42.83521994027784]}]],[[{"lng":[-72.54697162498964,-72.54919806886618,-72.54918230118611,-72.54694026495564,-72.54471391033785,-72.54472950269188,-72.54697162498964],"lat":[42.83272128790053,42.83178983804365,42.82998593538217,42.82911348512618,42.83004486557874,42.8318487656886,42.83272128790053]}]],[[{"lng":[-72.58503282715117,-72.58725895916166,-72.58724169509154,-72.58499847440386,-72.58277243148245,-72.58278952015974,-72.58503282715117],"lat":[42.84033230909977,42.83940003306131,42.83759594622361,42.83672413785072,42.83765634441259,42.83946042882096,42.84033230909977]}]],[[{"lng":[-72.57383393324311,-72.5760601418642,-72.57604331825563,-72.57380046139687,-72.57157434191359,-72.57159099015134,-72.57383393324311],"lat":[42.83777661861176,42.83684458855275,42.83504056216654,42.83416856830161,42.8351005289056,42.83690455282651,42.83777661861176]}]],[[{"lng":[-72.55816747176405,-72.56039383952007,-72.56037763161473,-72.55813523130163,-72.55590895275571,-72.5559249853129,-72.55816747176405],"lat":[42.83527938491316,42.83434768909099,42.83254372575236,42.83167146074862,42.83260308714492,42.83440704796786,42.83527938491316]}]],[[{"lng":[-72.58056330526203,-72.58278952015974,-72.58277243148245,-72.58052930329983,-72.57830317751485,-72.57832009079985,-72.58056330526203],"lat":[42.84039261660373,42.83946042882096,42.83765634441259,42.83678445022783,42.83771656854164,42.83952065050617,42.84039261660373]}]],[[{"lng":[-72.56936469872159,-72.57159099015134,-72.57157434191359,-72.5693315776164,-72.56710537534806,-72.56712184821559,-72.56936469872159],"lat":[42.83783649462401,42.83690455282651,42.8351005289056,42.83422844925892,42.835160321609,42.83696434305018,42.83783649462401]}]],[[{"lng":[-72.56489547400462,-72.56712184821559,-72.56710537534806,-72.56486270363935,-72.56263641861342,-72.56265271611129,-72.56489547400462],"lat":[42.83789619657947,42.83696434305018,42.835160321609,42.83428815618835,42.83521994027784,42.8370239592248,42.83789619657947]}]],[[{"lng":[-72.55369853485422,-72.5559249853129,-72.55590895275571,-72.55366664508753,-72.55144028386259,-72.55145614107219,-72.55369853485422],"lat":[42.83533865551608,42.83440704796786,42.83260308714492,42.83173073639734,42.83266227452728,42.83446623282008,42.83533865551608]}]],[[{"lng":[-72.54250297619122,-72.54472950269188,-72.54471391033785,-72.54247196680871,-72.54024552959038,-72.54026094661897,-72.54250297619122],"lat":[42.83278012726576,42.8318487656886,42.83004486557874,42.82917232960908,42.83010362178952,42.83190751933333,42.83278012726576]}]],[[{"lng":[-72.59176329078458,-72.5939894289444,-72.59397189972056,-72.5917284077513,-72.58950235865547,-72.58951971246503,-72.59176329078458],"lat":[42.84294775042306,42.84201531664515,42.84021117184428,42.8393394632262,42.84027182751363,42.84207596990664,42.84294775042306]}]],[[{"lng":[-72.57609379304239,-72.57832009079985,-72.57830317751485,-72.5760601418642,-72.57383393324311,-72.57385067113638,-72.57609379304239],"lat":[42.84045275002655,42.83952065050617,42.83771656854164,42.83684458855275,42.83777661861176,42.83958069811801,42.84045275002655]}]],[[{"lng":[-72.56042625914658,-72.56265271611129,-72.56263641861342,-72.56039383952007,-72.55816747176405,-72.55818359389281,-72.56042625914658],"lat":[42.8379557244792,42.8370239592248,42.83521994027784,42.83434768909099,42.83527938491316,42.83708340135144,42.8379557244792]}]],[[{"lng":[-72.5492296079383,-72.55145614107219,-72.55144028386259,-72.54919806886618,-72.54697162498964,-72.54698730685226,-72.5492296079383],"lat":[42.83539775208762,42.83446623282008,42.83266227452728,42.83178983804365,42.83272128790053,42.83452524364873,42.83539775208762]}]],[[{"lng":[-72.58729349136691,-72.58951971246503,-72.58950235865547,-72.58725895916166,-72.58503282715117,-72.58505000554698,-72.58729349136691],"lat":[42.84300831542799,42.84207596990664,42.84027182751363,42.83940003306131,42.84033230909977,42.84213644907044,42.84300831542799]}]],[[{"lng":[-72.57162429054662,-72.57385067113638,-72.57383393324311,-72.57159099015134,-72.56936469872159,-72.56938126122368,-72.57162429054662],"lat":[42.84051270936927,42.83958069811801,42.83777661861176,42.83690455282651,42.83783649462401,42.83964057165753,42.84051270936927]}]],[[{"lng":[-72.55595705420183,-72.55818359389281,-72.55816747176405,-72.5559249853129,-72.55369853485422,-72.55371448161448,-72.55595705420183],"lat":[42.83801507832425,42.83708340135144,42.83527938491316,42.83440704796786,42.83533865551608,42.8371426694312,42.83801507832425]}]],[[{"lng":[-72.54476069107066,-72.54698730685226,-72.54697162498964,-72.54472950269188,-72.54250297619122,-72.54251848270746,-72.54476069107066],"lat":[42.83545667462892,42.83452524364873,42.83272128790053,42.8318487656886,42.83278012726576,42.83458408045489,42.83545667462892]}]],[[{"lng":[-72.582823701538,-72.58505000554698,-72.58503282715117,-72.58278952015974,-72.58056330526203,-72.58058030824461,-72.582823701538],"lat":[42.84306870632849,42.84213644907044,42.84033230909977,42.83946042882096,42.84039261660373,42.84219675413759,42.84306870632849]}]],[[{"lng":[-72.57835392135225,-72.58058030824461,-72.58056330526203,-72.57832009079985,-72.57609379304239,-72.57611062061231,-72.57835392135225],"lat":[42.84312892312564,42.84219675413759,42.84039261660373,42.83952065050617,42.84045275002655,42.84225688510914,42.84312892312564]}]],[[{"lng":[-72.56715479782909,-72.56938126122368,-72.56936469872159,-72.56712184821559,-72.56489547400462,-72.56491186111613,-72.56715479782909],"lat":[42.84057249463297,42.83964057165753,42.83783649462401,42.83696434305018,42.83789619657947,42.83970027112578,42.84057249463297]}]],[[{"lng":[-72.55148785922469,-72.55371448161448,-72.55369853485422,-72.55145614107219,-72.5492296079383,-72.54924537933064,-72.55148785922469],"lat":[42.83807425811573,42.8371426694312,42.83533865551608,42.83446623282008,42.83539775208762,42.83720176346515,42.83807425811573]}]],[[{"lng":[-72.58955442417047,-72.59178073435471,-72.59176329078458,-72.58951971246503,-72.58729349136691,-72.58731075950234,-72.58955442417047],"lat":[42.84568436337293,42.84475194836239,42.84294775042306,42.84207596990664,42.84300831542799,42.84481251095198,42.84568436337293]}]],[[{"lng":[-72.57388415086402,-72.57611062061231,-72.57609379304239,-72.57385067113638,-72.57162429054662,-72.57164094270445,-72.57388415086402],"lat":[42.84318896582047,42.84225688510914,42.84045275002655,42.83958069811801,42.84051270936927,42.84231684198613,42.84318896582047]}]],[[{"lng":[-72.56268531494416,-72.56491186111613,-72.56489547400462,-72.56265271611129,-72.56042625914658,-72.56044247086805,-72.56268531494416],"lat":[42.84063210581871,42.83970027112578,42.83789619657947,42.8370239592248,42.8379557244792,42.83975979652382,42.84063210581871]}]],[[{"lng":[-72.54701867426951,-72.54924537933064,-72.5492296079383,-72.54698730685226,-72.54476069107066,-72.54477628709567,-72.54701867426951],"lat":[42.83813326385469,42.83720176346515,42.83539775208762,42.83452524364873,42.83545667462892,42.83726068345437,42.83813326385469]}]],[[{"lng":[-72.58508436638358,-72.58731075950234,-72.58729349136691,-72.58505000554698,-72.582823701538,-72.58284079423929,-72.58508436638358],"lat":[42.84574483769164,42.84481251095198,42.84300831542799,42.84213644907044,42.84306870632849,42.8448728994227,42.84574483769164]}]],[[{"lng":[-72.56941439012769,-72.57164094270445,-72.57162429054662,-72.56938126122368,-72.56715479782909,-72.56717127457539,-72.56941439012769],"lat":[42.84324883441404,42.84231684198613,42.84051270936927,42.83964057165753,42.84057249463297,42.84237662476963,42.84324883441404]}]],[[{"lng":[-72.55821584194619,-72.56044247086805,-72.56042625914658,-72.55818359389281,-72.55595705420183,-72.55597309053384,-72.55821584194619],"lat":[42.84069154292754,42.83975979652382,42.8379557244792,42.83708340135144,42.83801507832425,42.83981914785273,42.84069154292754]}]],[[{"lng":[-72.54254949939067,-72.54477628709567,-72.54476069107066,-72.54251848270746,-72.54029178430559,-72.5403072049639,-72.54254949939067],"lat":[42.83819209554226,42.83726068345437,42.83545667462892,42.83458408045489,42.83551542314105,42.83731942939998,42.83819209554226]}]],[[{"lng":[-72.58061431821351,-72.58284079423929,-72.582823701538,-72.58058030824461,-72.57835392135225,-72.57837083861995,-72.58061431821351],"lat":[42.84580513788475,42.8448728994227,42.84306870632849,42.84219675413759,42.84312892312564,42.84493311377559,42.84580513788475]}]],[[{"lng":[-72.56494463919762,-72.56717127457539,-72.56715479782909,-72.56491186111613,-72.56268531494416,-72.56270161627948,-72.56494463919762],"lat":[42.84330852890741,42.84237662476963,42.84057249463297,42.83970027112578,42.84063210581871,42.8424362334607,42.84330852890741]}]],[[{"lng":[-72.55374637888957,-72.55597309053384,-72.55595705420183,-72.55371448161448,-72.55148785922469,-72.55150372016784,-72.55374637888957],"lat":[42.84075080596057,42.83981914785273,42.83801507832425,42.8371426694312,42.83807425811573,42.8398783251136,42.84075080596057]}]],[[{"lng":[-72.59181562560266,-72.59404202487157,-72.59402449151973,-72.59178073435471,-72.58955442417047,-72.58957178206668,-72.59181562560266],"lat":[42.84836045291032,42.84742796840424,42.84562371492763,42.84475194836239,42.84568436337293,42.84748861444126,42.84836045291032]}]],[[{"lng":[-72.58734529983963,-72.58957178206668,-72.58955442417047,-72.58731075950234,-72.58508436638358,-72.58510154882475,-72.58734529983963],"lat":[42.84842101066884,42.84748861444126,42.84568436337293,42.84481251095198,42.84574483769164,42.84754908633717,42.84842101066884]}]],[[{"lng":[-72.57614427971458,-72.57837083861995,-72.57835392135225,-72.57611062061231,-72.57388415086402,-72.57390089269869,-72.57614427971458],"lat":[42.84586526395332,42.84493311377559,42.84312892312564,42.84225688510914,42.84318896582047,42.8449931540117,42.84586526395332]}]],[[{"lng":[-72.56047489812821,-72.56270161627948,-72.56268531494416,-72.56044247086805,-72.55821584194619,-72.55823196787114,-72.56047489812821],"lat":[42.84336804930165,42.8424362334607,42.84063210581871,42.83975979652382,42.84069154292754,42.8424956680604,42.84336804930165]}]],[[{"lng":[-72.54927692582862,-72.55150372016784,-72.55148785922469,-72.54924537933064,-72.54701867426951,-72.54703435982441,-72.54927692582862],"lat":[42.84080989491883,42.8398783251136,42.83807425811573,42.83720176346515,42.83813326385469,42.8399373283075,42.84080989491883]}]],[[{"lng":[-72.58287498366698,-72.58510154882475,-72.58508436638358,-72.58284079423929,-72.58061431821351,-72.58063132520014,-72.58287498366698],"lat":[42.84848139427955,42.84754908633717,42.84574483769164,42.8448728994227,42.84580513788475,42.84760938409305,42.84848139427955]}]],[[{"lng":[-72.5716742509412,-72.57390089269869,-72.57388415086402,-72.57164094270445,-72.56941439012769,-72.56943095652987,-72.5716742509412],"lat":[42.8459252158984,42.8449931540117,42.84318896582047,42.84231684198613,42.84324883441404,42.84505302013208,42.8459252158984]}]],[[{"lng":[-72.5560051669738,-72.55823196787114,-72.55821584194619,-72.55597309053384,-72.55374637888957,-72.55376232940468,-72.5560051669738],"lat":[42.84342739559784,42.8424956680604,42.84069154292754,42.83981914785273,42.84075080596057,42.84255492856981,42.84342739559784]}]],[[{"lng":[-72.5448074828177,-72.54703435982441,-72.54701867426951,-72.54477628709567,-72.54254949939067,-72.54256500955792,-72.5448074828177],"lat":[42.84086880980345,42.8399373283075,42.83813326385469,42.83726068345437,42.83819209554226,42.83999615743555,42.84086880980345]}]],[[{"lng":[-72.57840467713915,-72.58063132520014,-72.58061431821351,-72.57837083861995,-72.57614427971458,-72.57616111124725,-72.57840467713915],"lat":[42.84854160374348,42.84760938409305,42.84580513788475,42.84493311377559,42.84586526395332,42.8476695077099,42.84854160374348]}]],[[{"lng":[-72.56720423194777,-72.56943095652987,-72.56941439012769,-72.56717127457539,-72.56494463919762,-72.56496103016792,-72.56720423194777],"lat":[42.84598499372103,42.84505302013208,42.84324883441404,42.84237662476963,42.84330852890741,42.84511271213779,42.84598499372103]}]],[[{"lng":[-72.55153544578879,-72.55376232940468,-72.55374637888957,-72.55150372016784,-72.54927692582862,-72.54929270093452,-72.55153544578879],"lat":[42.84348656779704,42.84255492856981,42.84075080596057,42.8398783251136,42.84080989491883,42.84261401499002,42.84348656779704]}]],[[{"lng":[-72.5403380499112,-72.54256500955792,-72.54254949939067,-72.5403072049639,-72.5380803346425,-72.53809566942267,-72.5403380499112],"lat":[42.84092755061553,42.83999615743555,42.83819209554226,42.83731942939998,42.83825075317953,42.84005481249883,42.84092755061553]}]],[[{"lng":[-72.58960650194693,-72.59183307328082,-72.59181562560266,-72.58957178206668,-72.58734529983963,-72.5873625720418,-72.58960650194693],"lat":[42.85109722523578,42.85016475951396,42.84836045291032,42.84748861444126,42.84842101066884,42.85022531485671,42.85109722523578]}]],[[{"lng":[-72.57393438031049,-72.57616111124725,-72.57614427971458,-72.57390089269869,-72.5716742509412,-72.57169090702045,-72.57393438031049],"lat":[42.8486016390617,42.8476695077099,42.84586526395332,42.8449931540117,42.8459252158984,42.8477294571888,42.8486016390617]}]],[[{"lng":[-72.56273422278863,-72.56496103016792,-72.56494463919762,-72.56270161627948,-72.56047489812821,-72.56049111366717,-72.56273422278863],"lat":[42.84604459742231,42.84511271213779,42.84330852890741,42.8424362334607,42.84336804930165,42.84517223002992,42.84604459742231]}]],[[{"lng":[-72.54706573462751,-72.54929270093452,-72.54927692582862,-72.54703435982441,-72.5448074828177,-72.54482308251499,-72.54706573462751],"lat":[42.84354556590036,42.84261401499002,42.84080989491883,42.8399373283075,42.84086880980345,42.84267292732212,42.84354556590036]}]],[[{"lng":[-72.58513591775353,-72.5873625720418,-72.58734529983963,-72.58510154882475,-72.58287498366698,-72.58289208039369,-72.58513591775353],"lat":[42.85115769228572,42.85022531485671,42.84842101066884,42.84754908633717,42.84848139427955,42.85028569603721,42.85115769228572]}]],[[{"lng":[-72.56946409323544,-72.57169090702045,-72.5716742509412,-72.56943095652987,-72.56720423194777,-72.56722071257417,-72.56946409323544],"lat":[42.84866150023526,42.8477294571888,42.8459252158984,42.84505302013208,42.84598499372103,42.8477892325308,42.84866150023526]}]],[[{"lng":[-72.55826422351819,-72.56049111366717,-72.56047489812821,-72.55823196787114,-72.5560051669738,-72.55602120708201,-72.55826422351819],"lat":[42.8461040270033,42.84517223002992,42.84336804930165,42.8424956680604,42.84342739559784,42.8452315738095,42.8461040270033]}]],[[{"lng":[-72.54259603354437,-72.54482308251499,-72.5448074828177,-72.54256500955792,-72.5403380499112,-72.54035347420049,-72.54259603354437],"lat":[42.84360438990888,42.84267292732212,42.84086880980345,42.83999615743555,42.84092755061553,42.84273166556721,42.84360438990888]}]],[[{"lng":[-72.58066534317855,-72.58289208039369,-72.58287498366698,-72.58063132520014,-72.57840467713915,-72.57842159839095,-72.58066534317855],"lat":[42.85121798516668,42.85028569603721,42.84848139427955,42.84760938409305,42.84854160374348,42.85034590305645,42.85121798516668]}]],[[{"lng":[-72.56499381596834,-72.56722071257417,-72.56720423194777,-72.56496103016792,-72.56273422278863,-72.56275052796276,-72.56499381596834],"lat":[42.84872118726521,42.8477892325308,42.84598499372103,42.84511271213779,42.84604459742231,42.84784883373695,42.84872118726521]}]],[[{"lng":[-72.55379423419085,-72.55602120708201,-72.5560051669738,-72.55376232940468,-72.55153544578879,-72.55155131046683,-72.55379423419085],"lat":[42.84616328246506,42.8452315738095,42.84342739559784,42.84255492856981,42.84348656779704,42.84529074347764,42.84616328246506]}]],[[{"lng":[-72.58739712051398,-72.58962386393127,-72.58960650194693,-72.5873625720418,-72.58513591775353,-72.58515310424148,-72.58739712051398],"lat":[42.85383403187898,42.85290158495701,42.85109722523578,42.85022531485671,42.85115769228572,42.85296204958375,42.85383403187898]}]],[[{"lng":[-72.5761947782764,-72.57842159839095,-72.57840467713915,-72.57616111124725,-72.57393438031049,-72.57395112608795,-72.5761947782764],"lat":[42.85127810387968,42.85034590305645,42.84854160374348,42.8476695077099,42.8486016390617,42.8504059359155,42.85127810387968]}]],[[{"lng":[-72.56052354856364,-72.56275052796276,-72.56273422278863,-72.56049111366717,-72.55826422351819,-72.55828035324065,-72.56052354856364],"lat":[42.84878070015261,42.84784883373695,42.84604459742231,42.84517223002992,42.8461040270033,42.84790826080835,42.84878070015261]}]],[[{"lng":[-72.54932425486096,-72.55155131046683,-72.55153544578879,-72.54929270093452,-72.54706573462751,-72.54708142387599,-72.54932425486096],"lat":[42.84622236380869,42.84529074347764,42.84348656779704,42.84261401499002,42.84354556590036,42.84534973903542,42.84622236380869]}]],[[{"lng":[-72.58292627787364,-72.58515310424148,-72.58513591775353,-72.58289208039369,-72.58066534317855,-72.58068235417065,-72.58292627787364],"lat":[42.85389440819858,42.85296204958375,42.85115769228572,42.85028569603721,42.85121798516668,42.85302234002702,42.85389440819858]}]],[[{"lng":[-72.57172422310147,-72.57395112608795,-72.57393438031049,-72.57169090702045,-72.56946409323544,-72.56948066353911,-72.57172422310147],"lat":[42.85133804842578,42.8504059359155,42.8486016390617,42.8477294571888,42.84866150023526,42.85046579461542,42.85133804842578]}]],[[{"lng":[-72.55605329107567,-72.55828035324065,-72.55826422351819,-72.55602120708201,-72.55379423419085,-72.55381018846218,-72.55605329107567],"lat":[42.84884003889856,42.84790826080835,42.8461040270033,42.8452315738095,42.84616328246506,42.84796751374606,42.84884003889856]}]],[[{"lng":[-72.54485428558289,-72.54708142387599,-72.54706573462751,-72.54482308251499,-72.54259603354437,-72.54261154736389,-72.54485428558289],"lat":[42.84628127103525,42.84534973903542,42.84354556590036,42.84267292732212,42.84360438990888,42.84540856048395,42.84628127103525]}]],[[{"lng":[-72.54038432641103,-72.54261154736389,-72.54259603354437,-72.54035347420049,-72.53812634259374,-72.53814168098489,-72.54038432641103],"lat":[42.84634000414588,42.84540856048395,42.84360438990888,42.84273166556721,42.84366303982369,42.8454672078243,42.84634000414588]}]],[[{"lng":[-72.57845544487976,-72.58068235417065,-72.58066534317855,-72.57842159839095,-72.5761947782764,-72.57621161377321,-72.57845544487976],"lat":[42.85395461032801,42.85302234002702,42.85121798516668,42.85034590305645,42.85127810387968,42.85308245628788,42.85395461032801]}]],[[{"lng":[-72.56725367770817,-72.56948066353911,-72.56946409323544,-72.56722071257417,-72.56499381596834,-72.56501021079877,-72.56725367770817],"lat":[42.85139781880603,42.85046579461542,42.84866150023526,42.8477892325308,42.84872118726521,42.85052547915727,42.85139781880603]}]],[[{"lng":[-72.55158304355885,-72.55381018846218,-72.55379423419085,-72.55155131046683,-72.54932425486096,-72.54934003368174,-72.55158304355885],"lat":[42.84889920350412,42.84796751374606,42.84616328246506,42.84529074347764,42.84622236380869,42.84802659255116,42.84889920350412]}]],[[{"lng":[-72.57398462158673,-72.57621161377321,-72.5761947782764,-72.57395112608795,-72.57172422310147,-72.57174088310354,-72.57398462158673],"lat":[42.85401463826829,42.85308245628788,42.85127810387968,42.8504059359155,42.85133804842578,42.85314239836734,42.85401463826829]}]],[[{"lng":[-72.56278314215089,-72.56501021079877,-72.56499381596834,-72.56275052796276,-72.56052354856364,-72.56053976792143,-72.56278314215089],"lat":[42.85145741502151,42.85052547915727,42.84872118726521,42.84784883373695,42.84878070015261,42.8505849895421,42.85145741502151]}]],[[{"lng":[-72.54711280606756,-72.54934003368174,-72.54932425486096,-72.54708142387599,-72.54485428558289,-72.54486988895377,-72.54711280606756],"lat":[42.84895819397039,42.84802659255116,42.84622236380869,42.84534973903542,42.84628127103525,42.84808549722475,42.84895819397039]}]],[[{"lng":[-72.58518748126528,-72.58741439678433,-72.58739712051398,-72.58515310424148,-72.58292627787364,-72.58294337862721,-72.58518748126528],"lat":[42.85657087281487,42.85563844470836,42.85383403187898,42.85296204958375,42.85389440819858,42.8556988185973,42.85657087281487]}]],[[{"lng":[-72.56951380804897,-72.57174088310354,-72.57172422310147,-72.56948066353911,-72.56725367770817,-72.56727016221608,-72.56951380804897],"lat":[42.85407449202047,42.85314239836734,42.85133804842578,42.85046579461542,42.85139781880603,42.85320216626651,42.85407449202047]}]],[[{"lng":[-72.55831261648407,-72.56053976792143,-72.56052354856364,-72.55828035324065,-72.55605329107567,-72.55606933496139,-72.55831261648407],"lat":[42.85151683707328,42.8505849895421,42.84878070015261,42.84790826080835,42.84884003889856,42.850644325771,42.85151683707328]}]],[[{"lng":[-72.55384210076205,-72.55606933496139,-72.55605329107567,-72.55381018846218,-72.55158304355885,-72.55159891197312,-72.55384210076205],"lat":[42.8515760849624,42.850644325771,42.84884003889856,42.84796751374606,42.84889920350412,42.85070348784505,42.8515760849624]}]],[[{"lng":[-72.54264257865621,-72.54486988895377,-72.54485428558289,-72.54261154736389,-72.54038432641103,-72.5403997543326,-72.54264257865621],"lat":[42.84901701029845,42.84808549722475,42.84628127103525,42.84540856048395,42.84634000414588,42.84814422776791,42.84901701029845]}]],[[{"lng":[-72.58071638016143,-72.58294337862721,-72.58292627787364,-72.58068235417065,-72.57845544487976,-72.57847237011708,-72.58071638016143],"lat":[42.85663115838236,42.8556988185973,42.85389440819858,42.85302234002702,42.85395461032801,42.85575901828159,42.85663115838236]}]],[[{"lng":[-72.56504300432088,-72.56727016221608,-72.56725367770817,-72.56501021079877,-72.56278314215089,-72.5627994511652,-72.56504300432088],"lat":[42.85413417158567,42.85320216626651,42.85139781880603,42.85052547915727,42.85145741502151,42.85326175998642,42.85413417158567]}]],[[{"lng":[-72.54937159503926,-72.55159891197312,-72.55158304355885,-72.54934003368174,-72.54711280606756,-72.54712849901094,-72.54937159503926],"lat":[42.85163515869,42.85070348784505,42.84889920350412,42.84802659255116,42.84895819397039,42.85076247576531,42.85163515869]}]],[[{"lng":[-72.53817236137917,-72.5403997543326,-72.54038432641103,-72.53814168098489,-72.53591437739979,-72.53592962987263,-72.53817236137917],"lat":[42.84907565248941,42.84814422776791,42.84634000414588,42.8454672078243,42.84639856314165,42.84820278418176,42.84907565248941]}]],[[{"lng":[-72.57624528873207,-72.57847237011708,-72.57845544487976,-72.57621161377321,-72.57398462158673,-72.57400137130837,-72.57624528873207],"lat":[42.85669126973846,42.85575901828159,42.85395461032801,42.85308245628788,42.85401463826829,42.85581904376227,42.85669126973846]}]],[[{"lng":[-72.5605722104569,-72.5627994511652,-72.56278314215089,-72.56053976792143,-72.55831261648407,-72.55832875000534,-72.5605722104569],"lat":[42.85419367696489,42.85326175998642,42.85145741502151,42.8505849895421,42.85151683707328,42.85332117952814,42.85419367696489]}]],[[{"lng":[-72.54490109937011,-72.54712849901094,-72.54711280606756,-72.54486988895377,-72.54264257865621,-72.5426580961293,-72.54490109937011],"lat":[42.85169405825712,42.85076247576531,42.84895819397039,42.84808549722475,42.84901701029845,42.85082128953293,42.85169405825712]}]],[[{"lng":[-72.58297758416226,-72.58520467180146,-72.58518748126528,-72.58294337862721,-72.58071638016143,-72.58073339516042,-72.58297758416226],"lat":[42.85930774801841,42.85837533874297,42.85657087281487,42.8556988185973,42.85663115838236,42.85843562187235,42.85930774801841]}]],[[{"lng":[-72.58744895339431,-72.5896759580631,-72.58965859198919,-72.58741439678433,-72.58518748126528,-72.58520467180146,-72.58744895339431],"lat":[42.85924737899121,42.8583148813867,42.85651041303496,42.85563844470836,42.85657087281487,42.85837533874297,42.85924737899121]}]],[[{"lng":[-72.57177420703159,-72.57400137130837,-72.57398462158673,-72.57174088310354,-72.56951380804897,-72.56953038225548,-72.57177420703159],"lat":[42.85675120688424,42.85581904376227,42.85401463826829,42.85314239836734,42.85407449202047,42.85587889504038,42.85675120688424]}]],[[{"lng":[-72.55610142651142,-72.55832875000534,-72.55831261648407,-72.55606933496139,-72.55384210076205,-72.55385805879089,-72.55610142651142],"lat":[42.85425300815923,42.85332117952814,42.85151683707328,42.850644325771,42.8515760849624,42.85338042489277,42.85425300815923]}]],[[{"lng":[-72.54043061380898,-72.5426580961293,-72.54264257865621,-72.5403997543326,-72.53817236137917,-72.53818770338258,-72.54043061380898],"lat":[42.85175278366491,42.85082128953293,42.84901701029845,42.84814422776791,42.84907565248941,42.85087992914897,42.85175278366491]}]],[[{"lng":[-72.57850622457832,-72.58073339516042,-72.58071638016143,-72.57847237011708,-72.57624528873207,-72.57626212819441,-72.57850622457832],"lat":[42.85936794281198,42.85843562187235,42.85663115838236,42.85575901828159,42.85669126973846,42.85849573077586,42.85936794281198]}]],[[{"lng":[-72.56730313511444,-72.56953038225548,-72.56951380804897,-72.56727016221608,-72.56504300432088,-72.56505940301285,-72.56730313511444],"lat":[42.85681096982078,42.85587889504038,42.85407449202047,42.85320216626651,42.85413417158567,42.85593857211702,42.85681096982078]}]],[[{"lng":[-72.56283207303504,-72.56505940301285,-72.56504300432088,-72.5627994511652,-72.5605722104569,-72.56058843363488,-72.56283207303504],"lat":[42.8568705585491,42.85593857211702,42.85413417158567,42.85326175998642,42.85419367696489,42.85599807499321,42.8568705585491]}]],[[{"lng":[-72.55163065253883,-72.55385805879089,-72.55384210076205,-72.55159891197312,-72.54937159503926,-72.54938737757628,-72.55163065253883],"lat":[42.85431216516977,42.85338042489277,42.8515760849624,42.85070348784505,42.85163515869,42.85343949608138,42.85431216516977]}]],[[{"lng":[-72.57403487469689,-72.57626212819441,-72.57624528873207,-72.57400137130837,-72.57177420703159,-72.57179087095787,-72.57403487469689],"lat":[42.85942796337302,42.85849573077586,42.85669126973846,42.85581904376227,42.85675120688424,42.8585556654546,42.85942796337302]}]],[[{"lng":[-72.55836102084781,-72.56058843363488,-72.5605722104569,-72.55832875000534,-72.55610142651142,-72.55611747417601,-72.55836102084781],"lat":[42.85692997307029,42.85599807499321,42.85419367696489,42.85332117952814,42.85425300815923,42.85605740367006,42.85692997307029]}]],[[{"lng":[-72.54715988859357,-72.54938737757628,-72.54937159503926,-72.54712849901094,-72.54490109937011,-72.54491670641585,-72.54715988859357],"lat":[42.85437114799762,42.85343949608138,42.85163515869,42.85076247576531,42.85169405825712,42.85349839309507,42.85437114799762]}]],[[{"lng":[-72.53596013841025,-72.53818770338258,-72.53817236137917,-72.53592962987263,-72.53370215429084,-72.53371732082518,-72.53596013841025],"lat":[42.85181133491444,42.85087992914897,42.84907565248941,42.84820278418176,42.84913412054438,42.85093839461454,42.85181133491444]}]],[[{"lng":[-72.58523905692314,-72.58746623373426,-72.58744895339431,-72.58520467180146,-72.58297758416226,-72.58299468894408,-72.58523905692314],"lat":[42.86198437921183,42.86105190043969,42.85924737899121,42.85837533874297,42.85930774801841,42.86111226703579,42.86198437921183]}]],[[{"lng":[-72.56956353457242,-72.57179087095787,-72.57177420703159,-72.56953038225548,-72.56730313511444,-72.56731962350521,-72.56956353457242],"lat":[42.85948780970252,42.8585556654546,42.85675120688424,42.85587889504038,42.85681096982078,42.85861542590956,42.85948780970252]}]],[[{"lng":[-72.55388997860715,-72.55611747417601,-72.55610142651142,-72.55385805879089,-72.55163065253883,-72.55164652469061,-72.55388997860715],"lat":[42.85698921338544,42.85605740367006,42.85425300815923,42.85338042489277,42.85431216516977,42.85611655814862,42.85698921338544]}]],[[{"lng":[-72.54268913473005,-72.54491670641585,-72.54490109937011,-72.5426580961293,-72.54043061380898,-72.54044604536406,-72.54268913473005],"lat":[42.85442995664385,42.85349839309507,42.85169405825712,42.85082128953293,42.85175278366491,42.85355711593492,42.85442995664385]}]],[[{"lng":[-72.58076742916639,-72.58299468894408,-72.58297758416226,-72.58073339516042,-72.57850622457832,-72.57852315380255,-72.58076742916639],"lat":[42.86204465746454,42.86111226703579,42.85930774801841,42.85843562187235,42.85936794281198,42.8611724593838,42.86204465746454]}]],[[{"lng":[-72.57629581108574,-72.57852315380255,-72.57850622457832,-72.57626212819441,-72.57403487469689,-72.5740516283641,-72.57629581108574],"lat":[42.86210476146245,42.8611724593838,42.85936794281198,42.85849573077586,42.85942796337302,42.86123247748477,42.86210476146245]}]],[[{"lng":[-72.56509220425936,-72.56731962350521,-72.56730313511444,-72.56505940301285,-72.56283207303504,-72.56284838589087,-72.56509220425936],"lat":[42.85954748180158,42.85861542590956,42.85681096982078,42.85593857211702,42.8568705585491,42.85867501214187,42.85954748180158]}]],[[{"lng":[-72.54941894636748,-72.55164652469061,-72.55163065253883,-72.54938737757628,-72.54715988859357,-72.54717558523313,-72.54941894636748],"lat":[42.85704827949562,42.85611655814862,42.85431216516977,42.85343949608138,42.85437114799762,42.85617553843003,42.85704827949562]}]],[[{"lng":[-72.53821839100264,-72.54044604536406,-72.54043061380898,-72.53818770338258,-72.53596013841025,-72.53597539447532,-72.53821839100264],"lat":[42.85448859110956,42.85355711593492,42.85175278366491,42.85087992914897,42.85181133491444,42.85361566460205,42.85448859110956]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":0.5,"fill":true,"fillColor":["#808080","#808080","#FFFF00","#808080","#808080","#808080","#FFFF80","#FFFF80","#FFFF00","#FFFF00","#808080","#808080","#808080","#808080","#808080","#808080","#FFAA00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#808080","#FFFF00","#808080","#FFFF80","#808080","#FFAA00","#808080","#FFFF00","#FFFF00","#808080","#808080","#FFFF80","#FFFF00","#FFAA00","#FFFF00","#FFFF80","#808080","#FFFF00","#808080","#FFFF00","#808080","#808080","#FFFF00","#808080","#FFAA00","#FFAA00","#FFFF00","#FFFF80","#808080","#808080","#FFFF80","#808080","#FFFF00","#808080","#FFFF00","#FFAA00","#FFFF00","#FFFF80","#808080","#FFAA00","#FFFF00","#FFFF80","#FFFF00","#FFAA00","#808080","#FFFF00","#808080","#808080","#808080","#FFFF00","#808080","#FF5500","#808080","#808080","#FFFF80","#FFAA00","#FFAA00","#808080","#808080","#FF5500","#808080","#FFFF00","#808080","#FF5500","#FFAA00","#FFFF00","#808080","#FFFF80","#FFAA00","#808080","#808080","#FFFF80","#808080","#FF5500","#FF5500","#FF5500","#FFAA00","#FF5500","#FFFF80","#FF5500","#808080","#808080","#FF5500","#FFFF00","#FFAA00","#FF5500","#FF5500","#FF5500","#FFAA00","#FF5500","#FFFF00","#FFAA00","#808080","#FF0000","#FF5500","#FFFF80","#FFAA00","#FF0000","#FFFF00","#FF5500","#FFAA00","#FF0000","#FFFF80","#FFAA00","#FFFF00","#FFFF80","#FFFF80","#FFAA00","#FFFF00","#FFFF00","#FFAA00","#FFAA00","#808080","#FF0000","#FF5500","#FFAA00","#FFFF80","#FF5500","#FFAA00","#FFFF00","#FFFF80","#FFFF80","#FFAA00","#808080","#FFFF00","#FFFF80","#FFAA00","#808080","#FFFF00","#FFFF80","#FFAA00","#808080","#FFFF00","#FFFF00","#FFFF80","#808080","#808080","#FFFF00","#FFFF80","#FFAA00","#808080","#FFFF80","#FFFF00","#808080","#808080","#FFFF00","#808080","#808080","#808080","#808080","#FFFF80","#808080","#808080"],"fillOpacity":0.6,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[42.835984,-72.5850351,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":1,"fill":true,"fillColor":"green","fillOpacity":1},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[42.8410302,-72.5492016,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":1,"fill":true,"fillColor":"red","fillOpacity":1},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[-72.5850351,-72.5492016],"lat":[42.835984,42.8410302]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#27d8db","weight":3,"opacity":1,"fill":false,"fillColor":"#27d8db","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#FFFF80","#FFFF00","#FFAA00","#FF5500","#FF0000"],"labels":["primary","residential","secondary","tertiary","trunk"],"na_color":"#808080","na_label":"NA","opacity":1,"position":"bottomright","type":"factor","title":"Road Type","extra":null,"layerId":null,"className":"info legend","group":null}]}],"limits":{"lat":[42.81543759624775,42.86210476146245],"lng":[-72.60056061290285,-72.53370215429084]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>For each hexagon, we calculate the distance from the treatment plant, we then use a neighborhood function to navigate from the start hexagon to the end hexagon using minimum distance, but only through hexagons with a road type that is likely to have a sewer network. This allows us to calculate a more accurate distance to the treatment plant.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the h3 level 9 hexagon for the treatment plant</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>end.hex <span class="ot">&lt;-</span> h3<span class="sc">::</span><span class="fu">geo_to_h3</span>(end,<span class="dv">9</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>end.hex.sf <span class="ot">&lt;-</span> <span class="fu">h3_to_geo_boundary_sf</span>(end.hex)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine distance for surrounding hexagons</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>hex.dist <span class="ot">&lt;-</span> <span class="fu">k_ring_distances</span>(end.hex, <span class="at">radius =</span> <span class="dv">20</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># filter hexagons based on road type and join distances</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>hex.roads <span class="ot">&lt;-</span> hex.hwy<span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(highway <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"trunk"</span>,<span class="st">"primary"</span>,<span class="st">"secondary"</span>,<span class="st">"tertiary"</span>,<span class="st">"residential"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hex.dist)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify hexagon of starting point</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>start.hex <span class="ot">&lt;-</span> h3<span class="sc">::</span><span class="fu">geo_to_h3</span>(start,<span class="dv">9</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># project hexagons for distance measures</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>hex.roads.prj <span class="ot">&lt;-</span> hex.roads<span class="sc">%&gt;%</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">5070</span>))</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>hex.end.prj <span class="ot">&lt;-</span> end.hex.sf<span class="sc">%&gt;%</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="fu">st_crs</span>(<span class="dv">5070</span>))</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a loop that uses h3 neighborhood to find the shortest distance to the treatment plant</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>hex.current <span class="ot">&lt;-</span> start.hex</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty data frame to store the navigation</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>nav <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Nav =</span> <span class="dv">1</span>, <span class="at">h3_index =</span> start.hex)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(<span class="sc">!</span>hex.current <span class="sc">==</span> end.hex){</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get neighbors</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  neighbors <span class="ot">&lt;-</span> h3<span class="sc">::</span><span class="fu">k_ring</span>(hex.current,<span class="dv">1</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Identify the neighbor that has the smallest distance value in hex.roads</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  neighbor.minDist <span class="ot">&lt;-</span> hex.roads.prj<span class="sc">%&gt;%</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(h3_index <span class="sc">%in%</span> neighbors)<span class="sc">%&gt;%</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(distance <span class="sc">==</span> <span class="fu">min</span>(distance))</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If more than one row, calculate straight line distance to treatment plant and use the shorter one</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(neighbor.minDist) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    neighbor.minDist <span class="ot">&lt;-</span> neighbor.minDist<span class="sc">%&gt;%</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">dist_to_end =</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(.,hex.end.prj)))<span class="sc">%&gt;%</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(dist_to_end <span class="sc">==</span> <span class="fu">min</span>(dist_to_end))</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Once a hexagon has been used, remove it</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>  hex.roads.prj <span class="ot">&lt;-</span> hex.roads.prj<span class="sc">%&gt;%</span></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>h3_index <span class="sc">==</span> hex.current)</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>  hex.current <span class="ot">&lt;-</span> neighbor.minDist<span class="sc">$</span>h3_index[<span class="dv">1</span>]</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add to the navigation data frame</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>  nav <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nav,<span class="fu">data.frame</span>(<span class="at">Nav =</span> n, <span class="at">h3_index =</span> hex.current))</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if loop gets stuck in never-ending loop, break it</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(n <span class="sc">&gt;</span> <span class="dv">100</span>){</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Get centroids for the nav hexagons and draw a line</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>nav.centroids <span class="ot">&lt;-</span> h3<span class="sc">::</span><span class="fu">h3_to_geo_boundary_sf</span>(nav<span class="sc">$</span>h3_index)<span class="sc">%&gt;%</span></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>nav.line <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">st_coordinates</span>(nav.centroids))<span class="sc">%&gt;%</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>))<span class="sc">%&gt;%</span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sf</span>()</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>nav.smooth <span class="ot">&lt;-</span> smoothr<span class="sc">::</span><span class="fu">smooth</span>(nav.line,<span class="at">method =</span> <span class="st">"ksmooth"</span>)</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Save data for quick rendering</span></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(nav.smooth,<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"navSmooth"</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>nav.smooth <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">"Documentation/Data/hex_examples.gpkg"</span>), <span class="at">layer =</span> <span class="st">"navSmooth"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>()<span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">"Esri.WorldImagery"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">data =</span> hex.hwy, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fillOpacity =</span> <span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data =</span> start, <span class="at">fillColor =</span> <span class="st">"green"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">fillOpacity =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(<span class="at">data =</span> end, <span class="at">fillColor =</span> <span class="st">"red"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">weight =</span> <span class="dv">1</span>, <span class="at">opacity =</span> <span class="dv">1</span>, <span class="at">fillOpacity =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolylines</span>(<span class="at">data =</span> line, <span class="at">color =</span> <span class="st">"#27d8db"</span>,<span class="at">weight =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPolylines</span>(<span class="at">data =</span> nav.smooth, <span class="at">color =</span> <span class="st">"#34d15e"</span>, <span class="at">weight =</span> <span class="dv">3</span>, <span class="at">opacity =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-7e2d6b577b7dde4b3f17" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7e2d6b577b7dde4b3f17">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[-72.59607459089516,-72.59829986318871,-72.59828217104909,-72.59603938190702,-72.59381419859176,-72.59383171544039,-72.59607459089516],"lat":[42.8266508387449,42.8257184690383,42.82391464800677,42.82304319907096,42.82397549929459,42.82577931793401,42.8266508387449]}]],[[{"lng":[-72.5916063602406,-72.59383171544039,-72.59381419859176,-72.59157150183388,-72.58934623563603,-72.58936357719421,-72.5916063602406],"lat":[42.82671159945647,42.82577931793401,42.82397549929459,42.82310396458122,42.82403617662833,42.82583999286114,42.82671159945647]}]],[[{"lng":[-72.58713813911562,-72.58936357719421,-72.58934623563603,-72.58710363128927,-72.58487828223623,-72.5848954485045,-72.58713813911562],"lat":[42.82677218619276,42.82583999286114,42.82403617662833,42.82316455614513,42.82409668000899,42.82590049382079,42.82677218619276]}]],[[{"lng":[-72.58487828223623,-72.58710363128927,-72.58708637940644,-72.58484395373968,-72.58261869371366,-72.58263577032747,-72.58487828223623],"lat":[42.82409668000899,42.82316455614513,42.8213607955005,42.82048916114475,42.82142121554713,42.82322497376372,42.82409668000899]}]],[[{"lng":[-72.58266992757453,-72.5848954485045,-72.58487828223623,-72.58263577032747,-72.58041033844667,-72.58042732942556,-72.58266992757453],"lat":[42.82683259895483,42.82590049382079,42.82409668000899,42.82322497376372,42.82415700943761,42.82596082081392,42.82683259895483]}]],[[{"lng":[-72.58041033844667,-72.58263577032747,-72.58261869371366,-72.58037636048761,-72.57815101765742,-72.57816791900278,-72.58041033844667],"lat":[42.82415700943761,42.82322497376372,42.82142121554713,42.82054949544392,42.82148146166394,42.82328521743804,42.82415700943761]}]],[[{"lng":[-72.57594240432164,-72.57816791900278,-72.57815101765742,-72.57590877689896,-72.57368335129206,-72.57370007736949,-72.57594240432164],"lat":[42.82421716491525,42.82328521743804,42.82148146166394,42.82060965582102,42.82154153385197,42.82334528716913,42.82421716491525]}]],[[{"lng":[-72.57368335129206,-72.57590877689896,-72.57589196516604,-72.57364990307332,-72.57142456654212,-72.57144120302804,-72.57368335129206],"lat":[42.82154153385197,42.82060965582102,42.81880595565813,42.81793413598714,42.81886594457815,42.8206696422771,42.82154153385197]}]],[[{"lng":[-72.57147447991548,-72.57370007736949,-72.57368335129206,-72.57144120302804,-72.56921569467187,-72.56923224548196,-72.57147447991548],"lat":[42.82427714644295,42.82334528716913,42.82154153385197,42.8206696422771,42.82160143211227,42.82340518295801,42.82427714644295]}]],[[{"lng":[-72.56921569467187,-72.57144120302804,-72.57142456654212,-72.56918259694656,-72.56695717768967,-72.56697363892917,-72.56921569467187],"lat":[42.82160143211227,42.8206696422771,42.81886594457815,42.81799403918983,42.81892575959267,42.8207294548132,42.82160143211227]}]],[[{"lng":[-72.56700656528245,-72.56923224548196,-72.56921569467187,-72.56697363892917,-72.56474804785113,-72.56476442339444,-72.56700656528245],"lat":[42.82433695402178,42.82340518295801,42.82160143211227,42.8207294548132,42.82166115644591,42.82346490480577,42.82433695402178]}]],[[{"lng":[-72.56474804785113,-72.56697363892917,-72.56695717768967,-72.56471530061815,-72.56248979866299,-72.5625060846566,-72.56474804785113],"lat":[42.82166115644591,42.8207294548132,42.81892575959267,42.81805376849474,42.81898540070273,42.82078909343038,42.82166115644591]}]],[[{"lng":[-72.56028041088415,-72.5625060846566,-72.56248979866299,-72.56024801414233,-72.55802242951634,-72.55803854026466,-72.56028041088415],"lat":[42.82172070685392,42.82078909343038,42.81898540070273,42.81811332390295,42.81904486790938,42.82084855812973,42.82172070685392]}]],[[{"lng":[-72.55802242951634,-72.56024801414233,-72.56023181767732,-72.55799021181083,-72.55576471633277,-72.5557807375734,-72.55802242951634],"lat":[42.81904486790938,42.81811332390295,42.81630968681648,42.81543759624775,42.81636907084339,42.81817270541554,42.81904486790938]}]],[[{"lng":[-72.5558127838252,-72.55803854026466,-72.55802242951634,-72.5557807375734,-72.55355507030401,-72.55357100580761,-72.5558127838252],"lat":[42.82178008333742,42.82084855812973,42.81904486790938,42.81817270541554,42.81910416121373,42.82090784891228,42.82178008333742]}]],[[{"lng":[-72.55355507030401,-72.5557807375734,-72.55576471633277,-72.55352320304668,-72.5512976249488,-72.55131347096564,-72.55355507030401],"lat":[42.81910416121373,42.81817270541554,42.81636907084339,42.81549689459519,42.81642828099019,42.81823191303359,42.81910416121373]}]],[[{"lng":[-72.54908772108028,-72.55131347096564,-72.5512976249488,-72.54905620426995,-72.54683054357969,-72.54684621437332,-72.54908772108028],"lat":[42.81916328061683,42.81823191303359,42.81642828099019,42.81555601907029,42.81648731725798,42.81829094675814,42.81916328061683]}]],[[{"lng":[-72.59386675326094,-72.59609219746115,-72.59607459089516,-72.59383171544039,-72.5916063602406,-72.59162379149524,-72.59386675326094],"lat":[42.82938706396065,42.8284547129565,42.8266508387449,42.82577931793401,42.82671159945647,42.8285154712685,42.82938706396065]}]],[[{"lng":[-72.59833525163249,-72.60056061290285,-72.60054283102498,-72.59829986318871,-72.59607459089516,-72.59609219746115,-72.59833525163249],"lat":[42.82932621984962,42.82839378065376,42.82658990405704,42.8257184690383,42.8266508387449,42.8284547129565,42.82932621984962]}]],[[{"lng":[-72.58939826439259,-72.59162379149524,-72.5916063602406,-72.58936357719421,-72.58713813911562,-72.58715539505944,-72.58939826439259],"lat":[42.82944773407422,42.8285154712685,42.82671159945647,42.82583999286114,42.82677218619276,42.82857605559078,42.82944773407422]}]],[[{"lng":[-72.57820172567165,-72.58042732942556,-72.58041033844667,-72.57816791900278,-72.57594240432164,-72.57595922001171,-72.57820172567165],"lat":[42.82689283774371,42.82596082081392,42.82415700943761,42.82328521743804,42.82421716491525,42.82602097384161,42.82689283774371]}]],[[{"lng":[-72.5625386604769,-72.56476442339444,-72.56474804785113,-72.5625060846566,-72.56028041088415,-72.56029661116123,-72.5625386604769],"lat":[42.82439658765276,42.82346490480577,42.82166115644591,42.82078909343038,42.82172070685392,42.82352445271348,42.82439658765276]}]],[[{"lng":[-72.55134516672859,-72.55357100580761,-72.55355507030401,-72.55131347096564,-72.54908772108028,-72.54910348133977,-72.55134516672859],"lat":[42.82183928589746,42.82090784891228,42.81910416121373,42.81823191303359,42.81916328061683,42.82096696577917,42.82183928589746]}]],[[{"lng":[-72.58492978508178,-72.58715539505944,-72.58713813911562,-72.5848954485045,-72.58266992757453,-72.58268700820808,-72.58492978508178],"lat":[42.82950823019133,42.82857605559078,42.82677218619276,42.82590049382079,42.82683259895483,42.82863646592438,42.82950823019133]}]],[[{"lng":[-72.57373353346129,-72.57595922001171,-72.57594240432164,-72.57370007736949,-72.57147447991548,-72.57149112031729,-72.57373353346129],"lat":[42.82695290256042,42.82602097384161,42.82421716491525,42.82334528716913,42.82427714644295,42.8260809529049,42.82695290256042]}]],[[{"lng":[-72.55807076555314,-72.56029661116123,-72.56028041088415,-72.55803854026466,-72.5558127838252,-72.55582880883668,-72.55807076555314],"lat":[42.82445604733701,42.82352445271348,42.82172070685392,42.82084855812973,42.82178008333742,42.82358382668219,42.82445604733701]}]],[[{"lng":[-72.54687755964864,-72.54910348133977,-72.54908772108028,-72.54684621437332,-72.54462038189945,-72.54463596691539,-72.54687755964864],"lat":[42.82189831453513,42.82096696577917,42.81916328061683,42.81829094675814,42.81922222611979,42.82102590873145,42.82189831453513]}]],[[{"lng":[-72.59612741473781,-72.59835294793699,-72.59833525163249,-72.59609219746115,-72.59386675326094,-72.59388427423316,-72.59612741473781],"lat":[42.83206257011658,42.83113014962444,42.82932621984962,42.8284547129565,42.82938706396065,42.83119099134292,42.83206257011658]}]],[[{"lng":[-72.58046131538285,-72.58268700820808,-72.58266992757453,-72.58042732942556,-72.57820172567165,-72.57821863099548,-72.58046131538285],"lat":[42.82956855231304,42.82863646592438,42.82683259895483,42.82596082081392,42.82689283774371,42.82869670227031,42.82956855231304]}]],[[{"lng":[-72.56926535099781,-72.57149112031729,-72.57147447991548,-72.56923224548196,-72.56700656528245,-72.5670230303966,-72.56926535099781],"lat":[42.82701279340605,42.8260809529049,42.82427714644295,42.82340518295801,42.82433695402178,42.82614075800487,42.82701279340605]}]],[[{"lng":[-72.55360288056542,-72.55582880883668,-72.5558127838252,-72.55357100580761,-72.55134516672859,-72.55136101647503,-72.55360288056542],"lat":[42.82451533307558,42.82358382668219,42.82178008333742,42.82090784891228,42.82183928589746,42.82364302671299,42.82451533307558]}]],[[{"lng":[-72.5916586581079,-72.59388427423316,-72.59386675326094,-72.59162379149524,-72.58939826439259,-72.5894156100331,-72.5916586581079],"lat":[42.83212332362903,42.83119099134292,42.82938706396065,42.8285154712685,42.82944773407422,42.83125165904947,42.83212332362903]}]],[[{"lng":[-72.57599285535012,-72.57821863099548,-72.57820172567165,-72.57595922001171,-72.57373353346129,-72.57375026347596,-72.57599285535012],"lat":[42.82962870044041,42.82869670227031,42.82689283774371,42.82602097384161,42.82695290256042,42.82875676462962,42.82962870044041]}]],[[{"lng":[-72.56479717833545,-72.5670230303966,-72.56700656528245,-72.56476442339444,-72.5625386604769,-72.56255495030391,-72.56479717833545],"lat":[42.82707251028163,42.82614075800487,42.82433695402178,42.82346490480577,42.82439658765276,42.82620038914255,42.82707251028163]}]],[[{"lng":[-72.54913500556808,-72.55136101647503,-72.55134516672859,-72.54910348133977,-72.54687755964864,-72.54689323413062,-72.54913500556808],"lat":[42.82457444486955,42.82364302671299,42.82183928589746,42.82096696577917,42.82189831453513,42.82370205280696,42.82457444486955]}]],[[{"lng":[-72.5871899110092,-72.5894156100331,-72.58939826439259,-72.58715539505944,-72.58492978508178,-72.58494695539112,-72.5871899110092],"lat":[42.83218390312283,42.83125165904947,42.82944773407422,42.82857605559078,42.82950823019133,42.83131215274513,42.83218390312283]}]],[[{"lng":[-72.57152440503791,-72.57375026347596,-72.57373353346129,-72.57149112031729,-72.56926535099781,-72.56928190570386,-72.57152440503791],"lat":[42.82968867457445,42.82875676462962,42.82695290256042,42.8260809529049,42.82701279340605,42.82881665300339,42.82968867457445]}]],[[{"lng":[-72.56032901552859,-72.56255495030391,-72.5625386604769,-72.56029661116123,-72.55807076555314,-72.5580868800936,-72.56032901552859],"lat":[42.82713205318824,42.82620038914255,42.82439658765276,42.82352445271348,42.82445604733701,42.82625984631901,42.82713205318824]}]],[[{"lng":[-72.5939193203024,-72.59614502544878,-72.59612741473781,-72.59388427423316,-72.5916586581079,-72.59167609346628,-72.5939193203024],"lat":[42.83479895483291,42.83386655306008,42.83206257011658,42.83119099134292,42.83212332362903,42.83392730417253,42.83479895483291]}]],[[{"lng":[-72.58272117349604,-72.58494695539112,-72.58492978508178,-72.58268700820808,-72.58046131538285,-72.58047831036156,-72.58272117349604],"lat":[42.83224430859902,42.83131215274513,42.82950823019133,42.82863646592438,42.82956855231304,42.8313724724309,42.83224430859902]}]],[[{"lng":[-72.56705596450055,-72.56928190570386,-72.56926535099781,-72.5670230303966,-72.56479717833545,-72.56481355773349,-72.56705596450055],"lat":[42.82974847471623,42.82881665300339,42.82701279340605,42.82614075800487,42.82707251028163,42.82887636739267,42.82974847471623]}]],[[{"lng":[-72.55586086263152,-72.5580868800936,-72.55807076555314,-72.55582880883668,-72.55360288056542,-72.55361881981992,-72.55586086263152],"lat":[42.82719142212695,42.82625984631901,42.82445604733701,42.82358382668219,42.82451533307558,42.82631912953535,42.82719142212695]}]],[[{"lng":[-72.58945030539762,-72.59167609346628,-72.5916586581079,-72.5894156100331,-72.5871899110092,-72.58720717101548,-72.58945030539762],"lat":[42.83485961772501,42.83392730417253,42.83212332362903,42.83125165904947,42.83218390312283,42.83398788125188,42.83485961772501]}]],[[{"lng":[-72.57825244562271,-72.58047831036156,-72.58046131538285,-72.57821863099548,-72.57599285535012,-72.57600967499874,-72.57825244562271],"lat":[42.83230454005863,42.8313724724309,42.82956855231304,42.82869670227031,42.82962870044041,42.83143261810787,42.83230454005863]}]],[[{"lng":[-72.56258753379237,-72.56481355773349,-72.56479717833545,-72.56255495030391,-72.56032901552859,-72.56034521961914,-72.56258753379237],"lat":[42.82980810086682,42.82887636739267,42.82707251028163,42.82620038914255,42.82713205318824,42.8289359077985,42.82980810086682]}]],[[{"lng":[-72.55139271969854,-72.55361881981992,-72.55360288056542,-72.55136101647503,-72.54913500556808,-72.54915076953721,-72.55139271969854],"lat":[42.82725061709884,42.82631912953535,42.82451533307558,42.82364302671299,42.82457444486955,42.82637823879262,42.82725061709884]}]],[[{"lng":[-72.54692458678399,-72.54915076953721,-72.54913500556808,-72.54689323413062,-72.54466714061542,-72.54468272929975,-72.54692458678399],"lat":[42.82730963810498,42.82637823879262,42.82457444486955,42.82370205280696,42.82463338272001,42.82643717409194,42.82730963810498]}]],[[{"lng":[-72.58498130005201,-72.58720717101548,-72.5871899110092,-72.58494695539112,-72.58272117349604,-72.58273825815075,-72.58498130005201],"lat":[42.83492010657729,42.83398788125188,42.83218390312283,42.83131215274513,42.83224430859902,42.83404828429915,42.83492010657729]}]],[[{"lng":[-72.57378372744358,-72.57600967499874,-72.57599285535012,-72.57375026347596,-72.57152440503791,-72.57154104935702,-72.57378372744358],"lat":[42.83236459750271,42.83143261810787,42.82962870044041,42.82875676462962,42.82968867457445,42.83149258977706,42.83236459750271]}]],[[{"lng":[-72.55811911296769,-72.56034521961914,-72.56032901552859,-72.5580868800936,-72.55586086263152,-72.55587689141518,-72.55811911296769],"lat":[42.82986755302729,42.8289359077985,42.82713205318824,42.82625984631901,42.82719142212695,42.82899527422197,42.82986755302729]}]],[[{"lng":[-72.58051230431988,-72.58273825815075,-72.58272117349604,-72.58047831036156,-72.57825244562271,-72.57826935492643,-72.58051230431988],"lat":[42.83498042139079,42.83404828429915,42.83224430859902,42.8313724724309,42.83230454005863,42.83410851331537,42.83498042139079]}]],[[{"lng":[-72.569315019013,-72.57154104935702,-72.57152440503791,-72.56928190570386,-72.56705596450055,-72.56707243349069,-72.569315019013],"lat":[42.83242448093232,42.83149258977706,42.82968867457445,42.82881665300339,42.82974847471623,42.83155238743955,42.83242448093232]}]],[[{"lng":[-72.55365070208084,-72.55587689141518,-72.55586086263152,-72.55361881981992,-72.55139271969854,-72.55140857317591,-72.55365070208084],"lat":[42.82992683119871,42.82899527422197,42.82719142212695,42.82631912953535,42.82725061709884,42.82905446666418,42.82992683119871]}]],[[{"lng":[-72.59171096828779,-72.59393684539972,-72.5939193203024,-72.59167609346628,-72.58945030539762,-72.58946765512194,-72.59171096828779],"lat":[42.83753537397361,42.83660299093567,42.83479895483291,42.83392730417253,42.83485961772501,42.83666365142033,42.83753537397361]}]],[[{"lng":[-72.57604331825563,-72.57826935492643,-72.57825244562271,-72.57600967499874,-72.57378372744358,-72.57380046139687,-72.57604331825563],"lat":[42.83504056216654,42.83410851331537,42.83230454005863,42.83143261810787,42.83236459750271,42.83416856830161,42.83504056216654]}]],[[{"lng":[-72.56484632038527,-72.56707243349069,-72.56705596450055,-72.56481355773349,-72.56258753379237,-72.56260382745413,-72.56484632038527],"lat":[42.83248419034852,42.83155238743955,42.82974847471623,42.82887636739267,42.82980810086682,42.83161201109637,42.83248419034852]}]],[[{"lng":[-72.54918230118611,-72.55140857317591,-72.55139271969854,-72.54915076953721,-72.54692458678399,-72.54694026495564,-72.54918230118611],"lat":[42.82998593538217,42.82905446666418,42.82725061709884,42.82637823879262,42.82730963810498,42.82911348512618,42.82998593538217]}]],[[{"lng":[-72.58724169509154,-72.58946765512194,-72.58945030539762,-72.58720717101548,-72.58498130005201,-72.58499847440386,-72.58724169509154],"lat":[42.83759594622361,42.83666365142033,42.83485961772501,42.83398788125188,42.83492010657729,42.83672413785072,42.83759594622361]}]],[[{"lng":[-72.57157434191359,-72.57380046139687,-72.57378372744358,-72.57154104935702,-72.569315019013,-72.5693315776164,-72.57157434191359],"lat":[42.8351005289056,42.83416856830161,42.83236459750271,42.83149258977706,42.83242448093232,42.83422844925892,42.8351005289056]}]],[[{"lng":[-72.56037763161473,-72.56260382745413,-72.56258753379237,-72.56034521961914,-72.55811911296769,-72.55813523130163,-72.56037763161473],"lat":[42.83254372575236,42.83161201109637,42.82980810086682,42.8289359077985,42.82986755302729,42.83167146074862,42.83254372575236]}]],[[{"lng":[-72.54471391033785,-72.54694026495564,-72.54692458678399,-72.54468272929975,-72.54245646394214,-72.54247196680871,-72.54471391033785],"lat":[42.83004486557874,42.82911348512618,42.82730963810498,42.82643717409194,42.82736848514648,42.82917232960908,42.83004486557874]}]],[[{"lng":[-72.58277243148245,-72.58499847440386,-72.58498130005201,-72.58273825815075,-72.58051230431988,-72.58052930329983,-72.58277243148245],"lat":[42.83765634441259,42.83672413785072,42.83492010657729,42.83404828429915,42.83498042139079,42.83678445022783,42.83765634441259]}]],[[{"lng":[-72.56710537534806,-72.5693315776164,-72.569315019013,-72.56707243349069,-72.56484632038527,-72.56486270363935,-72.56710537534806],"lat":[42.835160321609,42.83422844925892,42.83242448093232,42.83155238743955,42.83248419034852,42.83428815618835,42.835160321609]}]],[[{"lng":[-72.55590895275571,-72.55813523130163,-72.55811911296769,-72.55587689141518,-72.55365070208084,-72.55366664508753,-72.55590895275571],"lat":[42.83260308714492,42.83167146074862,42.82986755302729,42.82899527422197,42.82992683119871,42.83173073639734,42.83260308714492]}]],[[{"lng":[-72.55144028386259,-72.55366664508753,-72.55365070208084,-72.55140857317591,-72.54918230118611,-72.54919806886618,-72.55144028386259],"lat":[42.83266227452728,42.83173073639734,42.82992683119871,42.82905446666418,42.82998593538217,42.83178983804365,42.83266227452728]}]],[[{"lng":[-72.59397189972056,-72.59619786587426,-72.59618025101683,-72.59393684539972,-72.59171096828779,-72.5917284077513,-72.59397189972056],"lat":[42.84021117184428,42.83927871931458,42.83747462766156,42.83660299093567,42.83753537397361,42.8393394632262,42.84021117184428]}]],[[{"lng":[-72.58950235865547,-72.5917284077513,-72.59171096828779,-72.58946765512194,-72.58724169509154,-72.58725895916166,-72.58950235865547],"lat":[42.84027182751363,42.8393394632262,42.83753537397361,42.83666365142033,42.83759594622361,42.83940003306131,42.84027182751363]}]],[[{"lng":[-72.57830317751485,-72.58052930329983,-72.58051230431988,-72.57826935492643,-72.57604331825563,-72.5760601418642,-72.57830317751485],"lat":[42.83771656854164,42.83678445022783,42.83498042139079,42.83410851331537,42.83504056216654,42.83684458855275,42.83771656854164]}]],[[{"lng":[-72.56263641861342,-72.56486270363935,-72.56484632038527,-72.56260382745413,-72.56037763161473,-72.56039383952007,-72.56263641861342],"lat":[42.83521994027784,42.83428815618835,42.83248419034852,42.83161201109637,42.83254372575236,42.83434768909099,42.83521994027784]}]],[[{"lng":[-72.54697162498964,-72.54919806886618,-72.54918230118611,-72.54694026495564,-72.54471391033785,-72.54472950269188,-72.54697162498964],"lat":[42.83272128790053,42.83178983804365,42.82998593538217,42.82911348512618,42.83004486557874,42.8318487656886,42.83272128790053]}]],[[{"lng":[-72.58503282715117,-72.58725895916166,-72.58724169509154,-72.58499847440386,-72.58277243148245,-72.58278952015974,-72.58503282715117],"lat":[42.84033230909977,42.83940003306131,42.83759594622361,42.83672413785072,42.83765634441259,42.83946042882096,42.84033230909977]}]],[[{"lng":[-72.57383393324311,-72.5760601418642,-72.57604331825563,-72.57380046139687,-72.57157434191359,-72.57159099015134,-72.57383393324311],"lat":[42.83777661861176,42.83684458855275,42.83504056216654,42.83416856830161,42.8351005289056,42.83690455282651,42.83777661861176]}]],[[{"lng":[-72.55816747176405,-72.56039383952007,-72.56037763161473,-72.55813523130163,-72.55590895275571,-72.5559249853129,-72.55816747176405],"lat":[42.83527938491316,42.83434768909099,42.83254372575236,42.83167146074862,42.83260308714492,42.83440704796786,42.83527938491316]}]],[[{"lng":[-72.58056330526203,-72.58278952015974,-72.58277243148245,-72.58052930329983,-72.57830317751485,-72.57832009079985,-72.58056330526203],"lat":[42.84039261660373,42.83946042882096,42.83765634441259,42.83678445022783,42.83771656854164,42.83952065050617,42.84039261660373]}]],[[{"lng":[-72.56936469872159,-72.57159099015134,-72.57157434191359,-72.5693315776164,-72.56710537534806,-72.56712184821559,-72.56936469872159],"lat":[42.83783649462401,42.83690455282651,42.8351005289056,42.83422844925892,42.835160321609,42.83696434305018,42.83783649462401]}]],[[{"lng":[-72.56489547400462,-72.56712184821559,-72.56710537534806,-72.56486270363935,-72.56263641861342,-72.56265271611129,-72.56489547400462],"lat":[42.83789619657947,42.83696434305018,42.835160321609,42.83428815618835,42.83521994027784,42.8370239592248,42.83789619657947]}]],[[{"lng":[-72.55369853485422,-72.5559249853129,-72.55590895275571,-72.55366664508753,-72.55144028386259,-72.55145614107219,-72.55369853485422],"lat":[42.83533865551608,42.83440704796786,42.83260308714492,42.83173073639734,42.83266227452728,42.83446623282008,42.83533865551608]}]],[[{"lng":[-72.54250297619122,-72.54472950269188,-72.54471391033785,-72.54247196680871,-72.54024552959038,-72.54026094661897,-72.54250297619122],"lat":[42.83278012726576,42.8318487656886,42.83004486557874,42.82917232960908,42.83010362178952,42.83190751933333,42.83278012726576]}]],[[{"lng":[-72.59176329078458,-72.5939894289444,-72.59397189972056,-72.5917284077513,-72.58950235865547,-72.58951971246503,-72.59176329078458],"lat":[42.84294775042306,42.84201531664515,42.84021117184428,42.8393394632262,42.84027182751363,42.84207596990664,42.84294775042306]}]],[[{"lng":[-72.57609379304239,-72.57832009079985,-72.57830317751485,-72.5760601418642,-72.57383393324311,-72.57385067113638,-72.57609379304239],"lat":[42.84045275002655,42.83952065050617,42.83771656854164,42.83684458855275,42.83777661861176,42.83958069811801,42.84045275002655]}]],[[{"lng":[-72.56042625914658,-72.56265271611129,-72.56263641861342,-72.56039383952007,-72.55816747176405,-72.55818359389281,-72.56042625914658],"lat":[42.8379557244792,42.8370239592248,42.83521994027784,42.83434768909099,42.83527938491316,42.83708340135144,42.8379557244792]}]],[[{"lng":[-72.5492296079383,-72.55145614107219,-72.55144028386259,-72.54919806886618,-72.54697162498964,-72.54698730685226,-72.5492296079383],"lat":[42.83539775208762,42.83446623282008,42.83266227452728,42.83178983804365,42.83272128790053,42.83452524364873,42.83539775208762]}]],[[{"lng":[-72.58729349136691,-72.58951971246503,-72.58950235865547,-72.58725895916166,-72.58503282715117,-72.58505000554698,-72.58729349136691],"lat":[42.84300831542799,42.84207596990664,42.84027182751363,42.83940003306131,42.84033230909977,42.84213644907044,42.84300831542799]}]],[[{"lng":[-72.57162429054662,-72.57385067113638,-72.57383393324311,-72.57159099015134,-72.56936469872159,-72.56938126122368,-72.57162429054662],"lat":[42.84051270936927,42.83958069811801,42.83777661861176,42.83690455282651,42.83783649462401,42.83964057165753,42.84051270936927]}]],[[{"lng":[-72.55595705420183,-72.55818359389281,-72.55816747176405,-72.5559249853129,-72.55369853485422,-72.55371448161448,-72.55595705420183],"lat":[42.83801507832425,42.83708340135144,42.83527938491316,42.83440704796786,42.83533865551608,42.8371426694312,42.83801507832425]}]],[[{"lng":[-72.54476069107066,-72.54698730685226,-72.54697162498964,-72.54472950269188,-72.54250297619122,-72.54251848270746,-72.54476069107066],"lat":[42.83545667462892,42.83452524364873,42.83272128790053,42.8318487656886,42.83278012726576,42.83458408045489,42.83545667462892]}]],[[{"lng":[-72.582823701538,-72.58505000554698,-72.58503282715117,-72.58278952015974,-72.58056330526203,-72.58058030824461,-72.582823701538],"lat":[42.84306870632849,42.84213644907044,42.84033230909977,42.83946042882096,42.84039261660373,42.84219675413759,42.84306870632849]}]],[[{"lng":[-72.57835392135225,-72.58058030824461,-72.58056330526203,-72.57832009079985,-72.57609379304239,-72.57611062061231,-72.57835392135225],"lat":[42.84312892312564,42.84219675413759,42.84039261660373,42.83952065050617,42.84045275002655,42.84225688510914,42.84312892312564]}]],[[{"lng":[-72.56715479782909,-72.56938126122368,-72.56936469872159,-72.56712184821559,-72.56489547400462,-72.56491186111613,-72.56715479782909],"lat":[42.84057249463297,42.83964057165753,42.83783649462401,42.83696434305018,42.83789619657947,42.83970027112578,42.84057249463297]}]],[[{"lng":[-72.55148785922469,-72.55371448161448,-72.55369853485422,-72.55145614107219,-72.5492296079383,-72.54924537933064,-72.55148785922469],"lat":[42.83807425811573,42.8371426694312,42.83533865551608,42.83446623282008,42.83539775208762,42.83720176346515,42.83807425811573]}]],[[{"lng":[-72.58955442417047,-72.59178073435471,-72.59176329078458,-72.58951971246503,-72.58729349136691,-72.58731075950234,-72.58955442417047],"lat":[42.84568436337293,42.84475194836239,42.84294775042306,42.84207596990664,42.84300831542799,42.84481251095198,42.84568436337293]}]],[[{"lng":[-72.57388415086402,-72.57611062061231,-72.57609379304239,-72.57385067113638,-72.57162429054662,-72.57164094270445,-72.57388415086402],"lat":[42.84318896582047,42.84225688510914,42.84045275002655,42.83958069811801,42.84051270936927,42.84231684198613,42.84318896582047]}]],[[{"lng":[-72.56268531494416,-72.56491186111613,-72.56489547400462,-72.56265271611129,-72.56042625914658,-72.56044247086805,-72.56268531494416],"lat":[42.84063210581871,42.83970027112578,42.83789619657947,42.8370239592248,42.8379557244792,42.83975979652382,42.84063210581871]}]],[[{"lng":[-72.54701867426951,-72.54924537933064,-72.5492296079383,-72.54698730685226,-72.54476069107066,-72.54477628709567,-72.54701867426951],"lat":[42.83813326385469,42.83720176346515,42.83539775208762,42.83452524364873,42.83545667462892,42.83726068345437,42.83813326385469]}]],[[{"lng":[-72.58508436638358,-72.58731075950234,-72.58729349136691,-72.58505000554698,-72.582823701538,-72.58284079423929,-72.58508436638358],"lat":[42.84574483769164,42.84481251095198,42.84300831542799,42.84213644907044,42.84306870632849,42.8448728994227,42.84574483769164]}]],[[{"lng":[-72.56941439012769,-72.57164094270445,-72.57162429054662,-72.56938126122368,-72.56715479782909,-72.56717127457539,-72.56941439012769],"lat":[42.84324883441404,42.84231684198613,42.84051270936927,42.83964057165753,42.84057249463297,42.84237662476963,42.84324883441404]}]],[[{"lng":[-72.55821584194619,-72.56044247086805,-72.56042625914658,-72.55818359389281,-72.55595705420183,-72.55597309053384,-72.55821584194619],"lat":[42.84069154292754,42.83975979652382,42.8379557244792,42.83708340135144,42.83801507832425,42.83981914785273,42.84069154292754]}]],[[{"lng":[-72.54254949939067,-72.54477628709567,-72.54476069107066,-72.54251848270746,-72.54029178430559,-72.5403072049639,-72.54254949939067],"lat":[42.83819209554226,42.83726068345437,42.83545667462892,42.83458408045489,42.83551542314105,42.83731942939998,42.83819209554226]}]],[[{"lng":[-72.58061431821351,-72.58284079423929,-72.582823701538,-72.58058030824461,-72.57835392135225,-72.57837083861995,-72.58061431821351],"lat":[42.84580513788475,42.8448728994227,42.84306870632849,42.84219675413759,42.84312892312564,42.84493311377559,42.84580513788475]}]],[[{"lng":[-72.56494463919762,-72.56717127457539,-72.56715479782909,-72.56491186111613,-72.56268531494416,-72.56270161627948,-72.56494463919762],"lat":[42.84330852890741,42.84237662476963,42.84057249463297,42.83970027112578,42.84063210581871,42.8424362334607,42.84330852890741]}]],[[{"lng":[-72.55374637888957,-72.55597309053384,-72.55595705420183,-72.55371448161448,-72.55148785922469,-72.55150372016784,-72.55374637888957],"lat":[42.84075080596057,42.83981914785273,42.83801507832425,42.8371426694312,42.83807425811573,42.8398783251136,42.84075080596057]}]],[[{"lng":[-72.59181562560266,-72.59404202487157,-72.59402449151973,-72.59178073435471,-72.58955442417047,-72.58957178206668,-72.59181562560266],"lat":[42.84836045291032,42.84742796840424,42.84562371492763,42.84475194836239,42.84568436337293,42.84748861444126,42.84836045291032]}]],[[{"lng":[-72.58734529983963,-72.58957178206668,-72.58955442417047,-72.58731075950234,-72.58508436638358,-72.58510154882475,-72.58734529983963],"lat":[42.84842101066884,42.84748861444126,42.84568436337293,42.84481251095198,42.84574483769164,42.84754908633717,42.84842101066884]}]],[[{"lng":[-72.57614427971458,-72.57837083861995,-72.57835392135225,-72.57611062061231,-72.57388415086402,-72.57390089269869,-72.57614427971458],"lat":[42.84586526395332,42.84493311377559,42.84312892312564,42.84225688510914,42.84318896582047,42.8449931540117,42.84586526395332]}]],[[{"lng":[-72.56047489812821,-72.56270161627948,-72.56268531494416,-72.56044247086805,-72.55821584194619,-72.55823196787114,-72.56047489812821],"lat":[42.84336804930165,42.8424362334607,42.84063210581871,42.83975979652382,42.84069154292754,42.8424956680604,42.84336804930165]}]],[[{"lng":[-72.54927692582862,-72.55150372016784,-72.55148785922469,-72.54924537933064,-72.54701867426951,-72.54703435982441,-72.54927692582862],"lat":[42.84080989491883,42.8398783251136,42.83807425811573,42.83720176346515,42.83813326385469,42.8399373283075,42.84080989491883]}]],[[{"lng":[-72.58287498366698,-72.58510154882475,-72.58508436638358,-72.58284079423929,-72.58061431821351,-72.58063132520014,-72.58287498366698],"lat":[42.84848139427955,42.84754908633717,42.84574483769164,42.8448728994227,42.84580513788475,42.84760938409305,42.84848139427955]}]],[[{"lng":[-72.5716742509412,-72.57390089269869,-72.57388415086402,-72.57164094270445,-72.56941439012769,-72.56943095652987,-72.5716742509412],"lat":[42.8459252158984,42.8449931540117,42.84318896582047,42.84231684198613,42.84324883441404,42.84505302013208,42.8459252158984]}]],[[{"lng":[-72.5560051669738,-72.55823196787114,-72.55821584194619,-72.55597309053384,-72.55374637888957,-72.55376232940468,-72.5560051669738],"lat":[42.84342739559784,42.8424956680604,42.84069154292754,42.83981914785273,42.84075080596057,42.84255492856981,42.84342739559784]}]],[[{"lng":[-72.5448074828177,-72.54703435982441,-72.54701867426951,-72.54477628709567,-72.54254949939067,-72.54256500955792,-72.5448074828177],"lat":[42.84086880980345,42.8399373283075,42.83813326385469,42.83726068345437,42.83819209554226,42.83999615743555,42.84086880980345]}]],[[{"lng":[-72.57840467713915,-72.58063132520014,-72.58061431821351,-72.57837083861995,-72.57614427971458,-72.57616111124725,-72.57840467713915],"lat":[42.84854160374348,42.84760938409305,42.84580513788475,42.84493311377559,42.84586526395332,42.8476695077099,42.84854160374348]}]],[[{"lng":[-72.56720423194777,-72.56943095652987,-72.56941439012769,-72.56717127457539,-72.56494463919762,-72.56496103016792,-72.56720423194777],"lat":[42.84598499372103,42.84505302013208,42.84324883441404,42.84237662476963,42.84330852890741,42.84511271213779,42.84598499372103]}]],[[{"lng":[-72.55153544578879,-72.55376232940468,-72.55374637888957,-72.55150372016784,-72.54927692582862,-72.54929270093452,-72.55153544578879],"lat":[42.84348656779704,42.84255492856981,42.84075080596057,42.8398783251136,42.84080989491883,42.84261401499002,42.84348656779704]}]],[[{"lng":[-72.5403380499112,-72.54256500955792,-72.54254949939067,-72.5403072049639,-72.5380803346425,-72.53809566942267,-72.5403380499112],"lat":[42.84092755061553,42.83999615743555,42.83819209554226,42.83731942939998,42.83825075317953,42.84005481249883,42.84092755061553]}]],[[{"lng":[-72.58960650194693,-72.59183307328082,-72.59181562560266,-72.58957178206668,-72.58734529983963,-72.5873625720418,-72.58960650194693],"lat":[42.85109722523578,42.85016475951396,42.84836045291032,42.84748861444126,42.84842101066884,42.85022531485671,42.85109722523578]}]],[[{"lng":[-72.57393438031049,-72.57616111124725,-72.57614427971458,-72.57390089269869,-72.5716742509412,-72.57169090702045,-72.57393438031049],"lat":[42.8486016390617,42.8476695077099,42.84586526395332,42.8449931540117,42.8459252158984,42.8477294571888,42.8486016390617]}]],[[{"lng":[-72.56273422278863,-72.56496103016792,-72.56494463919762,-72.56270161627948,-72.56047489812821,-72.56049111366717,-72.56273422278863],"lat":[42.84604459742231,42.84511271213779,42.84330852890741,42.8424362334607,42.84336804930165,42.84517223002992,42.84604459742231]}]],[[{"lng":[-72.54706573462751,-72.54929270093452,-72.54927692582862,-72.54703435982441,-72.5448074828177,-72.54482308251499,-72.54706573462751],"lat":[42.84354556590036,42.84261401499002,42.84080989491883,42.8399373283075,42.84086880980345,42.84267292732212,42.84354556590036]}]],[[{"lng":[-72.58513591775353,-72.5873625720418,-72.58734529983963,-72.58510154882475,-72.58287498366698,-72.58289208039369,-72.58513591775353],"lat":[42.85115769228572,42.85022531485671,42.84842101066884,42.84754908633717,42.84848139427955,42.85028569603721,42.85115769228572]}]],[[{"lng":[-72.56946409323544,-72.57169090702045,-72.5716742509412,-72.56943095652987,-72.56720423194777,-72.56722071257417,-72.56946409323544],"lat":[42.84866150023526,42.8477294571888,42.8459252158984,42.84505302013208,42.84598499372103,42.8477892325308,42.84866150023526]}]],[[{"lng":[-72.55826422351819,-72.56049111366717,-72.56047489812821,-72.55823196787114,-72.5560051669738,-72.55602120708201,-72.55826422351819],"lat":[42.8461040270033,42.84517223002992,42.84336804930165,42.8424956680604,42.84342739559784,42.8452315738095,42.8461040270033]}]],[[{"lng":[-72.54259603354437,-72.54482308251499,-72.5448074828177,-72.54256500955792,-72.5403380499112,-72.54035347420049,-72.54259603354437],"lat":[42.84360438990888,42.84267292732212,42.84086880980345,42.83999615743555,42.84092755061553,42.84273166556721,42.84360438990888]}]],[[{"lng":[-72.58066534317855,-72.58289208039369,-72.58287498366698,-72.58063132520014,-72.57840467713915,-72.57842159839095,-72.58066534317855],"lat":[42.85121798516668,42.85028569603721,42.84848139427955,42.84760938409305,42.84854160374348,42.85034590305645,42.85121798516668]}]],[[{"lng":[-72.56499381596834,-72.56722071257417,-72.56720423194777,-72.56496103016792,-72.56273422278863,-72.56275052796276,-72.56499381596834],"lat":[42.84872118726521,42.8477892325308,42.84598499372103,42.84511271213779,42.84604459742231,42.84784883373695,42.84872118726521]}]],[[{"lng":[-72.55379423419085,-72.55602120708201,-72.5560051669738,-72.55376232940468,-72.55153544578879,-72.55155131046683,-72.55379423419085],"lat":[42.84616328246506,42.8452315738095,42.84342739559784,42.84255492856981,42.84348656779704,42.84529074347764,42.84616328246506]}]],[[{"lng":[-72.58739712051398,-72.58962386393127,-72.58960650194693,-72.5873625720418,-72.58513591775353,-72.58515310424148,-72.58739712051398],"lat":[42.85383403187898,42.85290158495701,42.85109722523578,42.85022531485671,42.85115769228572,42.85296204958375,42.85383403187898]}]],[[{"lng":[-72.5761947782764,-72.57842159839095,-72.57840467713915,-72.57616111124725,-72.57393438031049,-72.57395112608795,-72.5761947782764],"lat":[42.85127810387968,42.85034590305645,42.84854160374348,42.8476695077099,42.8486016390617,42.8504059359155,42.85127810387968]}]],[[{"lng":[-72.56052354856364,-72.56275052796276,-72.56273422278863,-72.56049111366717,-72.55826422351819,-72.55828035324065,-72.56052354856364],"lat":[42.84878070015261,42.84784883373695,42.84604459742231,42.84517223002992,42.8461040270033,42.84790826080835,42.84878070015261]}]],[[{"lng":[-72.54932425486096,-72.55155131046683,-72.55153544578879,-72.54929270093452,-72.54706573462751,-72.54708142387599,-72.54932425486096],"lat":[42.84622236380869,42.84529074347764,42.84348656779704,42.84261401499002,42.84354556590036,42.84534973903542,42.84622236380869]}]],[[{"lng":[-72.58292627787364,-72.58515310424148,-72.58513591775353,-72.58289208039369,-72.58066534317855,-72.58068235417065,-72.58292627787364],"lat":[42.85389440819858,42.85296204958375,42.85115769228572,42.85028569603721,42.85121798516668,42.85302234002702,42.85389440819858]}]],[[{"lng":[-72.57172422310147,-72.57395112608795,-72.57393438031049,-72.57169090702045,-72.56946409323544,-72.56948066353911,-72.57172422310147],"lat":[42.85133804842578,42.8504059359155,42.8486016390617,42.8477294571888,42.84866150023526,42.85046579461542,42.85133804842578]}]],[[{"lng":[-72.55605329107567,-72.55828035324065,-72.55826422351819,-72.55602120708201,-72.55379423419085,-72.55381018846218,-72.55605329107567],"lat":[42.84884003889856,42.84790826080835,42.8461040270033,42.8452315738095,42.84616328246506,42.84796751374606,42.84884003889856]}]],[[{"lng":[-72.54485428558289,-72.54708142387599,-72.54706573462751,-72.54482308251499,-72.54259603354437,-72.54261154736389,-72.54485428558289],"lat":[42.84628127103525,42.84534973903542,42.84354556590036,42.84267292732212,42.84360438990888,42.84540856048395,42.84628127103525]}]],[[{"lng":[-72.54038432641103,-72.54261154736389,-72.54259603354437,-72.54035347420049,-72.53812634259374,-72.53814168098489,-72.54038432641103],"lat":[42.84634000414588,42.84540856048395,42.84360438990888,42.84273166556721,42.84366303982369,42.8454672078243,42.84634000414588]}]],[[{"lng":[-72.57845544487976,-72.58068235417065,-72.58066534317855,-72.57842159839095,-72.5761947782764,-72.57621161377321,-72.57845544487976],"lat":[42.85395461032801,42.85302234002702,42.85121798516668,42.85034590305645,42.85127810387968,42.85308245628788,42.85395461032801]}]],[[{"lng":[-72.56725367770817,-72.56948066353911,-72.56946409323544,-72.56722071257417,-72.56499381596834,-72.56501021079877,-72.56725367770817],"lat":[42.85139781880603,42.85046579461542,42.84866150023526,42.8477892325308,42.84872118726521,42.85052547915727,42.85139781880603]}]],[[{"lng":[-72.55158304355885,-72.55381018846218,-72.55379423419085,-72.55155131046683,-72.54932425486096,-72.54934003368174,-72.55158304355885],"lat":[42.84889920350412,42.84796751374606,42.84616328246506,42.84529074347764,42.84622236380869,42.84802659255116,42.84889920350412]}]],[[{"lng":[-72.57398462158673,-72.57621161377321,-72.5761947782764,-72.57395112608795,-72.57172422310147,-72.57174088310354,-72.57398462158673],"lat":[42.85401463826829,42.85308245628788,42.85127810387968,42.8504059359155,42.85133804842578,42.85314239836734,42.85401463826829]}]],[[{"lng":[-72.56278314215089,-72.56501021079877,-72.56499381596834,-72.56275052796276,-72.56052354856364,-72.56053976792143,-72.56278314215089],"lat":[42.85145741502151,42.85052547915727,42.84872118726521,42.84784883373695,42.84878070015261,42.8505849895421,42.85145741502151]}]],[[{"lng":[-72.54711280606756,-72.54934003368174,-72.54932425486096,-72.54708142387599,-72.54485428558289,-72.54486988895377,-72.54711280606756],"lat":[42.84895819397039,42.84802659255116,42.84622236380869,42.84534973903542,42.84628127103525,42.84808549722475,42.84895819397039]}]],[[{"lng":[-72.58518748126528,-72.58741439678433,-72.58739712051398,-72.58515310424148,-72.58292627787364,-72.58294337862721,-72.58518748126528],"lat":[42.85657087281487,42.85563844470836,42.85383403187898,42.85296204958375,42.85389440819858,42.8556988185973,42.85657087281487]}]],[[{"lng":[-72.56951380804897,-72.57174088310354,-72.57172422310147,-72.56948066353911,-72.56725367770817,-72.56727016221608,-72.56951380804897],"lat":[42.85407449202047,42.85314239836734,42.85133804842578,42.85046579461542,42.85139781880603,42.85320216626651,42.85407449202047]}]],[[{"lng":[-72.55831261648407,-72.56053976792143,-72.56052354856364,-72.55828035324065,-72.55605329107567,-72.55606933496139,-72.55831261648407],"lat":[42.85151683707328,42.8505849895421,42.84878070015261,42.84790826080835,42.84884003889856,42.850644325771,42.85151683707328]}]],[[{"lng":[-72.55384210076205,-72.55606933496139,-72.55605329107567,-72.55381018846218,-72.55158304355885,-72.55159891197312,-72.55384210076205],"lat":[42.8515760849624,42.850644325771,42.84884003889856,42.84796751374606,42.84889920350412,42.85070348784505,42.8515760849624]}]],[[{"lng":[-72.54264257865621,-72.54486988895377,-72.54485428558289,-72.54261154736389,-72.54038432641103,-72.5403997543326,-72.54264257865621],"lat":[42.84901701029845,42.84808549722475,42.84628127103525,42.84540856048395,42.84634000414588,42.84814422776791,42.84901701029845]}]],[[{"lng":[-72.58071638016143,-72.58294337862721,-72.58292627787364,-72.58068235417065,-72.57845544487976,-72.57847237011708,-72.58071638016143],"lat":[42.85663115838236,42.8556988185973,42.85389440819858,42.85302234002702,42.85395461032801,42.85575901828159,42.85663115838236]}]],[[{"lng":[-72.56504300432088,-72.56727016221608,-72.56725367770817,-72.56501021079877,-72.56278314215089,-72.5627994511652,-72.56504300432088],"lat":[42.85413417158567,42.85320216626651,42.85139781880603,42.85052547915727,42.85145741502151,42.85326175998642,42.85413417158567]}]],[[{"lng":[-72.54937159503926,-72.55159891197312,-72.55158304355885,-72.54934003368174,-72.54711280606756,-72.54712849901094,-72.54937159503926],"lat":[42.85163515869,42.85070348784505,42.84889920350412,42.84802659255116,42.84895819397039,42.85076247576531,42.85163515869]}]],[[{"lng":[-72.53817236137917,-72.5403997543326,-72.54038432641103,-72.53814168098489,-72.53591437739979,-72.53592962987263,-72.53817236137917],"lat":[42.84907565248941,42.84814422776791,42.84634000414588,42.8454672078243,42.84639856314165,42.84820278418176,42.84907565248941]}]],[[{"lng":[-72.57624528873207,-72.57847237011708,-72.57845544487976,-72.57621161377321,-72.57398462158673,-72.57400137130837,-72.57624528873207],"lat":[42.85669126973846,42.85575901828159,42.85395461032801,42.85308245628788,42.85401463826829,42.85581904376227,42.85669126973846]}]],[[{"lng":[-72.5605722104569,-72.5627994511652,-72.56278314215089,-72.56053976792143,-72.55831261648407,-72.55832875000534,-72.5605722104569],"lat":[42.85419367696489,42.85326175998642,42.85145741502151,42.8505849895421,42.85151683707328,42.85332117952814,42.85419367696489]}]],[[{"lng":[-72.54490109937011,-72.54712849901094,-72.54711280606756,-72.54486988895377,-72.54264257865621,-72.5426580961293,-72.54490109937011],"lat":[42.85169405825712,42.85076247576531,42.84895819397039,42.84808549722475,42.84901701029845,42.85082128953293,42.85169405825712]}]],[[{"lng":[-72.58297758416226,-72.58520467180146,-72.58518748126528,-72.58294337862721,-72.58071638016143,-72.58073339516042,-72.58297758416226],"lat":[42.85930774801841,42.85837533874297,42.85657087281487,42.8556988185973,42.85663115838236,42.85843562187235,42.85930774801841]}]],[[{"lng":[-72.58744895339431,-72.5896759580631,-72.58965859198919,-72.58741439678433,-72.58518748126528,-72.58520467180146,-72.58744895339431],"lat":[42.85924737899121,42.8583148813867,42.85651041303496,42.85563844470836,42.85657087281487,42.85837533874297,42.85924737899121]}]],[[{"lng":[-72.57177420703159,-72.57400137130837,-72.57398462158673,-72.57174088310354,-72.56951380804897,-72.56953038225548,-72.57177420703159],"lat":[42.85675120688424,42.85581904376227,42.85401463826829,42.85314239836734,42.85407449202047,42.85587889504038,42.85675120688424]}]],[[{"lng":[-72.55610142651142,-72.55832875000534,-72.55831261648407,-72.55606933496139,-72.55384210076205,-72.55385805879089,-72.55610142651142],"lat":[42.85425300815923,42.85332117952814,42.85151683707328,42.850644325771,42.8515760849624,42.85338042489277,42.85425300815923]}]],[[{"lng":[-72.54043061380898,-72.5426580961293,-72.54264257865621,-72.5403997543326,-72.53817236137917,-72.53818770338258,-72.54043061380898],"lat":[42.85175278366491,42.85082128953293,42.84901701029845,42.84814422776791,42.84907565248941,42.85087992914897,42.85175278366491]}]],[[{"lng":[-72.57850622457832,-72.58073339516042,-72.58071638016143,-72.57847237011708,-72.57624528873207,-72.57626212819441,-72.57850622457832],"lat":[42.85936794281198,42.85843562187235,42.85663115838236,42.85575901828159,42.85669126973846,42.85849573077586,42.85936794281198]}]],[[{"lng":[-72.56730313511444,-72.56953038225548,-72.56951380804897,-72.56727016221608,-72.56504300432088,-72.56505940301285,-72.56730313511444],"lat":[42.85681096982078,42.85587889504038,42.85407449202047,42.85320216626651,42.85413417158567,42.85593857211702,42.85681096982078]}]],[[{"lng":[-72.56283207303504,-72.56505940301285,-72.56504300432088,-72.5627994511652,-72.5605722104569,-72.56058843363488,-72.56283207303504],"lat":[42.8568705585491,42.85593857211702,42.85413417158567,42.85326175998642,42.85419367696489,42.85599807499321,42.8568705585491]}]],[[{"lng":[-72.55163065253883,-72.55385805879089,-72.55384210076205,-72.55159891197312,-72.54937159503926,-72.54938737757628,-72.55163065253883],"lat":[42.85431216516977,42.85338042489277,42.8515760849624,42.85070348784505,42.85163515869,42.85343949608138,42.85431216516977]}]],[[{"lng":[-72.57403487469689,-72.57626212819441,-72.57624528873207,-72.57400137130837,-72.57177420703159,-72.57179087095787,-72.57403487469689],"lat":[42.85942796337302,42.85849573077586,42.85669126973846,42.85581904376227,42.85675120688424,42.8585556654546,42.85942796337302]}]],[[{"lng":[-72.55836102084781,-72.56058843363488,-72.5605722104569,-72.55832875000534,-72.55610142651142,-72.55611747417601,-72.55836102084781],"lat":[42.85692997307029,42.85599807499321,42.85419367696489,42.85332117952814,42.85425300815923,42.85605740367006,42.85692997307029]}]],[[{"lng":[-72.54715988859357,-72.54938737757628,-72.54937159503926,-72.54712849901094,-72.54490109937011,-72.54491670641585,-72.54715988859357],"lat":[42.85437114799762,42.85343949608138,42.85163515869,42.85076247576531,42.85169405825712,42.85349839309507,42.85437114799762]}]],[[{"lng":[-72.53596013841025,-72.53818770338258,-72.53817236137917,-72.53592962987263,-72.53370215429084,-72.53371732082518,-72.53596013841025],"lat":[42.85181133491444,42.85087992914897,42.84907565248941,42.84820278418176,42.84913412054438,42.85093839461454,42.85181133491444]}]],[[{"lng":[-72.58523905692314,-72.58746623373426,-72.58744895339431,-72.58520467180146,-72.58297758416226,-72.58299468894408,-72.58523905692314],"lat":[42.86198437921183,42.86105190043969,42.85924737899121,42.85837533874297,42.85930774801841,42.86111226703579,42.86198437921183]}]],[[{"lng":[-72.56956353457242,-72.57179087095787,-72.57177420703159,-72.56953038225548,-72.56730313511444,-72.56731962350521,-72.56956353457242],"lat":[42.85948780970252,42.8585556654546,42.85675120688424,42.85587889504038,42.85681096982078,42.85861542590956,42.85948780970252]}]],[[{"lng":[-72.55388997860715,-72.55611747417601,-72.55610142651142,-72.55385805879089,-72.55163065253883,-72.55164652469061,-72.55388997860715],"lat":[42.85698921338544,42.85605740367006,42.85425300815923,42.85338042489277,42.85431216516977,42.85611655814862,42.85698921338544]}]],[[{"lng":[-72.54268913473005,-72.54491670641585,-72.54490109937011,-72.5426580961293,-72.54043061380898,-72.54044604536406,-72.54268913473005],"lat":[42.85442995664385,42.85349839309507,42.85169405825712,42.85082128953293,42.85175278366491,42.85355711593492,42.85442995664385]}]],[[{"lng":[-72.58076742916639,-72.58299468894408,-72.58297758416226,-72.58073339516042,-72.57850622457832,-72.57852315380255,-72.58076742916639],"lat":[42.86204465746454,42.86111226703579,42.85930774801841,42.85843562187235,42.85936794281198,42.8611724593838,42.86204465746454]}]],[[{"lng":[-72.57629581108574,-72.57852315380255,-72.57850622457832,-72.57626212819441,-72.57403487469689,-72.5740516283641,-72.57629581108574],"lat":[42.86210476146245,42.8611724593838,42.85936794281198,42.85849573077586,42.85942796337302,42.86123247748477,42.86210476146245]}]],[[{"lng":[-72.56509220425936,-72.56731962350521,-72.56730313511444,-72.56505940301285,-72.56283207303504,-72.56284838589087,-72.56509220425936],"lat":[42.85954748180158,42.85861542590956,42.85681096982078,42.85593857211702,42.8568705585491,42.85867501214187,42.85954748180158]}]],[[{"lng":[-72.54941894636748,-72.55164652469061,-72.55163065253883,-72.54938737757628,-72.54715988859357,-72.54717558523313,-72.54941894636748],"lat":[42.85704827949562,42.85611655814862,42.85431216516977,42.85343949608138,42.85437114799762,42.85617553843003,42.85704827949562]}]],[[{"lng":[-72.53821839100264,-72.54044604536406,-72.54043061380898,-72.53818770338258,-72.53596013841025,-72.53597539447532,-72.53821839100264],"lat":[42.85448859110956,42.85355711593492,42.85175278366491,42.85087992914897,42.85181133491444,42.85361566460205,42.85448859110956]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":0.5,"fill":true,"fillColor":"black","fillOpacity":0,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[42.835984,-72.5850351,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":1,"fill":true,"fillColor":"green","fillOpacity":1},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addCircleMarkers","args":[42.8410302,-72.5492016,10,null,null,{"interactive":true,"className":"","stroke":true,"color":"black","weight":1,"opacity":1,"fill":true,"fillColor":"red","fillOpacity":1},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[-72.5850351,-72.5492016],"lat":[42.835984,42.8410302]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#27d8db","weight":3,"opacity":1,"fill":false,"fillColor":"#27d8db","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addPolylines","args":[[[[{"lng":[-72.58722443493217,-72.58662948950504,-72.58619057808117,-72.58570213658129,-72.58517957123152,-72.58466217800617,-72.58419807314399,-72.58382226124891,-72.58354473210549,-72.58335654960929,-72.58324188272903,-72.58318656538115,-72.58318146114156,-72.58322268378951,-72.58330931380875,-72.58344032817226,-72.58360937101651,-72.58379984405732,-72.58398492553282,-72.58413440299348,-72.5842250961738,-72.58424683503485,-72.5842019421935,-72.58409960256633,-72.58395164202648,-72.58376972137869,-72.58356435737689,-72.58334283356638,-72.58311197706227,-72.58287601899768,-72.58263776393088,-72.58239885772387,-72.58215993614753,-72.58192059401173,-72.58167928075505,-72.58143295001898,-72.58117752198702,-72.58090802180389,-72.58061955248232,-72.58030845889957,-72.57997345959274,-72.5796164717058,-72.57924142403886,-72.57885443221429,-72.57846110328629,-72.5780662601954,-72.57767235367156,-72.57728041840241,-72.57689045617398,-72.5765022135287,-72.57611471750441,-72.57572778584641,-72.57534114352602,-72.57495463618889,-72.57456818701456,-72.57418173767596,-72.57379550530617,-72.57340901957642,-72.57302253485292,-72.57263604935743,-72.5722498091574,-72.57186335934288,-72.57147690991629,-72.57109069174824,-72.57070420519206,-72.57031772042103,-72.5699312355674,-72.5695447487706,-72.56915853175458,-72.56877208208539,-72.5683856319816,-72.56799939027887,-72.56761290461922,-72.56722641968406,-72.56683993367419,-72.56645370237644,-72.56606725275363,-72.56568080317052,-72.5652945755907,-72.56490808929109,-72.56452160422349,-72.56413511858592,-72.56374887312676,-72.56336242273242,-72.56297597284639,-72.56258975950657,-72.56220327211486,-72.56181678680981,-72.56143030172723,-72.56104381499983,-72.56065759250248,-72.5602711425306,-72.55988469224177,-72.55949845514442,-72.55911196883824,-72.55872511597887,-72.55833823523497,-72.55795109092936,-72.5575628116132,-72.55717306522487,-72.55678131171969,-72.55638736156639,-72.55599192425919,-72.55559721241848,-72.55520734840682,-72.55482822707089,-72.55446543616476,-72.55412416941955,-72.55380692397009,-72.55351330823399,-72.55323973012142,-72.5529811938589,-72.55273169635647,-72.55248426907475,-72.55223215504539,-72.55196890601681,-72.55168836899401,-72.55138489676069,-72.5510552977378,-72.55069897072535,-72.5503178748679,-72.54991740879375,-72.54950520317175,-72.549090282363,-72.54868188890703,-72.54828688362569,-72.54790933695575,-72.54754902591877,-72.54705004939451],"lat":[42.83579191061196,42.835800933386,42.83580825912543,42.8358177481413,42.83583018776235,42.8358461516835,42.83586599048005,42.8358901525779,42.83591970404397,42.8359567351152,42.8360046500197,42.83606853953741,42.83615521934541,42.83627379005159,42.83643482378028,42.83664828516159,42.83691936120854,42.8372435482313,42.83760471687697,42.83797997353011,42.83834899268108,42.83870124040916,42.83903503303465,42.8393544611953,42.83966464827699,42.83996964949269,42.84027308428025,42.84057317808217,42.84087262592059,42.84117073731564,42.84146641848744,42.84175804918976,42.84204342324401,42.84231978726993,42.84258407629422,42.84283270230282,42.84306234990267,42.84326976196029,42.84345205564129,42.84360704662669,42.84373369478205,42.84383253909091,42.84390594236912,42.84395777743691,42.84399291734996,42.84401590694452,42.84403100697253,42.84404134108048,42.84404901908971,42.84405532534491,42.84406098109338,42.84406634723013,42.84407159432423,42.84407679605143,42.84408198181492,42.84408716648997,42.84409234728855,42.84409753053372,42.84410271274351,42.84410789378634,42.8441130701672,42.84411824782116,42.84412342382551,42.84412859509144,42.84413376839424,42.84413894029139,42.84414411100034,42.84414928070502,42.84415444584717,42.84415961313897,42.84416477935503,42.84416994153198,42.84417510551493,42.84418026789113,42.84418542862249,42.84419058433086,42.84419574147557,42.84420089732175,42.84420604909874,42.84421120333776,42.8442163566164,42.84422150889631,42.84422665681717,42.84423180613182,42.84423695391908,42.84424209692724,42.84424724192556,42.84425238532747,42.84425752731975,42.8442626681198,42.84426780435236,42.84427294266191,42.84427808001695,42.84428321348231,42.8442883490218,42.84429343086756,42.84429842785513,42.84430318883673,42.84430741302958,42.84431047737669,42.84431123364578,42.84430774484272,42.84429705701683,42.8442751428545,42.84423726029184,42.84417854977542,42.84409499844578,42.84398432659,42.84384647003002,42.84368364366335,42.84349972570387,42.84330021377122,42.84309150904541,42.84288041931262,42.84267394835223,42.84247888136297,42.84230129515907,42.84214613996981,42.84201690872775,42.84191519704955,42.84184010613503,42.84178887651338,42.84175714080455,42.8417398960493,42.84173243035315,42.84173089879155,42.84173259619003,42.84173586222338,42.84174144408764]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"#34d15e","weight":3,"opacity":1,"fill":false,"fillColor":"#34d15e","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[42.81543759624775,42.86210476146245],"lng":[-72.60056061290285,-72.53370215429084]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
</section>
<section id="machine-learning" class="level1">
<h1>Machine Learning</h1>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h2>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>tt.df <span class="ot">&lt;-</span> <span class="fu">vroom</span>(<span class="fu">here</span>(<span class="st">"Documentation/Data/Training_Testing.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A critical step in building a good model is reviewing the distributions of the data to be used as explanatory variables. In some cases, transformations may need to be applied to ensure that the model can make the best use of the data. This may take the form of applying a function to normalize a distribution, or convert a numerical variable to a categorical one. This process is referred to as ‘feature engineering; where the explanatory variables are referred to as ’features’. In this section, we describe and show the steps taken to prepare the input data.</p>
<section id="splitting-data-into-training-and-testing-sets" class="level3">
<h3 class="anchored" data-anchor-id="splitting-data-into-training-and-testing-sets">Splitting Data into Training and Testing Sets</h3>
<p>Following our review of state supplied sewershed boundaries, 49 counties were identified as having complete and accurate service areas. We randomly selected 25 of these counties to be used for the training set. The remaining 24 counties were set aside for model testing. As we review input features for the model, we focus on two objectives:</p>
<ol type="1">
<li><p>To ensure values in the testing dataset should resemble the values in the training set. Without a representative sample, the model will struggle to effectively estimate sewer service.</p></li>
<li><p>To determine the distributions of each feature and determine if transformations should be applied.</p></li>
</ol>
</section>
<section id="overview-of-data-and-modeling-strategy" class="level3">
<h3 class="anchored" data-anchor-id="overview-of-data-and-modeling-strategy">Overview of Data and Modeling Strategy</h3>
<p>As previously discussed, we have identified 32 miles as the cutoff beyond which a treatment plant is unlikely to serve a community. To this end, the model will consider characteristics of any sewer collection system within 32 miles for each hexagon. Each row of data therefore represents a single relationship between a single hexagon and a single endpoint. The goal of the model is to predict whether or not that endpoint is associated with a sewershed which serves that hexagon. If a hexagon is within 32 miles of multiple endpoints, it will have multiple rows of data. The row that returns the highest probability will be considered the most likely endpoint for that hexagon. Once the most likely endpoint is identified, the probability will be compared with a cutoff value. Generally, most models use a probability of 0.5 (50%). However, we will determine the optimum threshold through model tuning (described later). If the probability for the most likely endpoint is above the threshold, we assign it to the sewershed assosciated with the corresponding endpoint. If none of the endpoints reach the threshold, the hexagon is determined to be ‘Non-Sewered’.</p>
<p>When splitting the data, we make sure the proportion of ‘TRUE’ and ‘FALSE’ values are similar. The plot below shows the distributions between sets are indeed similar, which is a good first indicator. However, we see a clear imbalance between the two classes (TRUE &amp; FALSE). We expect this since we know that we have multiple rows for many hexagons and with a radius of 32 miles, most hexagons will not be served by the endpoint they are compared with. This problem is referred to as the ‘Class Imbalance Problem’. The issue is that our goal is to map sewersheds, and the nature of the random forest model is to minimize total error, regardless of the class. This means that the model will be biased towards predicting ‘FALSE’ for most hexagons, which is not what we want. To address this, we will under-sample the ‘FALSE’ class to balance the outcomes with ‘TRUE’. Again, it is critical that we do so in a representative way.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tt.df)<span class="sc">+</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Correct_CWNS, <span class="at">stat =</span> <span class="st">"count"</span>))<span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Set)<span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportion of Correct to Incorrect Endpoints"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Correct Endpoint"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"# of Hexagons"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Documentation_files/figure-html/trainTestPlot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="balancing-training-outcomes" class="level3">
<h3 class="anchored" data-anchor-id="balancing-training-outcomes">Balancing Training Outcomes</h3>
<p>Our primary concern is the fitting of the model to the training set. We don’t need to under sample the testing set because we are not using it to fit the model. An alternative use of the excess testing data is to bin the FALSE classes into separate testing sets to evaluate effects. The table below shows the number of ‘TRUE’ values to be ~20,000 in the training and testing sets, which is the value we will use to sample the ‘FALSE’ class within the training set. We have to be particularly careful here because if our sample includes to many hexagons that are are a greater distance from the endpoint, we may throw off the similarities of the data values. Conversely, we must not exclude farther hexagons excessively or we will not be able to effectively model larger or more disperse systems.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of TRUE and FALSE values between sets</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>tt.df.count <span class="ot">&lt;-</span> tt.df<span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Set,Correct_CWNS)<span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(tt.df.count)<span class="sc">%&gt;%</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"Count of TRUE and FALSE Values"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(<span class="at">Set =</span> <span class="st">"Set"</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">Correct_CWNS =</span> <span class="st">"Correct Endpoint"</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="st">"# of Hexagons"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"center"</span>, <span class="at">columns =</span> <span class="fu">everything</span>())<span class="sc">%&gt;%</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(<span class="at">table.width =</span> <span class="fu">px</span>(<span class="dv">400</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<div id="tcluwylnlx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tcluwylnlx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tcluwylnlx thead, #tcluwylnlx tbody, #tcluwylnlx tfoot, #tcluwylnlx tr, #tcluwylnlx td, #tcluwylnlx th {
  border-style: none;
}

#tcluwylnlx p {
  margin: 0;
  padding: 0;
}

#tcluwylnlx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 400px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tcluwylnlx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tcluwylnlx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tcluwylnlx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tcluwylnlx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tcluwylnlx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tcluwylnlx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tcluwylnlx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tcluwylnlx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tcluwylnlx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tcluwylnlx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tcluwylnlx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tcluwylnlx .gt_spanner_row {
  border-bottom-style: hidden;
}

#tcluwylnlx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tcluwylnlx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tcluwylnlx .gt_from_md > :first-child {
  margin-top: 0;
}

#tcluwylnlx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tcluwylnlx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tcluwylnlx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tcluwylnlx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tcluwylnlx .gt_row_group_first td {
  border-top-width: 2px;
}

#tcluwylnlx .gt_row_group_first th {
  border-top-width: 2px;
}

#tcluwylnlx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tcluwylnlx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tcluwylnlx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tcluwylnlx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tcluwylnlx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tcluwylnlx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tcluwylnlx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tcluwylnlx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tcluwylnlx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tcluwylnlx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tcluwylnlx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tcluwylnlx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tcluwylnlx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tcluwylnlx .gt_left {
  text-align: left;
}

#tcluwylnlx .gt_center {
  text-align: center;
}

#tcluwylnlx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tcluwylnlx .gt_font_normal {
  font-weight: normal;
}

#tcluwylnlx .gt_font_bold {
  font-weight: bold;
}

#tcluwylnlx .gt_font_italic {
  font-style: italic;
}

#tcluwylnlx .gt_super {
  font-size: 65%;
}

#tcluwylnlx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tcluwylnlx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tcluwylnlx .gt_indent_1 {
  text-indent: 5px;
}

#tcluwylnlx .gt_indent_2 {
  text-indent: 10px;
}

#tcluwylnlx .gt_indent_3 {
  text-indent: 15px;
}

#tcluwylnlx .gt_indent_4 {
  text-indent: 20px;
}

#tcluwylnlx .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border">Count of TRUE and FALSE Values</th>
</tr>
<tr class="odd gt_col_headings">
<th id="Set" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Set</th>
<th id="Correct Endpoint" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Correct Endpoint</th>
<th id="# of Hexagons" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"># of Hexagons</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="Set">Testing</td>
<td class="gt_row gt_center" headers="Correct_CWNS">FALSE</td>
<td class="gt_row gt_center" headers="n">716255</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Set">Testing</td>
<td class="gt_row gt_center" headers="Correct_CWNS">TRUE</td>
<td class="gt_row gt_center" headers="n">20717</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Set">Training</td>
<td class="gt_row gt_center" headers="Correct_CWNS">FALSE</td>
<td class="gt_row gt_center" headers="n">670577</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Set">Training</td>
<td class="gt_row gt_center" headers="Correct_CWNS">TRUE</td>
<td class="gt_row gt_center" headers="n">19760</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
<section id="under-sampling" class="level4">
<h4 class="anchored" data-anchor-id="under-sampling">Under-Sampling</h4>
<p>To determine the relationships between training and testing and the effect of under-sampling, we will plot the distributions of each variable side-by-side for the original training set, the under-sampled training set and the testing set.</p>
<div class="cell">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset training + False</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>train.false <span class="ot">&lt;-</span> tt.df<span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Set <span class="sc">==</span> <span class="st">"Training"</span> <span class="sc">&amp;</span> Correct_CWNS <span class="sc">==</span> <span class="st">"FALSE"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly Sample Rows to return row indices (No Duplicates)</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>u.sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(train.false)), <span class="at">size =</span> <span class="dv">20000</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create replacement FALSE rows</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>u.rows <span class="ot">&lt;-</span> train.false[u.sample,]</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-Combine TRUE with under sampled FALSE</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>train.u <span class="ot">&lt;-</span> tt.df<span class="sc">%&gt;%</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Set <span class="sc">==</span> <span class="st">"Training"</span> <span class="sc">&amp;</span> Correct_CWNS <span class="sc">==</span> <span class="st">"TRUE"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(u.rows)<span class="sc">%&gt;%</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Set =</span> <span class="st">"Training_UnderSampled"</span>)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create combined Dataset to generate plots</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>compare.sets <span class="ot">&lt;-</span> tt.df<span class="sc">%&gt;%</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(train.u)</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of variables to plot</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>var.list.n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TOTAL_RES_POPULATION_2022"</span>,<span class="st">"Near_Rank"</span>,<span class="st">"distance"</span>,<span class="st">"nBldgs"</span>,</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">"HU_90"</span>,<span class="st">"HU_20"</span>,<span class="st">"Pct_Sewer_90"</span>,<span class="st">"EP_Elevation"</span>,<span class="st">"EP_Elev_Dif"</span>,</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Imprv_Med"</span>,<span class="st">"Strt_Dist"</span>,<span class="st">"SQ_Dist"</span>,<span class="st">"Pop_2020"</span>,<span class="st">"Pop_B"</span>,<span class="st">"THU_B"</span>,<span class="st">"Urban_B"</span>,<span class="st">"Bldgs_B"</span>,<span class="st">"Med_Bldg_Height"</span>,</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Mean_Bldg_Height"</span>,<span class="st">"Med_Bldg_Area"</span>,<span class="st">"Mean_Bldg_Area"</span>,<span class="st">"Imprv_Mean"</span>,</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Pop_3"</span>,<span class="st">"THU_3"</span>,<span class="st">"Urban_Pop_3"</span>,<span class="st">"OHU_90_3"</span>,<span class="st">"Pub_W_90_3"</span>,<span class="st">"Pub_S_90_3"</span>,</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>         <span class="st">"nBldgs_3"</span>,<span class="st">"Imprv_Med_3"</span>,<span class="st">"mean_Elev_3"</span>,<span class="st">"Pop_9"</span>,<span class="st">"THU_9"</span>,</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Urban_Pop_9"</span>,<span class="st">"OHU_90_9"</span>,<span class="st">"Pub_W_90_9"</span>,<span class="st">"Pub_S_90_9"</span>,<span class="st">"nBldgs_9"</span>,<span class="st">"Imprv_Med_9"</span>,<span class="st">"mean_Elev_9"</span>)</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>var.list.f <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Urban_Rural"</span>,<span class="st">"NLCD_Class"</span>,<span class="st">"NLCD_3"</span>,<span class="st">"NLCD_9"</span>)</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(var.list.n)){</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a plot for each variable</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(compare.sets)<span class="sc">+</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> var.list.n[n], <span class="at">fill =</span> <span class="st">"Set"</span>), <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#ED9B40"</span>,<span class="st">"#44CCFF"</span>,<span class="st">"#745296"</span>))<span class="sc">+</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_x_continuous(labels = label_number(scale_cut = cut_short_scale()))+</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_y_continuous(labels = label_number(scale_cut = cut_short_scale()))+</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Distribution of "</span>,var.list.n[n]),</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> var.list.n[n],</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"# of Hexagons"</span>)<span class="sc">+</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Set, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"Bottom"</span>)</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save Plot</span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"Documentation/Plots/"</span>,<span class="fu">paste0</span>(var.list.n[n],<span class="st">".png"</span>)), <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">dpi =</span> <span class="dv">500</span>)</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(var.list.f)){</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a plot for each variable</span></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(compare.sets)<span class="sc">+</span></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> var.list.f[n], <span class="at">fill =</span> <span class="st">"Set"</span>), <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#ED9B40"</span>,<span class="st">"#44CCFF"</span>,<span class="st">"#745296"</span>))<span class="sc">+</span></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_x_continuous(labels = label_number(scale_cut = cut_short_scale()))+</span></span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">#scale_y_continuous(labels = label_number(scale_cut = cut_short_scale()))+</span></span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Distribution of "</span>,var.list.f[n]),</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> var.list.f[n],</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"# of Hexagons"</span>)<span class="sc">+</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Set, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"Bottom"</span>)</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save Plot</span></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"Documentation/Plots_f/"</span>,<span class="fu">paste0</span>(var.list.f[n],<span class="st">".png"</span>)), <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">6</span>,</span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a>         <span class="at">dpi =</span> <span class="dv">500</span>)</span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="numerical-predictors" class="level4">
<h4 class="anchored" data-anchor-id="numerical-predictors">Numerical Predictors</h4>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>img_files <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">"Plots"</span>, <span class="at">glob=</span><span class="st">"*.png"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"::: {layout-ncol=2}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"![]({img_files})</span><span class="sc">\n\n\n</span><span class="st">"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">":::"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Bldgs_B.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/distance.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/EP_Elevation.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/EP_Elev_Dif.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/HU_20.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/HU_90.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Imprv_Mean.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Imprv_Med.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Imprv_Med_3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Imprv_Med_9.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Mean_Bldg_Area.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Mean_Bldg_Height.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/mean_Elev_3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/mean_Elev_9.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Med_Bldg_Area.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Med_Bldg_Height.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/nBldgs.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/nBldgs_3.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/nBldgs_9.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Near_Rank.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/OHU_90_3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/OHU_90_9.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pct_Sewer_90.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pop_2020.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pop_3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pop_9.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pop_B.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pub_S_90_3.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pub_S_90_9.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pub_W_90_3.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Pub_W_90_9.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/SQ_Dist.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Strt_Dist.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/THU_3.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/THU_9.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/THU_B.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/TOTAL_RES_POPULATION_2022.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Urban_B.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Urban_Pop_3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Urban_Pop_9.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots/Urban_Rural.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>A review of the above plots indicates that the overall distributions are similar between the three datasets, indicating that our new ‘balanced’ dataset has resolved it’s imbalanced class problem, while maintaining a representative distribution of the original training dataset and the testing dataset. Therefore we can continue with model training for these numerical predictors.</p>
</section>
<section id="categorical-predictors" class="level4">
<h4 class="anchored" data-anchor-id="categorical-predictors">Categorical Predictors</h4>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>img_files <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(<span class="st">"Plots_f"</span>, <span class="at">glob=</span><span class="st">"*.png"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"::: {layout-ncol=2}</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"![]({img_files})</span><span class="sc">\n\n\n</span><span class="st">"</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">":::"</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots_f/NLCD_3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots_f/NLCD_9.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots_f/NLCD_Class.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Plots_f/Urban_Rural.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
</section>
<section id="sewershed-population-served" class="level3">
<h3 class="anchored" data-anchor-id="sewershed-population-served">Sewershed Population Served</h3>
<p>Variable Label: ‘TOTAL_RES_POPULATION_2022’</p>
<section id="section" class="level4">
<h4 class="anchored" data-anchor-id="section"></h4>
</section>
</section>
<section id="manhatten-distance" class="level3">
<h3 class="anchored" data-anchor-id="manhatten-distance">Manhatten Distance</h3>
<p>Variable Label: ‘distance’</p>
</section>
<section id="straight-distance" class="level3">
<h3 class="anchored" data-anchor-id="straight-distance">Straight Distance</h3>
</section>
<section id="squirrel-distance" class="level3">
<h3 class="anchored" data-anchor-id="squirrel-distance">Squirrel Distance</h3>
</section>
<section id="building-metrics" class="level3">
<h3 class="anchored" data-anchor-id="building-metrics">Building Metrics</h3>
<section id="building-count" class="level4">
<h4 class="anchored" data-anchor-id="building-count">Building Count</h4>
<p>Variable Label: ‘nBldgs’</p>
</section>
<section id="building-area" class="level4">
<h4 class="anchored" data-anchor-id="building-area">Building Area</h4>
<p>Variable Labels: ‘Med_Bldg_Area’, ‘Mean_Bldg_Area’</p>
</section>
<section id="building-height" class="level4">
<h4 class="anchored" data-anchor-id="building-height">Building Height</h4>
<p>Variable Labels: ‘Med_Bldg_Height’, ‘Mean_Bldg_Height’</p>
</section>
</section>
<section id="housing-units" class="level3">
<h3 class="anchored" data-anchor-id="housing-units">1990 Housing Units</h3>
<p>Variable Label: ‘HU_90’</p>
</section>
<section id="housing-units-1" class="level3">
<h3 class="anchored" data-anchor-id="housing-units-1">2020 Housing Units</h3>
<p>Variable Label: ‘HU_20’</p>
</section>
<section id="sewer" class="level3">
<h3 class="anchored" data-anchor-id="sewer">1990 % Sewer</h3>
<p>Variable Label: ‘Pct_Sewer_90’</p>
</section>
<section id="population" class="level3">
<h3 class="anchored" data-anchor-id="population">2020 Population</h3>
<p>Variable Label: ‘Pop_2020’</p>
</section>
<section id="urban-rural-census-classification" class="level3">
<h3 class="anchored" data-anchor-id="urban-rural-census-classification">Urban / Rural Census Classification</h3>
<p>Variable Label: ‘Urban_Rural’</p>
</section>
<section id="land-cover" class="level3">
<h3 class="anchored" data-anchor-id="land-cover">Land Cover</h3>
<p>Variable Label: ‘NLCD_Class’ <img src="img/NLCD_Class.png" class="img-fluid" alt="‘Bins for NLCD classifications’"></p>
</section>
<section id="endpoint-elevation" class="level3">
<h3 class="anchored" data-anchor-id="endpoint-elevation">Endpoint Elevation</h3>
<p>Variable Label: ‘EP_Elevation’</p>
</section>
<section id="elevation-difference" class="level3">
<h3 class="anchored" data-anchor-id="elevation-difference">Elevation Difference</h3>
<p>Variable Label: ‘EP_Elev_Dif’</p>
</section>
<section id="impervious-surface" class="level3">
<h3 class="anchored" data-anchor-id="impervious-surface">Impervious Surface</h3>
<p>Variable Label: ‘Imprv_Med’, ‘Imprv_Mean’</p>
</section>
<section id="metrics-to-describe-area-between-hexagon-and-endpoint" class="level3">
<h3 class="anchored" data-anchor-id="metrics-to-describe-area-between-hexagon-and-endpoint">Metrics to Describe Area Between Hexagon and Endpoint</h3>
<p>Variable Labels: ‘Pop_B’, ‘THU_B’, ‘Urban_B’, ‘Bldgs_B’</p>
</section>
<section id="metrics-to-describe-the-area-surrounding-each-hexagon" class="level3">
<h3 class="anchored" data-anchor-id="metrics-to-describe-the-area-surrounding-each-hexagon">Metrics to Describe the Area Surrounding each Hexagon</h3>
<section id="radius-of-3" class="level4">
<h4 class="anchored" data-anchor-id="radius-of-3">Radius of 3</h4>
<p>Variable Labels: ‘Pop_3’, ‘THU_3’, ‘Urban_Pop_3’, ‘OHU_90_3’, ‘Pub_W_90_3’, ‘Pub_S_90_3’, ‘nBldgs_3’, ‘NLCD_3’, ‘Imprv_Med_3’, ‘mean_Elev_3’</p>
</section>
<section id="radius-of-9" class="level4">
<h4 class="anchored" data-anchor-id="radius-of-9">Radius of 9</h4>
<p>Variable Labels: ‘Pop_9’, ‘THU_9’, ‘Urban_Pop_9’, ‘OHU_90_9’, ‘Pub_W_90_9’, ‘Pub_S_90_9’, ‘nBldgs_9’, ‘NLCD_9’, ‘Imprv_Med_9’, ‘mean_Elev_9’</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>